---
layout: post
title: 对等连接
categories: blog
description: 看名字就是一个连接服务，那么连接的是什么呢...
---

**一、网络隔离**  
**VPC虚拟私有云**  
VPC是公有云内网络隔离的最小单元，默认情况下多个vpc之间是网络不通的。也就是完全隔离的私网；多个不同VPC内子网CIDR可以重复；  

实验开始：  
**1、创建两个VPC，分别两个子网192.168.6.0/25;192.168.5.0/24;**  
![](/images/pubcloud/twovpc.jpg)  
**2、在两个VPC中创建两台ECS，IP地址分别是192.168.6.76；192.168.5.130**    
![](/images/pubcloud/twoecsdiffentvpc.jpg)  
**3、远程登录192.168.6.76这台ECS，ping另外一台VPC中的ECS 192.168.5.130**    
![](/images/pubcloud/pingresultfailed.jpg)  

**二、对等连接测试**
先来看看对等连接的定义：  
对等连接是指两个VPC之间的网络连接。您可以使用私有IP地址在两个VPC之间进行通信，就像两个VPC在同一个网络中一样。您可以在自己的VPC之间创建对等连接，也可以在自己的VPC与同一区域内其他的VPC之间创建对等连接。  

**好的，实验开始**    
**1、创建对等连接**   
![](/images/pubcloud/peering.jpg)    

**2、配置对等连接路由**  
![](/images/pubcloud/peerroutelocal.jpg)  
![](/images/pubcloud/peerrouteremote.jpg)  

**3、再次验证两台ECS之间连通性**  
![](/images/pubcloud/pingresult.jpg)  


**2、创建弹性负载均衡**  
创建之前先仔细来看下负载均衡模型，模型上可以简单理解分为前端和后端；  
前段即为对外提供服务的IP地址，可以是公网也可以是私网IP，总之对外呈现的IP；  
后端也就是监听器，一个负载均衡可以添加多个监听器；  
看看监听器的重点属性：  
**2.1、负载均衡协议/端口**：即该监听器关联的一组云服务器对外提供服务的端口，由于tomcat服务器默认装好后，http端口为8080，但是我们对外提供服务的时候，希望使用80端口；故此处配置80  
**2.2、云服务器协议/端口**：即该监听器关联的一组云服务器中提供服务的端口，根据上一行，此处为8080  
**2.3、负载方式**:即负载均衡根据什么规则将一个外部请求调度到所关联的一组服务器上的具体某一个。负载方式一般有几种：源IP方式，轮询算法，最少链接这几种  
**2.3.1、轮询算法**：就后端服务器排队一个一个来的意思，将新链接依次分配给后端的下一个服务器；而会话保持就是指通过识别做客户与服务器之间交互过程的关连性，保证一系列相关连的访问请求会保持分配到一
台服务器上。  
**2.3.2、源IP方式**：保障从同一个地址的请求被固定的分配到一个后端服务器上  
**2.3.3、最少链接**：将新请求调度到当前后端服务器中最闲的一个  
**2.4、健康检查配置**：要保障客户端的每次请求都能被有效处理，故负载均衡要实实时知后端一组服务器的状态，该状态的检测即为健康检查；大白话：配置一下每隔多久探测一下后端服务器的某个端口是否有响应，
如果若干次没响应后就认为该服务器已挂。新请求将不会再次调度到该服务器；  
**2.5、监听器关联的一组云服务器**：就是一组同质服务器，每一个都能提供同样的服务；这就要求服务器是无状态的；  

创建好的负载均衡如下图：    
![](/images/pubcloud/elb.jpg)    
负载均衡监听器   
![](/images/pubcloud/listener.jpg)
监听器关联的服务器   
![](/images/pubcloud/backserver.jpg)


**3、通过负载均衡IP访问tomcat服务**    
![](/images/pubcloud/tomcatview.jpg)  
![](/images/pubcloud/tomcatvisit.jpg)    

**4、查询后端两个ECS服务器上tomcat的请求日志，可以看出来请求只到一个某一台服务器上了**   
下面这个服务器是被选中的   
![](/images/pubcloud/selectedserver.jpg)  
另外一个是未被选中的  
![](/images/pubcloud/unselectedserver.jpg)  





