{"remainingRequest":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js??ref--3-1!/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/vue-i18n/dist/vue-i18n.esm.js","dependencies":[{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/vue-i18n/dist/vue-i18n.esm.js","mtime":1604064599567},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/cache-loader/dist/cjs.js","mtime":1603041438982},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js","mtime":1603041438713}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mb3ItZWFjaCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmluZGV4LW9mIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaXMtYXJyYXkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5qb2luIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmV2ZXJzZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LnNwbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm51bWJlci5jb25zdHJ1Y3RvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5jcmVhdGUiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnRpZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZGVmaW5lLXByb3BlcnR5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5wYXJzZS1pbnQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuY29uc3RydWN0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcubWF0Y2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcucmVwbGFjZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy50cmltIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5mb3ItZWFjaCI7CmltcG9ydCBfdHlwZW9mIGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKCi8qIQogKiB2dWUtaTE4biB2OC4yMi4xIAogKiAoYykgMjAyMCBrYXp1eWEga2F3YWd1Y2hpCiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgTGljZW5zZS4KICovCgovKiAgKi8KCi8qKgogKiBjb25zdGFudHMKICovCnZhciBudW1iZXJGb3JtYXRLZXlzID0gWydzdHlsZScsICdjdXJyZW5jeScsICdjdXJyZW5jeURpc3BsYXknLCAndXNlR3JvdXBpbmcnLCAnbWluaW11bUludGVnZXJEaWdpdHMnLCAnbWluaW11bUZyYWN0aW9uRGlnaXRzJywgJ21heGltdW1GcmFjdGlvbkRpZ2l0cycsICdtaW5pbXVtU2lnbmlmaWNhbnREaWdpdHMnLCAnbWF4aW11bVNpZ25pZmljYW50RGlnaXRzJywgJ2xvY2FsZU1hdGNoZXInLCAnZm9ybWF0TWF0Y2hlcicsICd1bml0J107Ci8qKgogKiB1dGlsaXRpZXMKICovCgpmdW5jdGlvbiB3YXJuKG1zZywgZXJyKSB7CiAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgY29uc29sZS53YXJuKCdbdnVlLWkxOG5dICcgKyBtc2cpOwogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogICAgaWYgKGVycikgewogICAgICBjb25zb2xlLndhcm4oZXJyLnN0YWNrKTsKICAgIH0KICB9Cn0KCmZ1bmN0aW9uIGVycm9yKG1zZywgZXJyKSB7CiAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJykgewogICAgY29uc29sZS5lcnJvcignW3Z1ZS1pMThuXSAnICsgbXNnKTsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKICAgIGlmIChlcnIpIHsKICAgICAgY29uc29sZS5lcnJvcihlcnIuc3RhY2spOwogICAgfQogIH0KfQoKdmFyIGlzQXJyYXkgPSBBcnJheS5pc0FycmF5OwoKZnVuY3Rpb24gaXNPYmplY3Qob2JqKSB7CiAgcmV0dXJuIG9iaiAhPT0gbnVsbCAmJiBfdHlwZW9mKG9iaikgPT09ICdvYmplY3QnOwp9CgpmdW5jdGlvbiBpc0Jvb2xlYW4odmFsKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdib29sZWFuJzsKfQoKZnVuY3Rpb24gaXNTdHJpbmcodmFsKSB7CiAgcmV0dXJuIHR5cGVvZiB2YWwgPT09ICdzdHJpbmcnOwp9Cgp2YXIgdG9TdHJpbmcgPSBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nOwp2YXIgT0JKRUNUX1NUUklORyA9ICdbb2JqZWN0IE9iamVjdF0nOwoKZnVuY3Rpb24gaXNQbGFpbk9iamVjdChvYmopIHsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSBPQkpFQ1RfU1RSSU5HOwp9CgpmdW5jdGlvbiBpc051bGwodmFsKSB7CiAgcmV0dXJuIHZhbCA9PT0gbnVsbCB8fCB2YWwgPT09IHVuZGVmaW5lZDsKfQoKZnVuY3Rpb24gaXNGdW5jdGlvbih2YWwpIHsKICByZXR1cm4gdHlwZW9mIHZhbCA9PT0gJ2Z1bmN0aW9uJzsKfQoKZnVuY3Rpb24gcGFyc2VBcmdzKCkgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGg7CgogIHdoaWxlIChsZW4tLSkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbl07CiAgfQoKICB2YXIgbG9jYWxlID0gbnVsbDsKICB2YXIgcGFyYW1zID0gbnVsbDsKCiAgaWYgKGFyZ3MubGVuZ3RoID09PSAxKSB7CiAgICBpZiAoaXNPYmplY3QoYXJnc1swXSkgfHwgaXNBcnJheShhcmdzWzBdKSkgewogICAgICBwYXJhbXMgPSBhcmdzWzBdOwogICAgfSBlbHNlIGlmICh0eXBlb2YgYXJnc1swXSA9PT0gJ3N0cmluZycpIHsKICAgICAgbG9jYWxlID0gYXJnc1swXTsKICAgIH0KICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAyKSB7CiAgICBpZiAodHlwZW9mIGFyZ3NbMF0gPT09ICdzdHJpbmcnKSB7CiAgICAgIGxvY2FsZSA9IGFyZ3NbMF07CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKGlzT2JqZWN0KGFyZ3NbMV0pIHx8IGlzQXJyYXkoYXJnc1sxXSkpIHsKICAgICAgcGFyYW1zID0gYXJnc1sxXTsKICAgIH0KICB9CgogIHJldHVybiB7CiAgICBsb2NhbGU6IGxvY2FsZSwKICAgIHBhcmFtczogcGFyYW1zCiAgfTsKfQoKZnVuY3Rpb24gbG9vc2VDbG9uZShvYmopIHsKICByZXR1cm4gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmopKTsKfQoKZnVuY3Rpb24gcmVtb3ZlKGFyciwgaXRlbSkgewogIGlmIChhcnIubGVuZ3RoKSB7CiAgICB2YXIgaW5kZXggPSBhcnIuaW5kZXhPZihpdGVtKTsKCiAgICBpZiAoaW5kZXggPiAtMSkgewogICAgICByZXR1cm4gYXJyLnNwbGljZShpbmRleCwgMSk7CiAgICB9CiAgfQp9CgpmdW5jdGlvbiBpbmNsdWRlcyhhcnIsIGl0ZW0pIHsKICByZXR1cm4gISF+YXJyLmluZGV4T2YoaXRlbSk7Cn0KCnZhciBoYXNPd25Qcm9wZXJ0eSA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CgpmdW5jdGlvbiBoYXNPd24ob2JqLCBrZXkpIHsKICByZXR1cm4gaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7Cn0KCmZ1bmN0aW9uIG1lcmdlKHRhcmdldCkgewogIHZhciBhcmd1bWVudHMkMSA9IGFyZ3VtZW50czsKICB2YXIgb3V0cHV0ID0gT2JqZWN0KHRhcmdldCk7CgogIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgc291cmNlID0gYXJndW1lbnRzJDFbaV07CgogICAgaWYgKHNvdXJjZSAhPT0gdW5kZWZpbmVkICYmIHNvdXJjZSAhPT0gbnVsbCkgewogICAgICB2YXIga2V5ID0gdm9pZCAwOwoKICAgICAgZm9yIChrZXkgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKGhhc093bihzb3VyY2UsIGtleSkpIHsKICAgICAgICAgIGlmIChpc09iamVjdChzb3VyY2Vba2V5XSkpIHsKICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBtZXJnZShvdXRwdXRba2V5XSwgc291cmNlW2tleV0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgb3V0cHV0W2tleV0gPSBzb3VyY2Vba2V5XTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CgogIHJldHVybiBvdXRwdXQ7Cn0KCmZ1bmN0aW9uIGxvb3NlRXF1YWwoYSwgYikgewogIGlmIChhID09PSBiKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CgogIHZhciBpc09iamVjdEEgPSBpc09iamVjdChhKTsKICB2YXIgaXNPYmplY3RCID0gaXNPYmplY3QoYik7CgogIGlmIChpc09iamVjdEEgJiYgaXNPYmplY3RCKSB7CiAgICB0cnkgewogICAgICB2YXIgaXNBcnJheUEgPSBpc0FycmF5KGEpOwogICAgICB2YXIgaXNBcnJheUIgPSBpc0FycmF5KGIpOwoKICAgICAgaWYgKGlzQXJyYXlBICYmIGlzQXJyYXlCKSB7CiAgICAgICAgcmV0dXJuIGEubGVuZ3RoID09PSBiLmxlbmd0aCAmJiBhLmV2ZXJ5KGZ1bmN0aW9uIChlLCBpKSB7CiAgICAgICAgICByZXR1cm4gbG9vc2VFcXVhbChlLCBiW2ldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICghaXNBcnJheUEgJiYgIWlzQXJyYXlCKSB7CiAgICAgICAgdmFyIGtleXNBID0gT2JqZWN0LmtleXMoYSk7CiAgICAgICAgdmFyIGtleXNCID0gT2JqZWN0LmtleXMoYik7CiAgICAgICAgcmV0dXJuIGtleXNBLmxlbmd0aCA9PT0ga2V5c0IubGVuZ3RoICYmIGtleXNBLmV2ZXJ5KGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiBsb29zZUVxdWFsKGFba2V5XSwgYltrZXldKTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfSBlbHNlIGlmICghaXNPYmplY3RBICYmICFpc09iamVjdEIpIHsKICAgIHJldHVybiBTdHJpbmcoYSkgPT09IFN0cmluZyhiKTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQovKioKICogU2FuaXRpemVzIGh0bWwgc3BlY2lhbCBjaGFyYWN0ZXJzIGZyb20gaW5wdXQgc3RyaW5ncy4gRm9yIG1pdGlnYXRpbmcgcmlzayBvZiBYU1MgYXR0YWNrcy4KICogQHBhcmFtIHJhd1RleHQgVGhlIHJhdyBpbnB1dCBmcm9tIHRoZSB1c2VyIHRoYXQgc2hvdWxkIGJlIGVzY2FwZWQuCiAqLwoKCmZ1bmN0aW9uIGVzY2FwZUh0bWwocmF3VGV4dCkgewogIHJldHVybiByYXdUZXh0LnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykucmVwbGFjZSgvIi9nLCAnJnF1b3Q7JykucmVwbGFjZSgvJy9nLCAnJmFwb3M7Jyk7Cn0KLyoqCiAqIEVzY2FwZXMgaHRtbCB0YWdzIGFuZCBzcGVjaWFsIHN5bWJvbHMgZnJvbSBhbGwgcHJvdmlkZWQgcGFyYW1zIHdoaWNoIHdlcmUgcmV0dXJuZWQgZnJvbSBwYXJzZUFyZ3MoKS5wYXJhbXMuCiAqIFRoaXMgbWV0aG9kIHBlcmZvcm1zIGFuIGluLXBsYWNlIG9wZXJhdGlvbiBvbiB0aGUgcGFyYW1zIG9iamVjdC4KICoKICogQHBhcmFtIHthbnl9IHBhcmFtcyBQYXJhbWV0ZXJzIGFzIHByb3ZpZGVkIGZyb20gYHBhcnNlQXJncygpLnBhcmFtc2AuCiAqICAgICAgICAgICAgICAgICAgICAgTWF5IGJlIGVpdGhlciBhbiBhcnJheSBvZiBzdHJpbmdzIG9yIGEgc3RyaW5nLT5hbnkgbWFwLgogKgogKiBAcmV0dXJucyBUaGUgbWFuaXB1bGF0ZWQgYHBhcmFtc2Agb2JqZWN0LgogKi8KCgpmdW5jdGlvbiBlc2NhcGVQYXJhbXMocGFyYW1zKSB7CiAgaWYgKHBhcmFtcyAhPSBudWxsKSB7CiAgICBPYmplY3Qua2V5cyhwYXJhbXMpLmZvckVhY2goZnVuY3Rpb24gKGtleSkgewogICAgICBpZiAodHlwZW9mIHBhcmFtc1trZXldID09ICdzdHJpbmcnKSB7CiAgICAgICAgcGFyYW1zW2tleV0gPSBlc2NhcGVIdG1sKHBhcmFtc1trZXldKTsKICAgICAgfQogICAgfSk7CiAgfQoKICByZXR1cm4gcGFyYW1zOwp9Ci8qICAqLwoKCmZ1bmN0aW9uIGV4dGVuZChWdWUpIHsKICBpZiAoIVZ1ZS5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkoJyRpMThuJykpIHsKICAgIC8vICRGbG93Rml4TWUKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShWdWUucHJvdG90eXBlLCAnJGkxOG4nLCB7CiAgICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLl9pMThuOwogICAgICB9CiAgICB9KTsKICB9CgogIFZ1ZS5wcm90b3R5cGUuJHQgPSBmdW5jdGlvbiAoa2V5KSB7CiAgICB2YXIgdmFsdWVzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICAgIH0KCiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdC5hcHBseShpMThuLCBba2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgdGhpc10uY29uY2F0KHZhbHVlcykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJHRjID0gZnVuY3Rpb24gKGtleSwgY2hvaWNlKSB7CiAgICB2YXIgdmFsdWVzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDI7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAyXTsKICAgIH0KCiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGMuYXBwbHkoaTE4biwgW2tleSwgaTE4bi5sb2NhbGUsIGkxOG4uX2dldE1lc3NhZ2VzKCksIHRoaXMsIGNob2ljZV0uY29uY2F0KHZhbHVlcykpOwogIH07CgogIFZ1ZS5wcm90b3R5cGUuJHRlID0gZnVuY3Rpb24gKGtleSwgbG9jYWxlKSB7CiAgICB2YXIgaTE4biA9IHRoaXMuJGkxOG47CiAgICByZXR1cm4gaTE4bi5fdGUoa2V5LCBpMThuLmxvY2FsZSwgaTE4bi5fZ2V0TWVzc2FnZXMoKSwgbG9jYWxlKTsKICB9OwoKICBWdWUucHJvdG90eXBlLiRkID0gZnVuY3Rpb24gKHZhbHVlKSB7CiAgICB2YXIgcmVmOwogICAgdmFyIGFyZ3MgPSBbXSwKICAgICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICAgIGFyZ3NbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAxXTsKICAgIH0KCiAgICByZXR1cm4gKHJlZiA9IHRoaXMuJGkxOG4pLmQuYXBwbHkocmVmLCBbdmFsdWVdLmNvbmNhdChhcmdzKSk7CiAgfTsKCiAgVnVlLnByb3RvdHlwZS4kbiA9IGZ1bmN0aW9uICh2YWx1ZSkgewogICAgdmFyIHJlZjsKICAgIHZhciBhcmdzID0gW10sCiAgICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogICAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CiAgICB9CgogICAgcmV0dXJuIChyZWYgPSB0aGlzLiRpMThuKS5uLmFwcGx5KHJlZiwgW3ZhbHVlXS5jb25jYXQoYXJncykpOwogIH07Cn0KLyogICovCgoKdmFyIG1peGluID0gewogIGJlZm9yZUNyZWF0ZTogZnVuY3Rpb24gYmVmb3JlQ3JlYXRlKCkgewogICAgdmFyIG9wdGlvbnMgPSB0aGlzLiRvcHRpb25zOwogICAgb3B0aW9ucy5pMThuID0gb3B0aW9ucy5pMThuIHx8IChvcHRpb25zLl9faTE4biA/IHt9IDogbnVsbCk7CgogICAgaWYgKG9wdGlvbnMuaTE4bikgewogICAgICBpZiAob3B0aW9ucy5pMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICAgIC8vIGluaXQgbG9jYWxlIG1lc3NhZ2VzIHZpYSBjdXN0b20gYmxvY2tzCiAgICAgICAgaWYgKG9wdGlvbnMuX19pMThuKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbG9jYWxlTWVzc2FnZXMgPSBvcHRpb25zLmkxOG4gJiYgb3B0aW9ucy5pMThuLm1lc3NhZ2VzID8gb3B0aW9ucy5pMThuLm1lc3NhZ2VzIDoge307CgogICAgICAgICAgICBvcHRpb25zLl9faTE4bi5mb3JFYWNoKGZ1bmN0aW9uIChyZXNvdXJjZSkgewogICAgICAgICAgICAgIGxvY2FsZU1lc3NhZ2VzID0gbWVyZ2UobG9jYWxlTWVzc2FnZXMsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBPYmplY3Qua2V5cyhsb2NhbGVNZXNzYWdlcykuZm9yRWFjaChmdW5jdGlvbiAobG9jYWxlKSB7CiAgICAgICAgICAgICAgb3B0aW9ucy5pMThuLm1lcmdlTG9jYWxlTWVzc2FnZShsb2NhbGUsIGxvY2FsZU1lc3NhZ2VzW2xvY2FsZV0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgICBlcnJvcigiQ2Fubm90IHBhcnNlIGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2Nrcy4iLCBlKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5faTE4biA9IG9wdGlvbnMuaTE4bjsKICAgICAgICB0aGlzLl9pMThuV2F0Y2hlciA9IHRoaXMuX2kxOG4ud2F0Y2hJMThuRGF0YSgpOwogICAgICB9IGVsc2UgaWYgKGlzUGxhaW5PYmplY3Qob3B0aW9ucy5pMThuKSkgewogICAgICAgIHZhciByb290STE4biA9IHRoaXMuJHJvb3QgJiYgdGhpcy4kcm9vdC4kaTE4biAmJiB0aGlzLiRyb290LiRpMThuIGluc3RhbmNlb2YgVnVlSTE4biA/IHRoaXMuJHJvb3QuJGkxOG4gOiBudWxsOyAvLyBjb21wb25lbnQgbG9jYWwgaTE4bgoKICAgICAgICBpZiAocm9vdEkxOG4pIHsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5yb290ID0gdGhpcy4kcm9vdDsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5mb3JtYXR0ZXIgPSByb290STE4bi5mb3JtYXR0ZXI7CiAgICAgICAgICBvcHRpb25zLmkxOG4uZmFsbGJhY2tMb2NhbGUgPSByb290STE4bi5mYWxsYmFja0xvY2FsZTsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5mb3JtYXRGYWxsYmFja01lc3NhZ2VzID0gcm9vdEkxOG4uZm9ybWF0RmFsbGJhY2tNZXNzYWdlczsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5zaWxlbnRUcmFuc2xhdGlvbldhcm4gPSByb290STE4bi5zaWxlbnRUcmFuc2xhdGlvbldhcm47CiAgICAgICAgICBvcHRpb25zLmkxOG4uc2lsZW50RmFsbGJhY2tXYXJuID0gcm9vdEkxOG4uc2lsZW50RmFsbGJhY2tXYXJuOwogICAgICAgICAgb3B0aW9ucy5pMThuLnBsdXJhbGl6YXRpb25SdWxlcyA9IHJvb3RJMThuLnBsdXJhbGl6YXRpb25SdWxlczsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQgPSByb290STE4bi5wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ7CiAgICAgICAgfSAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwoKCiAgICAgICAgaWYgKG9wdGlvbnMuX19pMThuKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICB2YXIgbG9jYWxlTWVzc2FnZXMkMSA9IG9wdGlvbnMuaTE4biAmJiBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPyBvcHRpb25zLmkxOG4ubWVzc2FnZXMgOiB7fTsKCiAgICAgICAgICAgIG9wdGlvbnMuX19pMThuLmZvckVhY2goZnVuY3Rpb24gKHJlc291cmNlKSB7CiAgICAgICAgICAgICAgbG9jYWxlTWVzc2FnZXMkMSA9IG1lcmdlKGxvY2FsZU1lc3NhZ2VzJDEsIEpTT04ucGFyc2UocmVzb3VyY2UpKTsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBvcHRpb25zLmkxOG4ubWVzc2FnZXMgPSBsb2NhbGVNZXNzYWdlcyQxOwogICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgICAgIHdhcm4oIkNhbm5vdCBwYXJzZSBsb2NhbGUgbWVzc2FnZXMgdmlhIGN1c3RvbSBibG9ja3MuIiwgZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciByZWYgPSBvcHRpb25zLmkxOG47CiAgICAgICAgdmFyIHNoYXJlZE1lc3NhZ2VzID0gcmVmLnNoYXJlZE1lc3NhZ2VzOwoKICAgICAgICBpZiAoc2hhcmVkTWVzc2FnZXMgJiYgaXNQbGFpbk9iamVjdChzaGFyZWRNZXNzYWdlcykpIHsKICAgICAgICAgIG9wdGlvbnMuaTE4bi5tZXNzYWdlcyA9IG1lcmdlKG9wdGlvbnMuaTE4bi5tZXNzYWdlcywgc2hhcmVkTWVzc2FnZXMpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5faTE4biA9IG5ldyBWdWVJMThuKG9wdGlvbnMuaTE4bik7CiAgICAgICAgdGhpcy5faTE4bldhdGNoZXIgPSB0aGlzLl9pMThuLndhdGNoSTE4bkRhdGEoKTsKCiAgICAgICAgaWYgKG9wdGlvbnMuaTE4bi5zeW5jID09PSB1bmRlZmluZWQgfHwgISFvcHRpb25zLmkxOG4uc3luYykgewogICAgICAgICAgdGhpcy5fbG9jYWxlV2F0Y2hlciA9IHRoaXMuJGkxOG4ud2F0Y2hMb2NhbGUoKTsKICAgICAgICB9CgogICAgICAgIGlmIChyb290STE4bikgewogICAgICAgICAgcm9vdEkxOG4ub25Db21wb25lbnRJbnN0YW5jZUNyZWF0ZWQodGhpcy5faTE4bik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgICB3YXJuKCJDYW5ub3QgYmUgaW50ZXJwcmV0ZWQgJ2kxOG4nIG9wdGlvbi4iKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodGhpcy4kcm9vdCAmJiB0aGlzLiRyb290LiRpMThuICYmIHRoaXMuJHJvb3QuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIC8vIHJvb3QgaTE4bgogICAgICB0aGlzLl9pMThuID0gdGhpcy4kcm9vdC4kaTE4bjsKICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIC8vIHBhcmVudCBpMThuCiAgICAgIHRoaXMuX2kxOG4gPSBvcHRpb25zLnBhcmVudC4kaTE4bjsKICAgIH0KICB9LAogIGJlZm9yZU1vdW50OiBmdW5jdGlvbiBiZWZvcmVNb3VudCgpIHsKICAgIHZhciBvcHRpb25zID0gdGhpcy4kb3B0aW9uczsKICAgIG9wdGlvbnMuaTE4biA9IG9wdGlvbnMuaTE4biB8fCAob3B0aW9ucy5fX2kxOG4gPyB7fSA6IG51bGwpOwoKICAgIGlmIChvcHRpb25zLmkxOG4pIHsKICAgICAgaWYgKG9wdGlvbnMuaTE4biBpbnN0YW5jZW9mIFZ1ZUkxOG4pIHsKICAgICAgICAvLyBpbml0IGxvY2FsZSBtZXNzYWdlcyB2aWEgY3VzdG9tIGJsb2NrcwogICAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgICB0aGlzLl9zdWJzY3JpYmluZyA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdChvcHRpb25zLmkxOG4pKSB7CiAgICAgICAgdGhpcy5faTE4bi5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodGhpcyk7CgogICAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgd2FybigiQ2Fubm90IGJlIGludGVycHJldGVkICdpMThuJyBvcHRpb24uIik7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKHRoaXMuJHJvb3QgJiYgdGhpcy4kcm9vdC4kaTE4biAmJiB0aGlzLiRyb290LiRpMThuIGluc3RhbmNlb2YgVnVlSTE4bikgewogICAgICB0aGlzLl9pMThuLnN1YnNjcmliZURhdGFDaGFuZ2luZyh0aGlzKTsKCiAgICAgIHRoaXMuX3N1YnNjcmliaW5nID0gdHJ1ZTsKICAgIH0gZWxzZSBpZiAob3B0aW9ucy5wYXJlbnQgJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gJiYgb3B0aW9ucy5wYXJlbnQuJGkxOG4gaW5zdGFuY2VvZiBWdWVJMThuKSB7CiAgICAgIHRoaXMuX2kxOG4uc3Vic2NyaWJlRGF0YUNoYW5naW5nKHRoaXMpOwoKICAgICAgdGhpcy5fc3Vic2NyaWJpbmcgPSB0cnVlOwogICAgfQogIH0sCiAgYmVmb3JlRGVzdHJveTogZnVuY3Rpb24gYmVmb3JlRGVzdHJveSgpIHsKICAgIGlmICghdGhpcy5faTE4bikgewogICAgICByZXR1cm47CiAgICB9CgogICAgdmFyIHNlbGYgPSB0aGlzOwogICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICBpZiAoc2VsZi5fc3Vic2NyaWJpbmcpIHsKICAgICAgICBzZWxmLl9pMThuLnVuc3Vic2NyaWJlRGF0YUNoYW5naW5nKHNlbGYpOwoKICAgICAgICBkZWxldGUgc2VsZi5fc3Vic2NyaWJpbmc7CiAgICAgIH0KCiAgICAgIGlmIChzZWxmLl9pMThuV2F0Y2hlcikgewogICAgICAgIHNlbGYuX2kxOG5XYXRjaGVyKCk7CgogICAgICAgIHNlbGYuX2kxOG4uZGVzdHJveVZNKCk7CgogICAgICAgIGRlbGV0ZSBzZWxmLl9pMThuV2F0Y2hlcjsKICAgICAgfQoKICAgICAgaWYgKHNlbGYuX2xvY2FsZVdhdGNoZXIpIHsKICAgICAgICBzZWxmLl9sb2NhbGVXYXRjaGVyKCk7CgogICAgICAgIGRlbGV0ZSBzZWxmLl9sb2NhbGVXYXRjaGVyOwogICAgICB9CiAgICB9KTsKICB9Cn07Ci8qICAqLwoKdmFyIGludGVycG9sYXRpb25Db21wb25lbnQgPSB7CiAgbmFtZTogJ2kxOG4nLAogIGZ1bmN0aW9uYWw6IHRydWUsCiAgcHJvcHM6IHsKICAgIHRhZzogewogICAgICB0eXBlOiBbU3RyaW5nLCBCb29sZWFuLCBPYmplY3RdLAogICAgICAiZGVmYXVsdCI6ICdzcGFuJwogICAgfSwKICAgIHBhdGg6IHsKICAgICAgdHlwZTogU3RyaW5nLAogICAgICByZXF1aXJlZDogdHJ1ZQogICAgfSwKICAgIGxvY2FsZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0sCiAgICBwbGFjZXM6IHsKICAgICAgdHlwZTogW0FycmF5LCBPYmplY3RdCiAgICB9CiAgfSwKICByZW5kZXI6IGZ1bmN0aW9uIHJlbmRlcihoLCByZWYpIHsKICAgIHZhciBkYXRhID0gcmVmLmRhdGE7CiAgICB2YXIgcGFyZW50ID0gcmVmLnBhcmVudDsKICAgIHZhciBwcm9wcyA9IHJlZi5wcm9wczsKICAgIHZhciBzbG90cyA9IHJlZi5zbG90czsKICAgIHZhciAkaTE4biA9IHBhcmVudC4kaTE4bjsKCiAgICBpZiAoISRpMThuKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybignQ2Fubm90IGZpbmQgVnVlSTE4biBpbnN0YW5jZSEnKTsKICAgICAgfQoKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHZhciBwYXRoID0gcHJvcHMucGF0aDsKICAgIHZhciBsb2NhbGUgPSBwcm9wcy5sb2NhbGU7CiAgICB2YXIgcGxhY2VzID0gcHJvcHMucGxhY2VzOwogICAgdmFyIHBhcmFtcyA9IHNsb3RzKCk7CiAgICB2YXIgY2hpbGRyZW4gPSAkaTE4bi5pKHBhdGgsIGxvY2FsZSwgb25seUhhc0RlZmF1bHRQbGFjZShwYXJhbXMpIHx8IHBsYWNlcyA/IHVzZUxlZ2FjeVBsYWNlcyhwYXJhbXNbImRlZmF1bHQiXSwgcGxhY2VzKSA6IHBhcmFtcyk7CiAgICB2YXIgdGFnID0gISFwcm9wcy50YWcgJiYgcHJvcHMudGFnICE9PSB0cnVlIHx8IHByb3BzLnRhZyA9PT0gZmFsc2UgPyBwcm9wcy50YWcgOiAnc3Bhbic7CiAgICByZXR1cm4gdGFnID8gaCh0YWcsIGRhdGEsIGNoaWxkcmVuKSA6IGNoaWxkcmVuOwogIH0KfTsKCmZ1bmN0aW9uIG9ubHlIYXNEZWZhdWx0UGxhY2UocGFyYW1zKSB7CiAgdmFyIHByb3A7CgogIGZvciAocHJvcCBpbiBwYXJhbXMpIHsKICAgIGlmIChwcm9wICE9PSAnZGVmYXVsdCcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KCiAgcmV0dXJuIEJvb2xlYW4ocHJvcCk7Cn0KCmZ1bmN0aW9uIHVzZUxlZ2FjeVBsYWNlcyhjaGlsZHJlbiwgcGxhY2VzKSB7CiAgdmFyIHBhcmFtcyA9IHBsYWNlcyA/IGNyZWF0ZVBhcmFtc0Zyb21QbGFjZXMocGxhY2VzKSA6IHt9OwoKICBpZiAoIWNoaWxkcmVuKSB7CiAgICByZXR1cm4gcGFyYW1zOwogIH0gLy8gRmlsdGVyIGVtcHR5IHRleHQgbm9kZXMKCgogIGNoaWxkcmVuID0gY2hpbGRyZW4uZmlsdGVyKGZ1bmN0aW9uIChjaGlsZCkgewogICAgcmV0dXJuIGNoaWxkLnRhZyB8fCBjaGlsZC50ZXh0LnRyaW0oKSAhPT0gJyc7CiAgfSk7CiAgdmFyIGV2ZXJ5UGxhY2UgPSBjaGlsZHJlbi5ldmVyeSh2bm9kZUhhc1BsYWNlQXR0cmlidXRlKTsKCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgZXZlcnlQbGFjZSkgewogICAgd2FybignYHBsYWNlYCBhdHRyaWJ1dGUgaXMgZGVwcmVjYXRlZCBpbiBuZXh0IG1ham9yIHZlcnNpb24uIFBsZWFzZSBzd2l0Y2ggdG8gVnVlIHNsb3RzLicpOwogIH0KCiAgcmV0dXJuIGNoaWxkcmVuLnJlZHVjZShldmVyeVBsYWNlID8gYXNzaWduQ2hpbGRQbGFjZSA6IGFzc2lnbkNoaWxkSW5kZXgsIHBhcmFtcyk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVBhcmFtc0Zyb21QbGFjZXMocGxhY2VzKSB7CiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgIHdhcm4oJ2BwbGFjZXNgIHByb3AgaXMgZGVwcmVjYXRlZCBpbiBuZXh0IG1ham9yIHZlcnNpb24uIFBsZWFzZSBzd2l0Y2ggdG8gVnVlIHNsb3RzLicpOwogIH0KCiAgcmV0dXJuIEFycmF5LmlzQXJyYXkocGxhY2VzKSA/IHBsYWNlcy5yZWR1Y2UoYXNzaWduQ2hpbGRJbmRleCwge30pIDogT2JqZWN0LmFzc2lnbih7fSwgcGxhY2VzKTsKfQoKZnVuY3Rpb24gYXNzaWduQ2hpbGRQbGFjZShwYXJhbXMsIGNoaWxkKSB7CiAgaWYgKGNoaWxkLmRhdGEgJiYgY2hpbGQuZGF0YS5hdHRycyAmJiBjaGlsZC5kYXRhLmF0dHJzLnBsYWNlKSB7CiAgICBwYXJhbXNbY2hpbGQuZGF0YS5hdHRycy5wbGFjZV0gPSBjaGlsZDsKICB9CgogIHJldHVybiBwYXJhbXM7Cn0KCmZ1bmN0aW9uIGFzc2lnbkNoaWxkSW5kZXgocGFyYW1zLCBjaGlsZCwgaW5kZXgpIHsKICBwYXJhbXNbaW5kZXhdID0gY2hpbGQ7CiAgcmV0dXJuIHBhcmFtczsKfQoKZnVuY3Rpb24gdm5vZGVIYXNQbGFjZUF0dHJpYnV0ZSh2bm9kZSkgewogIHJldHVybiBCb29sZWFuKHZub2RlLmRhdGEgJiYgdm5vZGUuZGF0YS5hdHRycyAmJiB2bm9kZS5kYXRhLmF0dHJzLnBsYWNlKTsKfQovKiAgKi8KCgp2YXIgbnVtYmVyQ29tcG9uZW50ID0gewogIG5hbWU6ICdpMThuLW4nLAogIGZ1bmN0aW9uYWw6IHRydWUsCiAgcHJvcHM6IHsKICAgIHRhZzogewogICAgICB0eXBlOiBbU3RyaW5nLCBCb29sZWFuLCBPYmplY3RdLAogICAgICAiZGVmYXVsdCI6ICdzcGFuJwogICAgfSwKICAgIHZhbHVlOiB7CiAgICAgIHR5cGU6IE51bWJlciwKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgIH0sCiAgICBmb3JtYXQ6IHsKICAgICAgdHlwZTogW1N0cmluZywgT2JqZWN0XQogICAgfSwKICAgIGxvY2FsZTogewogICAgICB0eXBlOiBTdHJpbmcKICAgIH0KICB9LAogIHJlbmRlcjogZnVuY3Rpb24gcmVuZGVyKGgsIHJlZikgewogICAgdmFyIHByb3BzID0gcmVmLnByb3BzOwogICAgdmFyIHBhcmVudCA9IHJlZi5wYXJlbnQ7CiAgICB2YXIgZGF0YSA9IHJlZi5kYXRhOwogICAgdmFyIGkxOG4gPSBwYXJlbnQuJGkxOG47CgogICAgaWYgKCFpMThuKSB7CiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICAgICAgd2FybignQ2Fubm90IGZpbmQgVnVlSTE4biBpbnN0YW5jZSEnKTsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CgogICAgdmFyIGtleSA9IG51bGw7CiAgICB2YXIgb3B0aW9ucyA9IG51bGw7CgogICAgaWYgKGlzU3RyaW5nKHByb3BzLmZvcm1hdCkpIHsKICAgICAga2V5ID0gcHJvcHMuZm9ybWF0OwogICAgfSBlbHNlIGlmIChpc09iamVjdChwcm9wcy5mb3JtYXQpKSB7CiAgICAgIGlmIChwcm9wcy5mb3JtYXQua2V5KSB7CiAgICAgICAga2V5ID0gcHJvcHMuZm9ybWF0LmtleTsKICAgICAgfSAvLyBGaWx0ZXIgb3V0IG51bWJlciBmb3JtYXQgb3B0aW9ucyBvbmx5CgoKICAgICAgb3B0aW9ucyA9IE9iamVjdC5rZXlzKHByb3BzLmZvcm1hdCkucmVkdWNlKGZ1bmN0aW9uIChhY2MsIHByb3ApIHsKICAgICAgICB2YXIgb2JqOwoKICAgICAgICBpZiAoaW5jbHVkZXMobnVtYmVyRm9ybWF0S2V5cywgcHJvcCkpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBhY2MsIChvYmogPSB7fSwgb2JqW3Byb3BdID0gcHJvcHMuZm9ybWF0W3Byb3BdLCBvYmopKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0sIG51bGwpOwogICAgfQoKICAgIHZhciBsb2NhbGUgPSBwcm9wcy5sb2NhbGUgfHwgaTE4bi5sb2NhbGU7CgogICAgdmFyIHBhcnRzID0gaTE4bi5fbnRwKHByb3BzLnZhbHVlLCBsb2NhbGUsIGtleSwgb3B0aW9ucyk7CgogICAgdmFyIHZhbHVlcyA9IHBhcnRzLm1hcChmdW5jdGlvbiAocGFydCwgaW5kZXgpIHsKICAgICAgdmFyIG9iajsKICAgICAgdmFyIHNsb3QgPSBkYXRhLnNjb3BlZFNsb3RzICYmIGRhdGEuc2NvcGVkU2xvdHNbcGFydC50eXBlXTsKICAgICAgcmV0dXJuIHNsb3QgPyBzbG90KChvYmogPSB7fSwgb2JqW3BhcnQudHlwZV0gPSBwYXJ0LnZhbHVlLCBvYmouaW5kZXggPSBpbmRleCwgb2JqLnBhcnRzID0gcGFydHMsIG9iaikpIDogcGFydC52YWx1ZTsKICAgIH0pOwogICAgdmFyIHRhZyA9ICEhcHJvcHMudGFnICYmIHByb3BzLnRhZyAhPT0gdHJ1ZSB8fCBwcm9wcy50YWcgPT09IGZhbHNlID8gcHJvcHMudGFnIDogJ3NwYW4nOwogICAgcmV0dXJuIHRhZyA/IGgodGFnLCB7CiAgICAgIGF0dHJzOiBkYXRhLmF0dHJzLAogICAgICAnY2xhc3MnOiBkYXRhWydjbGFzcyddLAogICAgICBzdGF0aWNDbGFzczogZGF0YS5zdGF0aWNDbGFzcwogICAgfSwgdmFsdWVzKSA6IHZhbHVlczsKICB9Cn07Ci8qICAqLwoKZnVuY3Rpb24gYmluZChlbCwgYmluZGluZywgdm5vZGUpIHsKICBpZiAoIWFzc2VydChlbCwgdm5vZGUpKSB7CiAgICByZXR1cm47CiAgfQoKICB0KGVsLCBiaW5kaW5nLCB2bm9kZSk7Cn0KCmZ1bmN0aW9uIHVwZGF0ZShlbCwgYmluZGluZywgdm5vZGUsIG9sZFZOb2RlKSB7CiAgaWYgKCFhc3NlcnQoZWwsIHZub2RlKSkgewogICAgcmV0dXJuOwogIH0KCiAgdmFyIGkxOG4gPSB2bm9kZS5jb250ZXh0LiRpMThuOwoKICBpZiAobG9jYWxlRXF1YWwoZWwsIHZub2RlKSAmJiBsb29zZUVxdWFsKGJpbmRpbmcudmFsdWUsIGJpbmRpbmcub2xkVmFsdWUpICYmIGxvb3NlRXF1YWwoZWwuX2xvY2FsZU1lc3NhZ2UsIGkxOG4uZ2V0TG9jYWxlTWVzc2FnZShpMThuLmxvY2FsZSkpKSB7CiAgICByZXR1cm47CiAgfQoKICB0KGVsLCBiaW5kaW5nLCB2bm9kZSk7Cn0KCmZ1bmN0aW9uIHVuYmluZChlbCwgYmluZGluZywgdm5vZGUsIG9sZFZOb2RlKSB7CiAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKCiAgaWYgKCF2bSkgewogICAgd2FybignVnVlIGluc3RhbmNlIGRvZXMgbm90IGV4aXN0cyBpbiBWTm9kZSBjb250ZXh0Jyk7CiAgICByZXR1cm47CiAgfQoKICB2YXIgaTE4biA9IHZub2RlLmNvbnRleHQuJGkxOG4gfHwge307CgogIGlmICghYmluZGluZy5tb2RpZmllcnMucHJlc2VydmUgJiYgIWkxOG4ucHJlc2VydmVEaXJlY3RpdmVDb250ZW50KSB7CiAgICBlbC50ZXh0Q29udGVudCA9ICcnOwogIH0KCiAgZWwuX3Z0ID0gdW5kZWZpbmVkOwogIGRlbGV0ZSBlbFsnX3Z0J107CiAgZWwuX2xvY2FsZSA9IHVuZGVmaW5lZDsKICBkZWxldGUgZWxbJ19sb2NhbGUnXTsKICBlbC5fbG9jYWxlTWVzc2FnZSA9IHVuZGVmaW5lZDsKICBkZWxldGUgZWxbJ19sb2NhbGVNZXNzYWdlJ107Cn0KCmZ1bmN0aW9uIGFzc2VydChlbCwgdm5vZGUpIHsKICB2YXIgdm0gPSB2bm9kZS5jb250ZXh0OwoKICBpZiAoIXZtKSB7CiAgICB3YXJuKCdWdWUgaW5zdGFuY2UgZG9lcyBub3QgZXhpc3RzIGluIFZOb2RlIGNvbnRleHQnKTsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGlmICghdm0uJGkxOG4pIHsKICAgIHdhcm4oJ1Z1ZUkxOG4gaW5zdGFuY2UgZG9lcyBub3QgZXhpc3RzIGluIFZ1ZSBpbnN0YW5jZScpOwogICAgcmV0dXJuIGZhbHNlOwogIH0KCiAgcmV0dXJuIHRydWU7Cn0KCmZ1bmN0aW9uIGxvY2FsZUVxdWFsKGVsLCB2bm9kZSkgewogIHZhciB2bSA9IHZub2RlLmNvbnRleHQ7CiAgcmV0dXJuIGVsLl9sb2NhbGUgPT09IHZtLiRpMThuLmxvY2FsZTsKfQoKZnVuY3Rpb24gdChlbCwgYmluZGluZywgdm5vZGUpIHsKICB2YXIgcmVmJDEsIHJlZiQyOwogIHZhciB2YWx1ZSA9IGJpbmRpbmcudmFsdWU7CiAgdmFyIHJlZiA9IHBhcnNlVmFsdWUodmFsdWUpOwogIHZhciBwYXRoID0gcmVmLnBhdGg7CiAgdmFyIGxvY2FsZSA9IHJlZi5sb2NhbGU7CiAgdmFyIGFyZ3MgPSByZWYuYXJnczsKICB2YXIgY2hvaWNlID0gcmVmLmNob2ljZTsKCiAgaWYgKCFwYXRoICYmICFsb2NhbGUgJiYgIWFyZ3MpIHsKICAgIHdhcm4oJ3ZhbHVlIHR5cGUgbm90IHN1cHBvcnRlZCcpOwogICAgcmV0dXJuOwogIH0KCiAgaWYgKCFwYXRoKSB7CiAgICB3YXJuKCdgcGF0aGAgaXMgcmVxdWlyZWQgaW4gdi10IGRpcmVjdGl2ZScpOwogICAgcmV0dXJuOwogIH0KCiAgdmFyIHZtID0gdm5vZGUuY29udGV4dDsKCiAgaWYgKGNob2ljZSAhPSBudWxsKSB7CiAgICBlbC5fdnQgPSBlbC50ZXh0Q29udGVudCA9IChyZWYkMSA9IHZtLiRpMThuKS50Yy5hcHBseShyZWYkMSwgW3BhdGgsIGNob2ljZV0uY29uY2F0KG1ha2VQYXJhbXMobG9jYWxlLCBhcmdzKSkpOwogIH0gZWxzZSB7CiAgICBlbC5fdnQgPSBlbC50ZXh0Q29udGVudCA9IChyZWYkMiA9IHZtLiRpMThuKS50LmFwcGx5KHJlZiQyLCBbcGF0aF0uY29uY2F0KG1ha2VQYXJhbXMobG9jYWxlLCBhcmdzKSkpOwogIH0KCiAgZWwuX2xvY2FsZSA9IHZtLiRpMThuLmxvY2FsZTsKICBlbC5fbG9jYWxlTWVzc2FnZSA9IHZtLiRpMThuLmdldExvY2FsZU1lc3NhZ2Uodm0uJGkxOG4ubG9jYWxlKTsKfQoKZnVuY3Rpb24gcGFyc2VWYWx1ZSh2YWx1ZSkgewogIHZhciBwYXRoOwogIHZhciBsb2NhbGU7CiAgdmFyIGFyZ3M7CiAgdmFyIGNob2ljZTsKCiAgaWYgKGlzU3RyaW5nKHZhbHVlKSkgewogICAgcGF0aCA9IHZhbHVlOwogIH0gZWxzZSBpZiAoaXNQbGFpbk9iamVjdCh2YWx1ZSkpIHsKICAgIHBhdGggPSB2YWx1ZS5wYXRoOwogICAgbG9jYWxlID0gdmFsdWUubG9jYWxlOwogICAgYXJncyA9IHZhbHVlLmFyZ3M7CiAgICBjaG9pY2UgPSB2YWx1ZS5jaG9pY2U7CiAgfQoKICByZXR1cm4gewogICAgcGF0aDogcGF0aCwKICAgIGxvY2FsZTogbG9jYWxlLAogICAgYXJnczogYXJncywKICAgIGNob2ljZTogY2hvaWNlCiAgfTsKfQoKZnVuY3Rpb24gbWFrZVBhcmFtcyhsb2NhbGUsIGFyZ3MpIHsKICB2YXIgcGFyYW1zID0gW107CiAgbG9jYWxlICYmIHBhcmFtcy5wdXNoKGxvY2FsZSk7CgogIGlmIChhcmdzICYmIChBcnJheS5pc0FycmF5KGFyZ3MpIHx8IGlzUGxhaW5PYmplY3QoYXJncykpKSB7CiAgICBwYXJhbXMucHVzaChhcmdzKTsKICB9CgogIHJldHVybiBwYXJhbXM7Cn0KCnZhciBWdWU7CgpmdW5jdGlvbiBpbnN0YWxsKF9WdWUpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiBpbnN0YWxsLmluc3RhbGxlZCAmJiBfVnVlID09PSBWdWUpIHsKICAgIHdhcm4oJ2FscmVhZHkgaW5zdGFsbGVkLicpOwogICAgcmV0dXJuOwogIH0KCiAgaW5zdGFsbC5pbnN0YWxsZWQgPSB0cnVlOwogIFZ1ZSA9IF9WdWU7CiAgdmFyIHZlcnNpb24gPSBWdWUudmVyc2lvbiAmJiBOdW1iZXIoVnVlLnZlcnNpb24uc3BsaXQoJy4nKVswXSkgfHwgLTE7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmIHZlcnNpb24gPCAyKSB7CiAgICB3YXJuKCJ2dWUtaTE4biAoIiArIGluc3RhbGwudmVyc2lvbiArICIpIG5lZWQgdG8gdXNlIFZ1ZSAyLjAgb3IgbGF0ZXIgKFZ1ZTogIiArIFZ1ZS52ZXJzaW9uICsgIikuIik7CiAgICByZXR1cm47CiAgfQoKICBleHRlbmQoVnVlKTsKICBWdWUubWl4aW4obWl4aW4pOwogIFZ1ZS5kaXJlY3RpdmUoJ3QnLCB7CiAgICBiaW5kOiBiaW5kLAogICAgdXBkYXRlOiB1cGRhdGUsCiAgICB1bmJpbmQ6IHVuYmluZAogIH0pOwogIFZ1ZS5jb21wb25lbnQoaW50ZXJwb2xhdGlvbkNvbXBvbmVudC5uYW1lLCBpbnRlcnBvbGF0aW9uQ29tcG9uZW50KTsKICBWdWUuY29tcG9uZW50KG51bWJlckNvbXBvbmVudC5uYW1lLCBudW1iZXJDb21wb25lbnQpOyAvLyB1c2Ugc2ltcGxlIG1lcmdlU3RyYXRlZ2llcyB0byBwcmV2ZW50IGkxOG4gaW5zdGFuY2UgbG9zZSAnX19wcm90b19fJwoKICB2YXIgc3RyYXRzID0gVnVlLmNvbmZpZy5vcHRpb25NZXJnZVN0cmF0ZWdpZXM7CgogIHN0cmF0cy5pMThuID0gZnVuY3Rpb24gKHBhcmVudFZhbCwgY2hpbGRWYWwpIHsKICAgIHJldHVybiBjaGlsZFZhbCA9PT0gdW5kZWZpbmVkID8gcGFyZW50VmFsIDogY2hpbGRWYWw7CiAgfTsKfQovKiAgKi8KCgp2YXIgQmFzZUZvcm1hdHRlciA9IGZ1bmN0aW9uIEJhc2VGb3JtYXR0ZXIoKSB7CiAgdGhpcy5fY2FjaGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKfTsKCkJhc2VGb3JtYXR0ZXIucHJvdG90eXBlLmludGVycG9sYXRlID0gZnVuY3Rpb24gaW50ZXJwb2xhdGUobWVzc2FnZSwgdmFsdWVzKSB7CiAgaWYgKCF2YWx1ZXMpIHsKICAgIHJldHVybiBbbWVzc2FnZV07CiAgfQoKICB2YXIgdG9rZW5zID0gdGhpcy5fY2FjaGVzW21lc3NhZ2VdOwoKICBpZiAoIXRva2VucykgewogICAgdG9rZW5zID0gcGFyc2UobWVzc2FnZSk7CiAgICB0aGlzLl9jYWNoZXNbbWVzc2FnZV0gPSB0b2tlbnM7CiAgfQoKICByZXR1cm4gY29tcGlsZSh0b2tlbnMsIHZhbHVlcyk7Cn07Cgp2YXIgUkVfVE9LRU5fTElTVF9WQUxVRSA9IC9eKD86XGQpKy87CnZhciBSRV9UT0tFTl9OQU1FRF9WQUxVRSA9IC9eKD86XHcpKy87CgpmdW5jdGlvbiBwYXJzZShmb3JtYXQpIHsKICB2YXIgdG9rZW5zID0gW107CiAgdmFyIHBvc2l0aW9uID0gMDsKICB2YXIgdGV4dCA9ICcnOwoKICB3aGlsZSAocG9zaXRpb24gPCBmb3JtYXQubGVuZ3RoKSB7CiAgICB2YXIgX2NoYXIgPSBmb3JtYXRbcG9zaXRpb24rK107CgogICAgaWYgKF9jaGFyID09PSAneycpIHsKICAgICAgaWYgKHRleHQpIHsKICAgICAgICB0b2tlbnMucHVzaCh7CiAgICAgICAgICB0eXBlOiAndGV4dCcsCiAgICAgICAgICB2YWx1ZTogdGV4dAogICAgICAgIH0pOwogICAgICB9CgogICAgICB0ZXh0ID0gJyc7CiAgICAgIHZhciBzdWIgPSAnJzsKICAgICAgX2NoYXIgPSBmb3JtYXRbcG9zaXRpb24rK107CgogICAgICB3aGlsZSAoX2NoYXIgIT09IHVuZGVmaW5lZCAmJiBfY2hhciAhPT0gJ30nKSB7CiAgICAgICAgc3ViICs9IF9jaGFyOwogICAgICAgIF9jaGFyID0gZm9ybWF0W3Bvc2l0aW9uKytdOwogICAgICB9CgogICAgICB2YXIgaXNDbG9zZWQgPSBfY2hhciA9PT0gJ30nOwogICAgICB2YXIgdHlwZSA9IFJFX1RPS0VOX0xJU1RfVkFMVUUudGVzdChzdWIpID8gJ2xpc3QnIDogaXNDbG9zZWQgJiYgUkVfVE9LRU5fTkFNRURfVkFMVUUudGVzdChzdWIpID8gJ25hbWVkJyA6ICd1bmtub3duJzsKICAgICAgdG9rZW5zLnB1c2goewogICAgICAgIHZhbHVlOiBzdWIsCiAgICAgICAgdHlwZTogdHlwZQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoX2NoYXIgPT09ICclJykgewogICAgICAvLyB3aGVuIGZvdW5kIHJhaWxzIGkxOG4gc3ludGF4LCBza2lwIHRleHQgY2FwdHVyZQogICAgICBpZiAoZm9ybWF0W3Bvc2l0aW9uXSAhPT0gJ3snKSB7CiAgICAgICAgdGV4dCArPSBfY2hhcjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGV4dCArPSBfY2hhcjsKICAgIH0KICB9CgogIHRleHQgJiYgdG9rZW5zLnB1c2goewogICAgdHlwZTogJ3RleHQnLAogICAgdmFsdWU6IHRleHQKICB9KTsKICByZXR1cm4gdG9rZW5zOwp9CgpmdW5jdGlvbiBjb21waWxlKHRva2VucywgdmFsdWVzKSB7CiAgdmFyIGNvbXBpbGVkID0gW107CiAgdmFyIGluZGV4ID0gMDsKICB2YXIgbW9kZSA9IEFycmF5LmlzQXJyYXkodmFsdWVzKSA/ICdsaXN0JyA6IGlzT2JqZWN0KHZhbHVlcykgPyAnbmFtZWQnIDogJ3Vua25vd24nOwoKICBpZiAobW9kZSA9PT0gJ3Vua25vd24nKSB7CiAgICByZXR1cm4gY29tcGlsZWQ7CiAgfQoKICB3aGlsZSAoaW5kZXggPCB0b2tlbnMubGVuZ3RoKSB7CiAgICB2YXIgdG9rZW4gPSB0b2tlbnNbaW5kZXhdOwoKICAgIHN3aXRjaCAodG9rZW4udHlwZSkgewogICAgICBjYXNlICd0ZXh0JzoKICAgICAgICBjb21waWxlZC5wdXNoKHRva2VuLnZhbHVlKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ2xpc3QnOgogICAgICAgIGNvbXBpbGVkLnB1c2godmFsdWVzW3BhcnNlSW50KHRva2VuLnZhbHVlLCAxMCldKTsKICAgICAgICBicmVhazsKCiAgICAgIGNhc2UgJ25hbWVkJzoKICAgICAgICBpZiAobW9kZSA9PT0gJ25hbWVkJykgewogICAgICAgICAgY29tcGlsZWQucHVzaCh2YWx1ZXNbdG9rZW4udmFsdWVdKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICAgICAgd2FybigiVHlwZSBvZiB0b2tlbiAnIiArIHRva2VuLnR5cGUgKyAiJyBhbmQgZm9ybWF0IG9mIHZhbHVlICciICsgbW9kZSArICInIGRvbid0IG1hdGNoISIpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CgogICAgICBjYXNlICd1bmtub3duJzoKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICAgICAgd2FybigiRGV0ZWN0ICd1bmtub3duJyB0eXBlIG9mIHRva2VuISIpOwogICAgICAgIH0KCiAgICAgICAgYnJlYWs7CiAgICB9CgogICAgaW5kZXgrKzsKICB9CgogIHJldHVybiBjb21waWxlZDsKfQovKiAgKi8KCi8qKgogKiAgUGF0aCBwYXJzZXIKICogIC0gSW5zcGlyZWQ6CiAqICAgIFZ1ZS5qcyBQYXRoIHBhcnNlcgogKi8KLy8gYWN0aW9ucwoKCnZhciBBUFBFTkQgPSAwOwp2YXIgUFVTSCA9IDE7CnZhciBJTkNfU1VCX1BBVEhfREVQVEggPSAyOwp2YXIgUFVTSF9TVUJfUEFUSCA9IDM7IC8vIHN0YXRlcwoKdmFyIEJFRk9SRV9QQVRIID0gMDsKdmFyIElOX1BBVEggPSAxOwp2YXIgQkVGT1JFX0lERU5UID0gMjsKdmFyIElOX0lERU5UID0gMzsKdmFyIElOX1NVQl9QQVRIID0gNDsKdmFyIElOX1NJTkdMRV9RVU9URSA9IDU7CnZhciBJTl9ET1VCTEVfUVVPVEUgPSA2Owp2YXIgQUZURVJfUEFUSCA9IDc7CnZhciBFUlJPUiA9IDg7CnZhciBwYXRoU3RhdGVNYWNoaW5lID0gW107CnBhdGhTdGF0ZU1hY2hpbmVbQkVGT1JFX1BBVEhdID0gewogICd3cyc6IFtCRUZPUkVfUEFUSF0sCiAgJ2lkZW50JzogW0lOX0lERU5ULCBBUFBFTkRdLAogICdbJzogW0lOX1NVQl9QQVRIXSwKICAnZW9mJzogW0FGVEVSX1BBVEhdCn07CnBhdGhTdGF0ZU1hY2hpbmVbSU5fUEFUSF0gPSB7CiAgJ3dzJzogW0lOX1BBVEhdLAogICcuJzogW0JFRk9SRV9JREVOVF0sCiAgJ1snOiBbSU5fU1VCX1BBVEhdLAogICdlb2YnOiBbQUZURVJfUEFUSF0KfTsKcGF0aFN0YXRlTWFjaGluZVtCRUZPUkVfSURFTlRdID0gewogICd3cyc6IFtCRUZPUkVfSURFTlRdLAogICdpZGVudCc6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAnMCc6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAnbnVtYmVyJzogW0lOX0lERU5ULCBBUFBFTkRdCn07CnBhdGhTdGF0ZU1hY2hpbmVbSU5fSURFTlRdID0gewogICdpZGVudCc6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAnMCc6IFtJTl9JREVOVCwgQVBQRU5EXSwKICAnbnVtYmVyJzogW0lOX0lERU5ULCBBUFBFTkRdLAogICd3cyc6IFtJTl9QQVRILCBQVVNIXSwKICAnLic6IFtCRUZPUkVfSURFTlQsIFBVU0hdLAogICdbJzogW0lOX1NVQl9QQVRILCBQVVNIXSwKICAnZW9mJzogW0FGVEVSX1BBVEgsIFBVU0hdCn07CnBhdGhTdGF0ZU1hY2hpbmVbSU5fU1VCX1BBVEhdID0gewogICInIjogW0lOX1NJTkdMRV9RVU9URSwgQVBQRU5EXSwKICAnIic6IFtJTl9ET1VCTEVfUVVPVEUsIEFQUEVORF0sCiAgJ1snOiBbSU5fU1VCX1BBVEgsIElOQ19TVUJfUEFUSF9ERVBUSF0sCiAgJ10nOiBbSU5fUEFUSCwgUFVTSF9TVUJfUEFUSF0sCiAgJ2VvZic6IEVSUk9SLAogICdlbHNlJzogW0lOX1NVQl9QQVRILCBBUFBFTkRdCn07CnBhdGhTdGF0ZU1hY2hpbmVbSU5fU0lOR0xFX1FVT1RFXSA9IHsKICAiJyI6IFtJTl9TVUJfUEFUSCwgQVBQRU5EXSwKICAnZW9mJzogRVJST1IsCiAgJ2Vsc2UnOiBbSU5fU0lOR0xFX1FVT1RFLCBBUFBFTkRdCn07CnBhdGhTdGF0ZU1hY2hpbmVbSU5fRE9VQkxFX1FVT1RFXSA9IHsKICAnIic6IFtJTl9TVUJfUEFUSCwgQVBQRU5EXSwKICAnZW9mJzogRVJST1IsCiAgJ2Vsc2UnOiBbSU5fRE9VQkxFX1FVT1RFLCBBUFBFTkRdCn07Ci8qKgogKiBDaGVjayBpZiBhbiBleHByZXNzaW9uIGlzIGEgbGl0ZXJhbCB2YWx1ZS4KICovCgp2YXIgbGl0ZXJhbFZhbHVlUkUgPSAvXlxzPyg/OnRydWV8ZmFsc2V8LT9bXGQuXSt8J1teJ10qJ3wiW14iXSoiKVxzPyQvOwoKZnVuY3Rpb24gaXNMaXRlcmFsKGV4cCkgewogIHJldHVybiBsaXRlcmFsVmFsdWVSRS50ZXN0KGV4cCk7Cn0KLyoqCiAqIFN0cmlwIHF1b3RlcyBmcm9tIGEgc3RyaW5nCiAqLwoKCmZ1bmN0aW9uIHN0cmlwUXVvdGVzKHN0cikgewogIHZhciBhID0gc3RyLmNoYXJDb2RlQXQoMCk7CiAgdmFyIGIgPSBzdHIuY2hhckNvZGVBdChzdHIubGVuZ3RoIC0gMSk7CiAgcmV0dXJuIGEgPT09IGIgJiYgKGEgPT09IDB4MjIgfHwgYSA9PT0gMHgyNykgPyBzdHIuc2xpY2UoMSwgLTEpIDogc3RyOwp9Ci8qKgogKiBEZXRlcm1pbmUgdGhlIHR5cGUgb2YgYSBjaGFyYWN0ZXIgaW4gYSBrZXlwYXRoLgogKi8KCgpmdW5jdGlvbiBnZXRQYXRoQ2hhclR5cGUoY2gpIHsKICBpZiAoY2ggPT09IHVuZGVmaW5lZCB8fCBjaCA9PT0gbnVsbCkgewogICAgcmV0dXJuICdlb2YnOwogIH0KCiAgdmFyIGNvZGUgPSBjaC5jaGFyQ29kZUF0KDApOwoKICBzd2l0Y2ggKGNvZGUpIHsKICAgIGNhc2UgMHg1QjogLy8gWwoKICAgIGNhc2UgMHg1RDogLy8gXQoKICAgIGNhc2UgMHgyRTogLy8gLgoKICAgIGNhc2UgMHgyMjogLy8gIgoKICAgIGNhc2UgMHgyNzoKICAgICAgLy8gJwogICAgICByZXR1cm4gY2g7CgogICAgY2FzZSAweDVGOiAvLyBfCgogICAgY2FzZSAweDI0OiAvLyAkCgogICAgY2FzZSAweDJEOgogICAgICAvLyAtCiAgICAgIHJldHVybiAnaWRlbnQnOwoKICAgIGNhc2UgMHgwOTogLy8gVGFiCgogICAgY2FzZSAweDBBOiAvLyBOZXdsaW5lCgogICAgY2FzZSAweDBEOiAvLyBSZXR1cm4KCiAgICBjYXNlIDB4QTA6IC8vIE5vLWJyZWFrIHNwYWNlCgogICAgY2FzZSAweEZFRkY6IC8vIEJ5dGUgT3JkZXIgTWFyawoKICAgIGNhc2UgMHgyMDI4OiAvLyBMaW5lIFNlcGFyYXRvcgoKICAgIGNhc2UgMHgyMDI5OgogICAgICAvLyBQYXJhZ3JhcGggU2VwYXJhdG9yCiAgICAgIHJldHVybiAnd3MnOwogIH0KCiAgcmV0dXJuICdpZGVudCc7Cn0KLyoqCiAqIEZvcm1hdCBhIHN1YlBhdGgsIHJldHVybiBpdHMgcGxhaW4gZm9ybSBpZiBpdCBpcwogKiBhIGxpdGVyYWwgc3RyaW5nIG9yIG51bWJlci4gT3RoZXJ3aXNlIHByZXBlbmQgdGhlCiAqIGR5bmFtaWMgaW5kaWNhdG9yICgqKS4KICovCgoKZnVuY3Rpb24gZm9ybWF0U3ViUGF0aChwYXRoKSB7CiAgdmFyIHRyaW1tZWQgPSBwYXRoLnRyaW0oKTsgLy8gaW52YWxpZCBsZWFkaW5nIDAKCiAgaWYgKHBhdGguY2hhckF0KDApID09PSAnMCcgJiYgaXNOYU4ocGF0aCkpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiBpc0xpdGVyYWwodHJpbW1lZCkgPyBzdHJpcFF1b3Rlcyh0cmltbWVkKSA6ICcqJyArIHRyaW1tZWQ7Cn0KLyoqCiAqIFBhcnNlIGEgc3RyaW5nIHBhdGggaW50byBhbiBhcnJheSBvZiBzZWdtZW50cwogKi8KCgpmdW5jdGlvbiBwYXJzZSQxKHBhdGgpIHsKICB2YXIga2V5cyA9IFtdOwogIHZhciBpbmRleCA9IC0xOwogIHZhciBtb2RlID0gQkVGT1JFX1BBVEg7CiAgdmFyIHN1YlBhdGhEZXB0aCA9IDA7CiAgdmFyIGM7CiAgdmFyIGtleTsKICB2YXIgbmV3Q2hhcjsKICB2YXIgdHlwZTsKICB2YXIgdHJhbnNpdGlvbjsKICB2YXIgYWN0aW9uOwogIHZhciB0eXBlTWFwOwogIHZhciBhY3Rpb25zID0gW107CgogIGFjdGlvbnNbUFVTSF0gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoa2V5ICE9PSB1bmRlZmluZWQpIHsKICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgIGtleSA9IHVuZGVmaW5lZDsKICAgIH0KICB9OwoKICBhY3Rpb25zW0FQUEVORF0gPSBmdW5jdGlvbiAoKSB7CiAgICBpZiAoa2V5ID09PSB1bmRlZmluZWQpIHsKICAgICAga2V5ID0gbmV3Q2hhcjsKICAgIH0gZWxzZSB7CiAgICAgIGtleSArPSBuZXdDaGFyOwogICAgfQogIH07CgogIGFjdGlvbnNbSU5DX1NVQl9QQVRIX0RFUFRIXSA9IGZ1bmN0aW9uICgpIHsKICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgc3ViUGF0aERlcHRoKys7CiAgfTsKCiAgYWN0aW9uc1tQVVNIX1NVQl9QQVRIXSA9IGZ1bmN0aW9uICgpIHsKICAgIGlmIChzdWJQYXRoRGVwdGggPiAwKSB7CiAgICAgIHN1YlBhdGhEZXB0aC0tOwogICAgICBtb2RlID0gSU5fU1VCX1BBVEg7CiAgICAgIGFjdGlvbnNbQVBQRU5EXSgpOwogICAgfSBlbHNlIHsKICAgICAgc3ViUGF0aERlcHRoID0gMDsKCiAgICAgIGlmIChrZXkgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAga2V5ID0gZm9ybWF0U3ViUGF0aChrZXkpOwoKICAgICAgaWYgKGtleSA9PT0gZmFsc2UpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWN0aW9uc1tQVVNIXSgpOwogICAgICB9CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gbWF5YmVVbmVzY2FwZVF1b3RlKCkgewogICAgdmFyIG5leHRDaGFyID0gcGF0aFtpbmRleCArIDFdOwoKICAgIGlmIChtb2RlID09PSBJTl9TSU5HTEVfUVVPVEUgJiYgbmV4dENoYXIgPT09ICInIiB8fCBtb2RlID09PSBJTl9ET1VCTEVfUVVPVEUgJiYgbmV4dENoYXIgPT09ICciJykgewogICAgICBpbmRleCsrOwogICAgICBuZXdDaGFyID0gJ1xcJyArIG5leHRDaGFyOwogICAgICBhY3Rpb25zW0FQUEVORF0oKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgfQoKICB3aGlsZSAobW9kZSAhPT0gbnVsbCkgewogICAgaW5kZXgrKzsKICAgIGMgPSBwYXRoW2luZGV4XTsKCiAgICBpZiAoYyA9PT0gJ1xcJyAmJiBtYXliZVVuZXNjYXBlUXVvdGUoKSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICB0eXBlID0gZ2V0UGF0aENoYXJUeXBlKGMpOwogICAgdHlwZU1hcCA9IHBhdGhTdGF0ZU1hY2hpbmVbbW9kZV07CiAgICB0cmFuc2l0aW9uID0gdHlwZU1hcFt0eXBlXSB8fCB0eXBlTWFwWydlbHNlJ10gfHwgRVJST1I7CgogICAgaWYgKHRyYW5zaXRpb24gPT09IEVSUk9SKSB7CiAgICAgIHJldHVybjsgLy8gcGFyc2UgZXJyb3IKICAgIH0KCiAgICBtb2RlID0gdHJhbnNpdGlvblswXTsKICAgIGFjdGlvbiA9IGFjdGlvbnNbdHJhbnNpdGlvblsxXV07CgogICAgaWYgKGFjdGlvbikgewogICAgICBuZXdDaGFyID0gdHJhbnNpdGlvblsyXTsKICAgICAgbmV3Q2hhciA9IG5ld0NoYXIgPT09IHVuZGVmaW5lZCA/IGMgOiBuZXdDaGFyOwoKICAgICAgaWYgKGFjdGlvbigpID09PSBmYWxzZSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgfQoKICAgIGlmIChtb2RlID09PSBBRlRFUl9QQVRIKSB7CiAgICAgIHJldHVybiBrZXlzOwogICAgfQogIH0KfQoKdmFyIEkxOG5QYXRoID0gZnVuY3Rpb24gSTE4blBhdGgoKSB7CiAgdGhpcy5fY2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwp9OwovKioKICogRXh0ZXJuYWwgcGFyc2UgdGhhdCBjaGVjayBmb3IgYSBjYWNoZSBoaXQgZmlyc3QKICovCgoKSTE4blBhdGgucHJvdG90eXBlLnBhcnNlUGF0aCA9IGZ1bmN0aW9uIHBhcnNlUGF0aChwYXRoKSB7CiAgdmFyIGhpdCA9IHRoaXMuX2NhY2hlW3BhdGhdOwoKICBpZiAoIWhpdCkgewogICAgaGl0ID0gcGFyc2UkMShwYXRoKTsKCiAgICBpZiAoaGl0KSB7CiAgICAgIHRoaXMuX2NhY2hlW3BhdGhdID0gaGl0OwogICAgfQogIH0KCiAgcmV0dXJuIGhpdCB8fCBbXTsKfTsKLyoqCiAqIEdldCBwYXRoIHZhbHVlIGZyb20gcGF0aCBzdHJpbmcKICovCgoKSTE4blBhdGgucHJvdG90eXBlLmdldFBhdGhWYWx1ZSA9IGZ1bmN0aW9uIGdldFBhdGhWYWx1ZShvYmosIHBhdGgpIHsKICBpZiAoIWlzT2JqZWN0KG9iaikpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgdmFyIHBhdGhzID0gdGhpcy5wYXJzZVBhdGgocGF0aCk7CgogIGlmIChwYXRocy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBudWxsOwogIH0gZWxzZSB7CiAgICB2YXIgbGVuZ3RoID0gcGF0aHMubGVuZ3RoOwogICAgdmFyIGxhc3QgPSBvYmo7CiAgICB2YXIgaSA9IDA7CgogICAgd2hpbGUgKGkgPCBsZW5ndGgpIHsKICAgICAgdmFyIHZhbHVlID0gbGFzdFtwYXRoc1tpXV07CgogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CgogICAgICBsYXN0ID0gdmFsdWU7CiAgICAgIGkrKzsKICAgIH0KCiAgICByZXR1cm4gbGFzdDsKICB9Cn07Ci8qICAqLwoKCnZhciBodG1sVGFnTWF0Y2hlciA9IC88XC8/W1x3XHM9Ii8uJzo7Iy1cL10rPi87CnZhciBsaW5rS2V5TWF0Y2hlciA9IC8oPzpAKD86XC5bYS16XSspPzooPzpbXHdcLV98Ll0rfFwoW1x3XC1ffC5dK1wpKSkvZzsKdmFyIGxpbmtLZXlQcmVmaXhNYXRjaGVyID0gL15AKD86XC4oW2Etel0rKSk/Oi87CnZhciBicmFja2V0c01hdGNoZXIgPSAvWygpXS9nOwp2YXIgZGVmYXVsdE1vZGlmaWVycyA9IHsKICAndXBwZXInOiBmdW5jdGlvbiB1cHBlcihzdHIpIHsKICAgIHJldHVybiBzdHIudG9Mb2NhbGVVcHBlckNhc2UoKTsKICB9LAogICdsb3dlcic6IGZ1bmN0aW9uIGxvd2VyKHN0cikgewogICAgcmV0dXJuIHN0ci50b0xvY2FsZUxvd2VyQ2FzZSgpOwogIH0sCiAgJ2NhcGl0YWxpemUnOiBmdW5jdGlvbiBjYXBpdGFsaXplKHN0cikgewogICAgcmV0dXJuICIiICsgc3RyLmNoYXJBdCgwKS50b0xvY2FsZVVwcGVyQ2FzZSgpICsgc3RyLnN1YnN0cigxKTsKICB9Cn07CnZhciBkZWZhdWx0Rm9ybWF0dGVyID0gbmV3IEJhc2VGb3JtYXR0ZXIoKTsKCnZhciBWdWVJMThuID0gZnVuY3Rpb24gVnVlSTE4bihvcHRpb25zKSB7CiAgdmFyIHRoaXMkMSA9IHRoaXM7CiAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgb3B0aW9ucyA9IHt9OyAvLyBBdXRvIGluc3RhbGwgaWYgaXQgaXMgbm90IGRvbmUgeWV0IGFuZCBgd2luZG93YCBoYXMgYFZ1ZWAuCiAgLy8gVG8gYWxsb3cgdXNlcnMgdG8gYXZvaWQgYXV0by1pbnN0YWxsYXRpb24gaW4gc29tZSBjYXNlcywKICAvLyB0aGlzIGNvZGUgc2hvdWxkIGJlIHBsYWNlZCBoZXJlLiBTZWUgIzI5MAoKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCiAgaWYgKCFWdWUgJiYgdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZ1ZSkgewogICAgaW5zdGFsbCh3aW5kb3cuVnVlKTsKICB9CgogIHZhciBsb2NhbGUgPSBvcHRpb25zLmxvY2FsZSB8fCAnZW4tVVMnOwogIHZhciBmYWxsYmFja0xvY2FsZSA9IG9wdGlvbnMuZmFsbGJhY2tMb2NhbGUgPT09IGZhbHNlID8gZmFsc2UgOiBvcHRpb25zLmZhbGxiYWNrTG9jYWxlIHx8ICdlbi1VUyc7CiAgdmFyIG1lc3NhZ2VzID0gb3B0aW9ucy5tZXNzYWdlcyB8fCB7fTsKICB2YXIgZGF0ZVRpbWVGb3JtYXRzID0gb3B0aW9ucy5kYXRlVGltZUZvcm1hdHMgfHwge307CiAgdmFyIG51bWJlckZvcm1hdHMgPSBvcHRpb25zLm51bWJlckZvcm1hdHMgfHwge307CiAgdGhpcy5fdm0gPSBudWxsOwogIHRoaXMuX2Zvcm1hdHRlciA9IG9wdGlvbnMuZm9ybWF0dGVyIHx8IGRlZmF1bHRGb3JtYXR0ZXI7CiAgdGhpcy5fbW9kaWZpZXJzID0gb3B0aW9ucy5tb2RpZmllcnMgfHwge307CiAgdGhpcy5fbWlzc2luZyA9IG9wdGlvbnMubWlzc2luZyB8fCBudWxsOwogIHRoaXMuX3Jvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICB0aGlzLl9zeW5jID0gb3B0aW9ucy5zeW5jID09PSB1bmRlZmluZWQgPyB0cnVlIDogISFvcHRpb25zLnN5bmM7CiAgdGhpcy5fZmFsbGJhY2tSb290ID0gb3B0aW9ucy5mYWxsYmFja1Jvb3QgPT09IHVuZGVmaW5lZCA/IHRydWUgOiAhIW9wdGlvbnMuZmFsbGJhY2tSb290OwogIHRoaXMuX2Zvcm1hdEZhbGxiYWNrTWVzc2FnZXMgPSBvcHRpb25zLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXMgPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogISFvcHRpb25zLmZvcm1hdEZhbGxiYWNrTWVzc2FnZXM7CiAgdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuID0gb3B0aW9ucy5zaWxlbnRUcmFuc2xhdGlvbldhcm4gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogb3B0aW9ucy5zaWxlbnRUcmFuc2xhdGlvbldhcm47CiAgdGhpcy5fc2lsZW50RmFsbGJhY2tXYXJuID0gb3B0aW9ucy5zaWxlbnRGYWxsYmFja1dhcm4gPT09IHVuZGVmaW5lZCA/IGZhbHNlIDogISFvcHRpb25zLnNpbGVudEZhbGxiYWNrV2FybjsKICB0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnMgPSB7fTsKICB0aGlzLl9udW1iZXJGb3JtYXR0ZXJzID0ge307CiAgdGhpcy5fcGF0aCA9IG5ldyBJMThuUGF0aCgpOwogIHRoaXMuX2RhdGFMaXN0ZW5lcnMgPSBbXTsKICB0aGlzLl9jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lciA9IG9wdGlvbnMuY29tcG9uZW50SW5zdGFuY2VDcmVhdGVkTGlzdGVuZXIgfHwgbnVsbDsKICB0aGlzLl9wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQgPSBvcHRpb25zLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudCA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOiAhIW9wdGlvbnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50OwogIHRoaXMucGx1cmFsaXphdGlvblJ1bGVzID0gb3B0aW9ucy5wbHVyYWxpemF0aW9uUnVsZXMgfHwge307CiAgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPSBvcHRpb25zLndhcm5IdG1sSW5NZXNzYWdlIHx8ICdvZmYnOwogIHRoaXMuX3Bvc3RUcmFuc2xhdGlvbiA9IG9wdGlvbnMucG9zdFRyYW5zbGF0aW9uIHx8IG51bGw7CiAgdGhpcy5fZXNjYXBlUGFyYW1ldGVySHRtbCA9IG9wdGlvbnMuZXNjYXBlUGFyYW1ldGVySHRtbCB8fCBmYWxzZTsKICAvKioKICAgKiBAcGFyYW0gY2hvaWNlIHtudW1iZXJ9IGEgY2hvaWNlIGluZGV4IGdpdmVuIGJ5IHRoZSBpbnB1dCB0byAkdGM6IGAkdGMoJ3BhdGgudG8ucnVsZScsIGNob2ljZUluZGV4KWAKICAgKiBAcGFyYW0gY2hvaWNlc0xlbmd0aCB7bnVtYmVyfSBhbiBvdmVyYWxsIGFtb3VudCBvZiBhdmFpbGFibGUgY2hvaWNlcwogICAqIEByZXR1cm5zIGEgZmluYWwgY2hvaWNlIGluZGV4CiAgKi8KCiAgdGhpcy5nZXRDaG9pY2VJbmRleCA9IGZ1bmN0aW9uIChjaG9pY2UsIGNob2ljZXNMZW5ndGgpIHsKICAgIHZhciB0aGlzUHJvdG90eXBlID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMkMSk7CgogICAgaWYgKHRoaXNQcm90b3R5cGUgJiYgdGhpc1Byb3RvdHlwZS5nZXRDaG9pY2VJbmRleCkgewogICAgICB2YXIgcHJvdG90eXBlR2V0Q2hvaWNlSW5kZXggPSB0aGlzUHJvdG90eXBlLmdldENob2ljZUluZGV4OwogICAgICByZXR1cm4gcHJvdG90eXBlR2V0Q2hvaWNlSW5kZXguY2FsbCh0aGlzJDEsIGNob2ljZSwgY2hvaWNlc0xlbmd0aCk7CiAgICB9IC8vIERlZmF1bHQgKG9sZCkgZ2V0Q2hvaWNlSW5kZXggaW1wbGVtZW50YXRpb24gLSBlbmdsaXNoLWNvbXBhdGlibGUKCgogICAgdmFyIGRlZmF1bHRJbXBsID0gZnVuY3Rpb24gZGVmYXVsdEltcGwoX2Nob2ljZSwgX2Nob2ljZXNMZW5ndGgpIHsKICAgICAgX2Nob2ljZSA9IE1hdGguYWJzKF9jaG9pY2UpOwoKICAgICAgaWYgKF9jaG9pY2VzTGVuZ3RoID09PSAyKSB7CiAgICAgICAgcmV0dXJuIF9jaG9pY2UgPyBfY2hvaWNlID4gMSA/IDEgOiAwIDogMTsKICAgICAgfQoKICAgICAgcmV0dXJuIF9jaG9pY2UgPyBNYXRoLm1pbihfY2hvaWNlLCAyKSA6IDA7CiAgICB9OwoKICAgIGlmICh0aGlzJDEubG9jYWxlIGluIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXMpIHsKICAgICAgcmV0dXJuIHRoaXMkMS5wbHVyYWxpemF0aW9uUnVsZXNbdGhpcyQxLmxvY2FsZV0uYXBwbHkodGhpcyQxLCBbY2hvaWNlLCBjaG9pY2VzTGVuZ3RoXSk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gZGVmYXVsdEltcGwoY2hvaWNlLCBjaG9pY2VzTGVuZ3RoKTsKICAgIH0KICB9OwoKICB0aGlzLl9leGlzdCA9IGZ1bmN0aW9uIChtZXNzYWdlLCBrZXkpIHsKICAgIGlmICghbWVzc2FnZSB8fCAha2V5KSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KCiAgICBpZiAoIWlzTnVsbCh0aGlzJDEuX3BhdGguZ2V0UGF0aFZhbHVlKG1lc3NhZ2UsIGtleSkpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfSAvLyBmYWxsYmFjayBmb3IgZmxhdCBrZXkKCgogICAgaWYgKG1lc3NhZ2Vba2V5XSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICByZXR1cm4gZmFsc2U7CiAgfTsKCiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgdGhpcyQxLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzJDEuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlc1tsb2NhbGVdKTsKICAgIH0pOwogIH0KCiAgdGhpcy5faW5pdFZNKHsKICAgIGxvY2FsZTogbG9jYWxlLAogICAgZmFsbGJhY2tMb2NhbGU6IGZhbGxiYWNrTG9jYWxlLAogICAgbWVzc2FnZXM6IG1lc3NhZ2VzLAogICAgZGF0ZVRpbWVGb3JtYXRzOiBkYXRlVGltZUZvcm1hdHMsCiAgICBudW1iZXJGb3JtYXRzOiBudW1iZXJGb3JtYXRzCiAgfSk7Cn07Cgp2YXIgcHJvdG90eXBlQWNjZXNzb3JzID0gewogIHZtOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIG1lc3NhZ2VzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGRhdGVUaW1lRm9ybWF0czogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBudW1iZXJGb3JtYXRzOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGF2YWlsYWJsZUxvY2FsZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZhbGxiYWNrTG9jYWxlOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIGZvcm1hdEZhbGxiYWNrTWVzc2FnZXM6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgbWlzc2luZzogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBmb3JtYXR0ZXI6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgc2lsZW50VHJhbnNsYXRpb25XYXJuOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9LAogIHNpbGVudEZhbGxiYWNrV2FybjogewogICAgY29uZmlndXJhYmxlOiB0cnVlCiAgfSwKICBwcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQ6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgd2Fybkh0bWxJbk1lc3NhZ2U6IHsKICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogIH0sCiAgcG9zdFRyYW5zbGF0aW9uOiB7CiAgICBjb25maWd1cmFibGU6IHRydWUKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fY2hlY2tMb2NhbGVNZXNzYWdlID0gZnVuY3Rpb24gX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIGxldmVsLCBtZXNzYWdlKSB7CiAgdmFyIHBhdGhzID0gW107CgogIHZhciBmbiA9IGZ1bmN0aW9uIGZuKGxldmVsLCBsb2NhbGUsIG1lc3NhZ2UsIHBhdGhzKSB7CiAgICBpZiAoaXNQbGFpbk9iamVjdChtZXNzYWdlKSkgewogICAgICBPYmplY3Qua2V5cyhtZXNzYWdlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICB2YXIgdmFsID0gbWVzc2FnZVtrZXldOwoKICAgICAgICBpZiAoaXNQbGFpbk9iamVjdCh2YWwpKSB7CiAgICAgICAgICBwYXRocy5wdXNoKGtleSk7CiAgICAgICAgICBwYXRocy5wdXNoKCcuJyk7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCB2YWwsIHBhdGhzKTsKICAgICAgICAgIHBhdGhzLnBvcCgpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHBhdGhzLnB1c2goa2V5KTsKICAgICAgICAgIGZuKGxldmVsLCBsb2NhbGUsIHZhbCwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAoaXNBcnJheShtZXNzYWdlKSkgewogICAgICBtZXNzYWdlLmZvckVhY2goZnVuY3Rpb24gKGl0ZW0sIGluZGV4KSB7CiAgICAgICAgaWYgKGlzUGxhaW5PYmplY3QoaXRlbSkpIHsKICAgICAgICAgIHBhdGhzLnB1c2goIlsiICsgaW5kZXggKyAiXSIpOwogICAgICAgICAgcGF0aHMucHVzaCgnLicpOwogICAgICAgICAgZm4obGV2ZWwsIGxvY2FsZSwgaXRlbSwgcGF0aHMpOwogICAgICAgICAgcGF0aHMucG9wKCk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcGF0aHMucHVzaCgiWyIgKyBpbmRleCArICJdIik7CiAgICAgICAgICBmbihsZXZlbCwgbG9jYWxlLCBpdGVtLCBwYXRocyk7CiAgICAgICAgICBwYXRocy5wb3AoKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIGlmIChpc1N0cmluZyhtZXNzYWdlKSkgewogICAgICB2YXIgcmV0ID0gaHRtbFRhZ01hdGNoZXIudGVzdChtZXNzYWdlKTsKCiAgICAgIGlmIChyZXQpIHsKICAgICAgICB2YXIgbXNnID0gIkRldGVjdGVkIEhUTUwgaW4gbWVzc2FnZSAnIiArIG1lc3NhZ2UgKyAiJyBvZiBrZXlwYXRoICciICsgcGF0aHMuam9pbignJykgKyAiJyBhdCAnIiArIGxvY2FsZSArICInLiBDb25zaWRlciBjb21wb25lbnQgaW50ZXJwb2xhdGlvbiB3aXRoICc8aTE4bj4nIHRvIGF2b2lkIFhTUy4gU2VlIGh0dHBzOi8vYml0Lmx5LzJacUp6a3AiOwoKICAgICAgICBpZiAobGV2ZWwgPT09ICd3YXJuJykgewogICAgICAgICAgd2Fybihtc2cpOwogICAgICAgIH0gZWxzZSBpZiAobGV2ZWwgPT09ICdlcnJvcicpIHsKICAgICAgICAgIGVycm9yKG1zZyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgZm4obGV2ZWwsIGxvY2FsZSwgbWVzc2FnZSwgcGF0aHMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2luaXRWTSA9IGZ1bmN0aW9uIF9pbml0Vk0oZGF0YSkgewogIHZhciBzaWxlbnQgPSBWdWUuY29uZmlnLnNpbGVudDsKICBWdWUuY29uZmlnLnNpbGVudCA9IHRydWU7CiAgdGhpcy5fdm0gPSBuZXcgVnVlKHsKICAgIGRhdGE6IGRhdGEKICB9KTsKICBWdWUuY29uZmlnLnNpbGVudCA9IHNpbGVudDsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmRlc3Ryb3lWTSA9IGZ1bmN0aW9uIGRlc3Ryb3lWTSgpIHsKICB0aGlzLl92bS4kZGVzdHJveSgpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc3Vic2NyaWJlRGF0YUNoYW5naW5nID0gZnVuY3Rpb24gc3Vic2NyaWJlRGF0YUNoYW5naW5nKHZtKSB7CiAgdGhpcy5fZGF0YUxpc3RlbmVycy5wdXNoKHZtKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnVuc3Vic2NyaWJlRGF0YUNoYW5naW5nID0gZnVuY3Rpb24gdW5zdWJzY3JpYmVEYXRhQ2hhbmdpbmcodm0pIHsKICByZW1vdmUodGhpcy5fZGF0YUxpc3RlbmVycywgdm0pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUud2F0Y2hJMThuRGF0YSA9IGZ1bmN0aW9uIHdhdGNoSTE4bkRhdGEoKSB7CiAgdmFyIHNlbGYgPSB0aGlzOwogIHJldHVybiB0aGlzLl92bS4kd2F0Y2goJyRkYXRhJywgZnVuY3Rpb24gKCkgewogICAgdmFyIGkgPSBzZWxmLl9kYXRhTGlzdGVuZXJzLmxlbmd0aDsKCiAgICB3aGlsZSAoaS0tKSB7CiAgICAgIFZ1ZS5uZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgc2VsZi5fZGF0YUxpc3RlbmVyc1tpXSAmJiBzZWxmLl9kYXRhTGlzdGVuZXJzW2ldLiRmb3JjZVVwZGF0ZSgpOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBkZWVwOiB0cnVlCiAgfSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS53YXRjaExvY2FsZSA9IGZ1bmN0aW9uIHdhdGNoTG9jYWxlKCkgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICghdGhpcy5fc3luYyB8fCAhdGhpcy5fcm9vdCkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICB2YXIgdGFyZ2V0ID0gdGhpcy5fdm07CiAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4udm0uJHdhdGNoKCdsb2NhbGUnLCBmdW5jdGlvbiAodmFsKSB7CiAgICB0YXJnZXQuJHNldCh0YXJnZXQsICdsb2NhbGUnLCB2YWwpOwogICAgdGFyZ2V0LiRmb3JjZVVwZGF0ZSgpOwogIH0sIHsKICAgIGltbWVkaWF0ZTogdHJ1ZQogIH0pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUub25Db21wb25lbnRJbnN0YW5jZUNyZWF0ZWQgPSBmdW5jdGlvbiBvbkNvbXBvbmVudEluc3RhbmNlQ3JlYXRlZChuZXdJMThuKSB7CiAgaWYgKHRoaXMuX2NvbXBvbmVudEluc3RhbmNlQ3JlYXRlZExpc3RlbmVyKSB7CiAgICB0aGlzLl9jb21wb25lbnRJbnN0YW5jZUNyZWF0ZWRMaXN0ZW5lcihuZXdJMThuLCB0aGlzKTsKICB9Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMudm0uZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl92bTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5tZXNzYWdlcy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fZ2V0TWVzc2FnZXMoKSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZGF0ZVRpbWVGb3JtYXRzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gbG9vc2VDbG9uZSh0aGlzLl9nZXREYXRlVGltZUZvcm1hdHMoKSk7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMubnVtYmVyRm9ybWF0cy5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fZ2V0TnVtYmVyRm9ybWF0cygpKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5hdmFpbGFibGVMb2NhbGVzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5tZXNzYWdlcykuc29ydCgpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmxvY2FsZS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3ZtLmxvY2FsZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5sb2NhbGUuc2V0ID0gZnVuY3Rpb24gKGxvY2FsZSkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0sICdsb2NhbGUnLCBsb2NhbGUpOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZhbGxiYWNrTG9jYWxlLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fdm0uZmFsbGJhY2tMb2NhbGU7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZmFsbGJhY2tMb2NhbGUuc2V0ID0gZnVuY3Rpb24gKGxvY2FsZSkgewogIHRoaXMuX2xvY2FsZUNoYWluQ2FjaGUgPSB7fTsKCiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bSwgJ2ZhbGxiYWNrTG9jYWxlJywgbG9jYWxlKTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mb3JtYXRGYWxsYmFja01lc3NhZ2VzLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fZm9ybWF0RmFsbGJhY2tNZXNzYWdlczsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5mb3JtYXRGYWxsYmFja01lc3NhZ2VzLnNldCA9IGZ1bmN0aW9uIChmYWxsYmFjaykgewogIHRoaXMuX2Zvcm1hdEZhbGxiYWNrTWVzc2FnZXMgPSBmYWxsYmFjazsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5taXNzaW5nLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fbWlzc2luZzsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5taXNzaW5nLnNldCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7CiAgdGhpcy5fbWlzc2luZyA9IGhhbmRsZXI7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuZm9ybWF0dGVyLmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fZm9ybWF0dGVyOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLmZvcm1hdHRlci5zZXQgPSBmdW5jdGlvbiAoZm9ybWF0dGVyKSB7CiAgdGhpcy5fZm9ybWF0dGVyID0gZm9ybWF0dGVyOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnNpbGVudFRyYW5zbGF0aW9uV2Fybi5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2FybjsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5zaWxlbnRUcmFuc2xhdGlvbldhcm4uc2V0ID0gZnVuY3Rpb24gKHNpbGVudCkgewogIHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2FybiA9IHNpbGVudDsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5zaWxlbnRGYWxsYmFja1dhcm4uZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm47Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMuc2lsZW50RmFsbGJhY2tXYXJuLnNldCA9IGZ1bmN0aW9uIChzaWxlbnQpIHsKICB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm4gPSBzaWxlbnQ7Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMucHJlc2VydmVEaXJlY3RpdmVDb250ZW50LmdldCA9IGZ1bmN0aW9uICgpIHsKICByZXR1cm4gdGhpcy5fcHJlc2VydmVEaXJlY3RpdmVDb250ZW50Owp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLnByZXNlcnZlRGlyZWN0aXZlQ29udGVudC5zZXQgPSBmdW5jdGlvbiAocHJlc2VydmUpIHsKICB0aGlzLl9wcmVzZXJ2ZURpcmVjdGl2ZUNvbnRlbnQgPSBwcmVzZXJ2ZTsKfTsKCnByb3RvdHlwZUFjY2Vzc29ycy53YXJuSHRtbEluTWVzc2FnZS5nZXQgPSBmdW5jdGlvbiAoKSB7CiAgcmV0dXJuIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlOwp9OwoKcHJvdG90eXBlQWNjZXNzb3JzLndhcm5IdG1sSW5NZXNzYWdlLnNldCA9IGZ1bmN0aW9uIChsZXZlbCkgewogIHZhciB0aGlzJDEgPSB0aGlzOwogIHZhciBvcmdMZXZlbCA9IHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlOwogIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID0gbGV2ZWw7CgogIGlmIChvcmdMZXZlbCAhPT0gbGV2ZWwgJiYgKGxldmVsID09PSAnd2FybicgfHwgbGV2ZWwgPT09ICdlcnJvcicpKSB7CiAgICB2YXIgbWVzc2FnZXMgPSB0aGlzLl9nZXRNZXNzYWdlcygpOwoKICAgIE9iamVjdC5rZXlzKG1lc3NhZ2VzKS5mb3JFYWNoKGZ1bmN0aW9uIChsb2NhbGUpIHsKICAgICAgdGhpcyQxLl9jaGVja0xvY2FsZU1lc3NhZ2UobG9jYWxlLCB0aGlzJDEuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlc1tsb2NhbGVdKTsKICAgIH0pOwogIH0KfTsKCnByb3RvdHlwZUFjY2Vzc29ycy5wb3N0VHJhbnNsYXRpb24uZ2V0ID0gZnVuY3Rpb24gKCkgewogIHJldHVybiB0aGlzLl9wb3N0VHJhbnNsYXRpb247Cn07Cgpwcm90b3R5cGVBY2Nlc3NvcnMucG9zdFRyYW5zbGF0aW9uLnNldCA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7CiAgdGhpcy5fcG9zdFRyYW5zbGF0aW9uID0gaGFuZGxlcjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXRNZXNzYWdlcyA9IGZ1bmN0aW9uIF9nZXRNZXNzYWdlcygpIHsKICByZXR1cm4gdGhpcy5fdm0ubWVzc2FnZXM7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fZ2V0RGF0ZVRpbWVGb3JtYXRzID0gZnVuY3Rpb24gX2dldERhdGVUaW1lRm9ybWF0cygpIHsKICByZXR1cm4gdGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldE51bWJlckZvcm1hdHMgPSBmdW5jdGlvbiBfZ2V0TnVtYmVyRm9ybWF0cygpIHsKICByZXR1cm4gdGhpcy5fdm0ubnVtYmVyRm9ybWF0czsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl93YXJuRGVmYXVsdCA9IGZ1bmN0aW9uIF93YXJuRGVmYXVsdChsb2NhbGUsIGtleSwgcmVzdWx0LCB2bSwgdmFsdWVzLCBpbnRlcnBvbGF0ZU1vZGUpIHsKICBpZiAoIWlzTnVsbChyZXN1bHQpKSB7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KCiAgaWYgKHRoaXMuX21pc3NpbmcpIHsKICAgIHZhciBtaXNzaW5nUmV0ID0gdGhpcy5fbWlzc2luZy5hcHBseShudWxsLCBbbG9jYWxlLCBrZXksIHZtLCB2YWx1ZXNdKTsKCiAgICBpZiAoaXNTdHJpbmcobWlzc2luZ1JldCkpIHsKICAgICAgcmV0dXJuIG1pc3NpbmdSZXQ7CiAgICB9CiAgfSBlbHNlIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkNhbm5vdCB0cmFuc2xhdGUgdGhlIHZhbHVlIG9mIGtleXBhdGggJyIgKyBrZXkgKyAiJy4gIiArICdVc2UgdGhlIHZhbHVlIG9mIGtleXBhdGggYXMgZGVmYXVsdC4nKTsKICAgIH0KICB9CgogIGlmICh0aGlzLl9mb3JtYXRGYWxsYmFja01lc3NhZ2VzKSB7CiAgICB2YXIgcGFyc2VkQXJncyA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIHZhbHVlcyk7CiAgICByZXR1cm4gdGhpcy5fcmVuZGVyKGtleSwgaW50ZXJwb2xhdGVNb2RlLCBwYXJzZWRBcmdzLnBhcmFtcywga2V5KTsKICB9IGVsc2UgewogICAgcmV0dXJuIGtleTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faXNGYWxsYmFja1Jvb3QgPSBmdW5jdGlvbiBfaXNGYWxsYmFja1Jvb3QodmFsKSB7CiAgcmV0dXJuICF2YWwgJiYgIWlzTnVsbCh0aGlzLl9yb290KSAmJiB0aGlzLl9mYWxsYmFja1Jvb3Q7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faXNTaWxlbnRGYWxsYmFja1dhcm4gPSBmdW5jdGlvbiBfaXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSB7CiAgcmV0dXJuIHRoaXMuX3NpbGVudEZhbGxiYWNrV2FybiBpbnN0YW5jZW9mIFJlZ0V4cCA/IHRoaXMuX3NpbGVudEZhbGxiYWNrV2Fybi50ZXN0KGtleSkgOiB0aGlzLl9zaWxlbnRGYWxsYmFja1dhcm47Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faXNTaWxlbnRGYWxsYmFjayA9IGZ1bmN0aW9uIF9pc1NpbGVudEZhbGxiYWNrKGxvY2FsZSwga2V5KSB7CiAgcmV0dXJuIHRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkgJiYgKHRoaXMuX2lzRmFsbGJhY2tSb290KCkgfHwgbG9jYWxlICE9PSB0aGlzLmZhbGxiYWNrTG9jYWxlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybiA9IGZ1bmN0aW9uIF9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpIHsKICByZXR1cm4gdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuIGluc3RhbmNlb2YgUmVnRXhwID8gdGhpcy5fc2lsZW50VHJhbnNsYXRpb25XYXJuLnRlc3Qoa2V5KSA6IHRoaXMuX3NpbGVudFRyYW5zbGF0aW9uV2FybjsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uIF9pbnRlcnBvbGF0ZShsb2NhbGUsIG1lc3NhZ2UsIGtleSwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMsIHZpc2l0ZWRMaW5rU3RhY2spIHsKICBpZiAoIW1lc3NhZ2UpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgdmFyIHBhdGhSZXQgPSB0aGlzLl9wYXRoLmdldFBhdGhWYWx1ZShtZXNzYWdlLCBrZXkpOwoKICBpZiAoaXNBcnJheShwYXRoUmV0KSB8fCBpc1BsYWluT2JqZWN0KHBhdGhSZXQpKSB7CiAgICByZXR1cm4gcGF0aFJldDsKICB9CgogIHZhciByZXQ7CgogIGlmIChpc051bGwocGF0aFJldCkpIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoaXNQbGFpbk9iamVjdChtZXNzYWdlKSkgewogICAgICByZXQgPSBtZXNzYWdlW2tleV07CgogICAgICBpZiAoIShpc1N0cmluZyhyZXQpIHx8IGlzRnVuY3Rpb24ocmV0KSkpIHsKICAgICAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFjayhsb2NhbGUsIGtleSkpIHsKICAgICAgICAgIHdhcm4oIlZhbHVlIG9mIGtleSAnIiArIGtleSArICInIGlzIG5vdCBhIHN0cmluZyBvciBmdW5jdGlvbiAhIik7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSBlbHNlIHsKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovCiAgICBpZiAoaXNTdHJpbmcocGF0aFJldCkgfHwgaXNGdW5jdGlvbihwYXRoUmV0KSkgewogICAgICByZXQgPSBwYXRoUmV0OwogICAgfSBlbHNlIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2sobG9jYWxlLCBrZXkpKSB7CiAgICAgICAgd2FybigiVmFsdWUgb2Yga2V5ICciICsga2V5ICsgIicgaXMgbm90IGEgc3RyaW5nIG9yIGZ1bmN0aW9uISIpOwogICAgICB9CgogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9IC8vIENoZWNrIGZvciB0aGUgZXhpc3RlbmNlIG9mIGxpbmtzIHdpdGhpbiB0aGUgdHJhbnNsYXRlZCBzdHJpbmcKCgogIGlmIChpc1N0cmluZyhyZXQpICYmIChyZXQuaW5kZXhPZignQDonKSA+PSAwIHx8IHJldC5pbmRleE9mKCdALicpID49IDApKSB7CiAgICByZXQgPSB0aGlzLl9saW5rKGxvY2FsZSwgbWVzc2FnZSwgcmV0LCBob3N0LCAncmF3JywgdmFsdWVzLCB2aXNpdGVkTGlua1N0YWNrKTsKICB9CgogIHJldHVybiB0aGlzLl9yZW5kZXIocmV0LCBpbnRlcnBvbGF0ZU1vZGUsIHZhbHVlcywga2V5KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9saW5rID0gZnVuY3Rpb24gX2xpbmsobG9jYWxlLCBtZXNzYWdlLCBzdHIsIGhvc3QsIGludGVycG9sYXRlTW9kZSwgdmFsdWVzLCB2aXNpdGVkTGlua1N0YWNrKSB7CiAgdmFyIHJldCA9IHN0cjsgLy8gTWF0Y2ggYWxsIHRoZSBsaW5rcyB3aXRoaW4gdGhlIGxvY2FsCiAgLy8gV2UgYXJlIGdvaW5nIHRvIHJlcGxhY2UgZWFjaCBvZgogIC8vIHRoZW0gd2l0aCBpdHMgdHJhbnNsYXRpb24KCiAgdmFyIG1hdGNoZXMgPSByZXQubWF0Y2gobGlua0tleU1hdGNoZXIpOwoKICBmb3IgKHZhciBpZHggaW4gbWF0Y2hlcykgewogICAgLy8gaWUgY29tcGF0aWJsZTogZmlsdGVyIGN1c3RvbSBhcnJheQogICAgLy8gcHJvdG90eXBlIG1ldGhvZAogICAgaWYgKCFtYXRjaGVzLmhhc093blByb3BlcnR5KGlkeCkpIHsKICAgICAgY29udGludWU7CiAgICB9CgogICAgdmFyIGxpbmsgPSBtYXRjaGVzW2lkeF07CiAgICB2YXIgbGlua0tleVByZWZpeE1hdGNoZXMgPSBsaW5rLm1hdGNoKGxpbmtLZXlQcmVmaXhNYXRjaGVyKTsKICAgIHZhciBsaW5rUHJlZml4ID0gbGlua0tleVByZWZpeE1hdGNoZXNbMF07CiAgICB2YXIgZm9ybWF0dGVyTmFtZSA9IGxpbmtLZXlQcmVmaXhNYXRjaGVzWzFdOyAvLyBSZW1vdmUgdGhlIGxlYWRpbmcgQDosIEAuY2FzZTogYW5kIHRoZSBicmFja2V0cwoKICAgIHZhciBsaW5rUGxhY2Vob2xkZXIgPSBsaW5rLnJlcGxhY2UobGlua1ByZWZpeCwgJycpLnJlcGxhY2UoYnJhY2tldHNNYXRjaGVyLCAnJyk7CgogICAgaWYgKGluY2x1ZGVzKHZpc2l0ZWRMaW5rU3RhY2ssIGxpbmtQbGFjZWhvbGRlcikpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgICB3YXJuKCJDaXJjdWxhciByZWZlcmVuY2UgZm91bmQuIFwiIiArIGxpbmsgKyAiXCIgaXMgYWxyZWFkeSB2aXNpdGVkIGluIHRoZSBjaGFpbiBvZiAiICsgdmlzaXRlZExpbmtTdGFjay5yZXZlcnNlKCkuam9pbignIDwtICcpKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJldDsKICAgIH0KCiAgICB2aXNpdGVkTGlua1N0YWNrLnB1c2gobGlua1BsYWNlaG9sZGVyKTsgLy8gVHJhbnNsYXRlIHRoZSBsaW5rCgogICAgdmFyIHRyYW5zbGF0ZWQgPSB0aGlzLl9pbnRlcnBvbGF0ZShsb2NhbGUsIG1lc3NhZ2UsIGxpbmtQbGFjZWhvbGRlciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlID09PSAncmF3JyA/ICdzdHJpbmcnIDogaW50ZXJwb2xhdGVNb2RlLCBpbnRlcnBvbGF0ZU1vZGUgPT09ICdyYXcnID8gdW5kZWZpbmVkIDogdmFsdWVzLCB2aXNpdGVkTGlua1N0YWNrKTsKCiAgICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QodHJhbnNsYXRlZCkpIHsKICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGxpbmtQbGFjZWhvbGRlcikpIHsKICAgICAgICB3YXJuKCJGYWxsIGJhY2sgdG8gdHJhbnNsYXRlIHRoZSBsaW5rIHBsYWNlaG9sZGVyICciICsgbGlua1BsYWNlaG9sZGVyICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgICAgfQogICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgICB9CgogICAgICB2YXIgcm9vdCA9IHRoaXMuX3Jvb3QuJGkxOG47CiAgICAgIHRyYW5zbGF0ZWQgPSByb290Ll90cmFuc2xhdGUocm9vdC5fZ2V0TWVzc2FnZXMoKSwgcm9vdC5sb2NhbGUsIHJvb3QuZmFsbGJhY2tMb2NhbGUsIGxpbmtQbGFjZWhvbGRlciwgaG9zdCwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMpOwogICAgfQoKICAgIHRyYW5zbGF0ZWQgPSB0aGlzLl93YXJuRGVmYXVsdChsb2NhbGUsIGxpbmtQbGFjZWhvbGRlciwgdHJhbnNsYXRlZCwgaG9zdCwgaXNBcnJheSh2YWx1ZXMpID8gdmFsdWVzIDogW3ZhbHVlc10sIGludGVycG9sYXRlTW9kZSk7CgogICAgaWYgKHRoaXMuX21vZGlmaWVycy5oYXNPd25Qcm9wZXJ0eShmb3JtYXR0ZXJOYW1lKSkgewogICAgICB0cmFuc2xhdGVkID0gdGhpcy5fbW9kaWZpZXJzW2Zvcm1hdHRlck5hbWVdKHRyYW5zbGF0ZWQpOwogICAgfSBlbHNlIGlmIChkZWZhdWx0TW9kaWZpZXJzLmhhc093blByb3BlcnR5KGZvcm1hdHRlck5hbWUpKSB7CiAgICAgIHRyYW5zbGF0ZWQgPSBkZWZhdWx0TW9kaWZpZXJzW2Zvcm1hdHRlck5hbWVdKHRyYW5zbGF0ZWQpOwogICAgfQoKICAgIHZpc2l0ZWRMaW5rU3RhY2sucG9wKCk7IC8vIFJlcGxhY2UgdGhlIGxpbmsgd2l0aCB0aGUgdHJhbnNsYXRlZAoKICAgIHJldCA9ICF0cmFuc2xhdGVkID8gcmV0IDogcmV0LnJlcGxhY2UobGluaywgdHJhbnNsYXRlZCk7CiAgfQoKICByZXR1cm4gcmV0Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NyZWF0ZU1lc3NhZ2VDb250ZXh0ID0gZnVuY3Rpb24gX2NyZWF0ZU1lc3NhZ2VDb250ZXh0KHZhbHVlcykgewogIHZhciBfbGlzdCA9IGlzQXJyYXkodmFsdWVzKSA/IHZhbHVlcyA6IFtdOwoKICB2YXIgX25hbWVkID0gaXNPYmplY3QodmFsdWVzKSA/IHZhbHVlcyA6IHt9OwoKICB2YXIgbGlzdCA9IGZ1bmN0aW9uIGxpc3QoaW5kZXgpIHsKICAgIHJldHVybiBfbGlzdFtpbmRleF07CiAgfTsKCiAgdmFyIG5hbWVkID0gZnVuY3Rpb24gbmFtZWQoa2V5KSB7CiAgICByZXR1cm4gX25hbWVkW2tleV07CiAgfTsKCiAgcmV0dXJuIHsKICAgIGxpc3Q6IGxpc3QsCiAgICBuYW1lZDogbmFtZWQKICB9Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3JlbmRlciA9IGZ1bmN0aW9uIF9yZW5kZXIobWVzc2FnZSwgaW50ZXJwb2xhdGVNb2RlLCB2YWx1ZXMsIHBhdGgpIHsKICBpZiAoaXNGdW5jdGlvbihtZXNzYWdlKSkgewogICAgcmV0dXJuIG1lc3NhZ2UodGhpcy5fY3JlYXRlTWVzc2FnZUNvbnRleHQodmFsdWVzKSk7CiAgfQoKICB2YXIgcmV0ID0gdGhpcy5fZm9ybWF0dGVyLmludGVycG9sYXRlKG1lc3NhZ2UsIHZhbHVlcywgcGF0aCk7IC8vIElmIHRoZSBjdXN0b20gZm9ybWF0dGVyIHJlZnVzZXMgdG8gd29yayAtIGFwcGx5IHRoZSBkZWZhdWx0IG9uZQoKCiAgaWYgKCFyZXQpIHsKICAgIHJldCA9IGRlZmF1bHRGb3JtYXR0ZXIuaW50ZXJwb2xhdGUobWVzc2FnZSwgdmFsdWVzLCBwYXRoKTsKICB9IC8vIGlmIGludGVycG9sYXRlTW9kZSBpcyAqKm5vdCoqICdzdHJpbmcnICgncm93JyksCiAgLy8gcmV0dXJuIHRoZSBjb21waWxlZCBkYXRhIChlLmcuIFsnZm9vJywgVk5vZGUsICdiYXInXSkgd2l0aCBmb3JtYXR0ZXIKCgogIHJldHVybiBpbnRlcnBvbGF0ZU1vZGUgPT09ICdzdHJpbmcnICYmICFpc1N0cmluZyhyZXQpID8gcmV0LmpvaW4oJycpIDogcmV0Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2FwcGVuZEl0ZW1Ub0NoYWluID0gZnVuY3Rpb24gX2FwcGVuZEl0ZW1Ub0NoYWluKGNoYWluLCBpdGVtLCBibG9ja3MpIHsKICB2YXIgZm9sbG93ID0gZmFsc2U7CgogIGlmICghaW5jbHVkZXMoY2hhaW4sIGl0ZW0pKSB7CiAgICBmb2xsb3cgPSB0cnVlOwoKICAgIGlmIChpdGVtKSB7CiAgICAgIGZvbGxvdyA9IGl0ZW1baXRlbS5sZW5ndGggLSAxXSAhPT0gJyEnOwogICAgICBpdGVtID0gaXRlbS5yZXBsYWNlKC8hL2csICcnKTsKICAgICAgY2hhaW4ucHVzaChpdGVtKTsKCiAgICAgIGlmIChibG9ja3MgJiYgYmxvY2tzW2l0ZW1dKSB7CiAgICAgICAgZm9sbG93ID0gYmxvY2tzW2l0ZW1dOwogICAgICB9CiAgICB9CiAgfQoKICByZXR1cm4gZm9sbG93Owp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2FwcGVuZExvY2FsZVRvQ2hhaW4gPSBmdW5jdGlvbiBfYXBwZW5kTG9jYWxlVG9DaGFpbihjaGFpbiwgbG9jYWxlLCBibG9ja3MpIHsKICB2YXIgZm9sbG93OwogIHZhciB0b2tlbnMgPSBsb2NhbGUuc3BsaXQoJy0nKTsKCiAgZG8gewogICAgdmFyIGl0ZW0gPSB0b2tlbnMuam9pbignLScpOwogICAgZm9sbG93ID0gdGhpcy5fYXBwZW5kSXRlbVRvQ2hhaW4oY2hhaW4sIGl0ZW0sIGJsb2Nrcyk7CiAgICB0b2tlbnMuc3BsaWNlKC0xLCAxKTsKICB9IHdoaWxlICh0b2tlbnMubGVuZ3RoICYmIGZvbGxvdyA9PT0gdHJ1ZSk7CgogIHJldHVybiBmb2xsb3c7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fYXBwZW5kQmxvY2tUb0NoYWluID0gZnVuY3Rpb24gX2FwcGVuZEJsb2NrVG9DaGFpbihjaGFpbiwgYmxvY2ssIGJsb2NrcykgewogIHZhciBmb2xsb3cgPSB0cnVlOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGJsb2NrLmxlbmd0aCAmJiBpc0Jvb2xlYW4oZm9sbG93KTsgaSsrKSB7CiAgICB2YXIgbG9jYWxlID0gYmxvY2tbaV07CgogICAgaWYgKGlzU3RyaW5nKGxvY2FsZSkpIHsKICAgICAgZm9sbG93ID0gdGhpcy5fYXBwZW5kTG9jYWxlVG9DaGFpbihjaGFpbiwgbG9jYWxlLCBibG9ja3MpOwogICAgfQogIH0KCiAgcmV0dXJuIGZvbGxvdzsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9nZXRMb2NhbGVDaGFpbiA9IGZ1bmN0aW9uIF9nZXRMb2NhbGVDaGFpbihzdGFydCwgZmFsbGJhY2tMb2NhbGUpIHsKICBpZiAoc3RhcnQgPT09ICcnKSB7CiAgICByZXR1cm4gW107CiAgfQoKICBpZiAoIXRoaXMuX2xvY2FsZUNoYWluQ2FjaGUpIHsKICAgIHRoaXMuX2xvY2FsZUNoYWluQ2FjaGUgPSB7fTsKICB9CgogIHZhciBjaGFpbiA9IHRoaXMuX2xvY2FsZUNoYWluQ2FjaGVbc3RhcnRdOwoKICBpZiAoIWNoYWluKSB7CiAgICBpZiAoIWZhbGxiYWNrTG9jYWxlKSB7CiAgICAgIGZhbGxiYWNrTG9jYWxlID0gdGhpcy5mYWxsYmFja0xvY2FsZTsKICAgIH0KCiAgICBjaGFpbiA9IFtdOyAvLyBmaXJzdCBibG9jayBkZWZpbmVkIGJ5IHN0YXJ0CgogICAgdmFyIGJsb2NrID0gW3N0YXJ0XTsgLy8gd2hpbGUgYW55IGludGVydmVuaW5nIGJsb2NrIGZvdW5kCgogICAgd2hpbGUgKGlzQXJyYXkoYmxvY2spKSB7CiAgICAgIGJsb2NrID0gdGhpcy5fYXBwZW5kQmxvY2tUb0NoYWluKGNoYWluLCBibG9jaywgZmFsbGJhY2tMb2NhbGUpOwogICAgfSAvLyBsYXN0IGJsb2NrIGRlZmluZWQgYnkgZGVmYXVsdAoKCiAgICB2YXIgZGVmYXVsdHM7CgogICAgaWYgKGlzQXJyYXkoZmFsbGJhY2tMb2NhbGUpKSB7CiAgICAgIGRlZmF1bHRzID0gZmFsbGJhY2tMb2NhbGU7CiAgICB9IGVsc2UgaWYgKGlzT2JqZWN0KGZhbGxiYWNrTG9jYWxlKSkgewogICAgICAvKiAkRmxvd0ZpeE1lICovCiAgICAgIGlmIChmYWxsYmFja0xvY2FsZVsnZGVmYXVsdCddKSB7CiAgICAgICAgZGVmYXVsdHMgPSBmYWxsYmFja0xvY2FsZVsnZGVmYXVsdCddOwogICAgICB9IGVsc2UgewogICAgICAgIGRlZmF1bHRzID0gbnVsbDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZGVmYXVsdHMgPSBmYWxsYmFja0xvY2FsZTsKICAgIH0gLy8gY29udmVydCBkZWZhdWx0cyB0byBhcnJheQoKCiAgICBpZiAoaXNTdHJpbmcoZGVmYXVsdHMpKSB7CiAgICAgIGJsb2NrID0gW2RlZmF1bHRzXTsKICAgIH0gZWxzZSB7CiAgICAgIGJsb2NrID0gZGVmYXVsdHM7CiAgICB9CgogICAgaWYgKGJsb2NrKSB7CiAgICAgIHRoaXMuX2FwcGVuZEJsb2NrVG9DaGFpbihjaGFpbiwgYmxvY2ssIG51bGwpOwogICAgfQoKICAgIHRoaXMuX2xvY2FsZUNoYWluQ2FjaGVbc3RhcnRdID0gY2hhaW47CiAgfQoKICByZXR1cm4gY2hhaW47Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fdHJhbnNsYXRlID0gZnVuY3Rpb24gX3RyYW5zbGF0ZShtZXNzYWdlcywgbG9jYWxlLCBmYWxsYmFjaywga2V5LCBob3N0LCBpbnRlcnBvbGF0ZU1vZGUsIGFyZ3MpIHsKICB2YXIgY2hhaW4gPSB0aGlzLl9nZXRMb2NhbGVDaGFpbihsb2NhbGUsIGZhbGxiYWNrKTsKCiAgdmFyIHJlczsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaGFpbi5sZW5ndGg7IGkrKykgewogICAgdmFyIHN0ZXAgPSBjaGFpbltpXTsKICAgIHJlcyA9IHRoaXMuX2ludGVycG9sYXRlKHN0ZXAsIG1lc3NhZ2VzW3N0ZXBdLCBrZXksIGhvc3QsIGludGVycG9sYXRlTW9kZSwgYXJncywgW2tleV0pOwoKICAgIGlmICghaXNOdWxsKHJlcykpIHsKICAgICAgaWYgKHN0ZXAgIT09IGxvY2FsZSAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpKSB7CiAgICAgICAgd2FybigiRmFsbCBiYWNrIHRvIHRyYW5zbGF0ZSB0aGUga2V5cGF0aCAnIiArIGtleSArICInIHdpdGggJyIgKyBzdGVwICsgIicgbG9jYWxlLiIpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzOwogICAgfQogIH0KCiAgcmV0dXJuIG51bGw7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5fdCA9IGZ1bmN0aW9uIF90KGtleSwgX2xvY2FsZSwgbWVzc2FnZXMsIGhvc3QpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDQ7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDRdOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHJldHVybiAnJzsKICB9CgogIHZhciBwYXJzZWRBcmdzID0gcGFyc2VBcmdzLmFwcGx5KHZvaWQgMCwgdmFsdWVzKTsKCiAgaWYgKHRoaXMuX2VzY2FwZVBhcmFtZXRlckh0bWwpIHsKICAgIHBhcnNlZEFyZ3MucGFyYW1zID0gZXNjYXBlUGFyYW1zKHBhcnNlZEFyZ3MucGFyYW1zKTsKICB9CgogIHZhciBsb2NhbGUgPSBwYXJzZWRBcmdzLmxvY2FsZSB8fCBfbG9jYWxlOwoKICB2YXIgcmV0ID0gdGhpcy5fdHJhbnNsYXRlKG1lc3NhZ2VzLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIGtleSwgaG9zdCwgJ3N0cmluZycsIHBhcnNlZEFyZ3MucGFyYW1zKTsKCiAgaWYgKHRoaXMuX2lzRmFsbGJhY2tSb290KHJldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nICYmICF0aGlzLl9pc1NpbGVudFRyYW5zbGF0aW9uV2FybihrZXkpICYmICF0aGlzLl9pc1NpbGVudEZhbGxiYWNrV2FybihrZXkpKSB7CiAgICAgIHdhcm4oIkZhbGwgYmFjayB0byB0cmFuc2xhdGUgdGhlIGtleXBhdGggJyIgKyBrZXkgKyAiJyB3aXRoIHJvb3QgbG9jYWxlLiIpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgfQoKICAgIHJldHVybiAocmVmID0gdGhpcy5fcm9vdCkuJHQuYXBwbHkocmVmLCBba2V5XS5jb25jYXQodmFsdWVzKSk7CiAgfSBlbHNlIHsKICAgIHJldCA9IHRoaXMuX3dhcm5EZWZhdWx0KGxvY2FsZSwga2V5LCByZXQsIGhvc3QsIHZhbHVlcywgJ3N0cmluZycpOwoKICAgIGlmICh0aGlzLl9wb3N0VHJhbnNsYXRpb24gJiYgcmV0ICE9PSBudWxsICYmIHJldCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldCA9IHRoaXMuX3Bvc3RUcmFuc2xhdGlvbihyZXQsIGtleSk7CiAgICB9CgogICAgcmV0dXJuIHJldDsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS50ID0gZnVuY3Rpb24gdChrZXkpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogIH0KCiAgcmV0dXJuIChyZWYgPSB0aGlzKS5fdC5hcHBseShyZWYsIFtrZXksIHRoaXMubG9jYWxlLCB0aGlzLl9nZXRNZXNzYWdlcygpLCBudWxsXS5jb25jYXQodmFsdWVzKSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5faSA9IGZ1bmN0aW9uIF9pKGtleSwgbG9jYWxlLCBtZXNzYWdlcywgaG9zdCwgdmFsdWVzKSB7CiAgdmFyIHJldCA9IHRoaXMuX3RyYW5zbGF0ZShtZXNzYWdlcywgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCBrZXksIGhvc3QsICdyYXcnLCB2YWx1ZXMpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGludGVycG9sYXRlIHRoZSBrZXlwYXRoICciICsga2V5ICsgIicgd2l0aCByb290IGxvY2FsZS4iKTsKICAgIH0KCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5pKGtleSwgbG9jYWxlLCB2YWx1ZXMpOwogIH0gZWxzZSB7CiAgICByZXR1cm4gdGhpcy5fd2FybkRlZmF1bHQobG9jYWxlLCBrZXksIHJldCwgaG9zdCwgW3ZhbHVlc10sICdyYXcnKTsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5pID0gZnVuY3Rpb24gaShrZXksIGxvY2FsZSwgdmFsdWVzKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFrZXkpIHsKICAgIHJldHVybiAnJzsKICB9CgogIGlmICghaXNTdHJpbmcobG9jYWxlKSkgewogICAgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgfQoKICByZXR1cm4gdGhpcy5faShrZXksIGxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbnVsbCwgdmFsdWVzKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl90YyA9IGZ1bmN0aW9uIF90YyhrZXksIF9sb2NhbGUsIG1lc3NhZ2VzLCBob3N0LCBjaG9pY2UpIHsKICB2YXIgcmVmOwogIHZhciB2YWx1ZXMgPSBbXSwKICAgICAgbGVuID0gYXJndW1lbnRzLmxlbmd0aCAtIDU7CgogIHdoaWxlIChsZW4tLSA+IDApIHsKICAgIHZhbHVlc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDVdOwogIH0KCiAgaWYgKCFrZXkpIHsKICAgIHJldHVybiAnJzsKICB9CgogIGlmIChjaG9pY2UgPT09IHVuZGVmaW5lZCkgewogICAgY2hvaWNlID0gMTsKICB9CgogIHZhciBwcmVkZWZpbmVkID0gewogICAgJ2NvdW50JzogY2hvaWNlLAogICAgJ24nOiBjaG9pY2UKICB9OwogIHZhciBwYXJzZWRBcmdzID0gcGFyc2VBcmdzLmFwcGx5KHZvaWQgMCwgdmFsdWVzKTsKICBwYXJzZWRBcmdzLnBhcmFtcyA9IE9iamVjdC5hc3NpZ24ocHJlZGVmaW5lZCwgcGFyc2VkQXJncy5wYXJhbXMpOwogIHZhbHVlcyA9IHBhcnNlZEFyZ3MubG9jYWxlID09PSBudWxsID8gW3BhcnNlZEFyZ3MucGFyYW1zXSA6IFtwYXJzZWRBcmdzLmxvY2FsZSwgcGFyc2VkQXJncy5wYXJhbXNdOwogIHJldHVybiB0aGlzLmZldGNoQ2hvaWNlKChyZWYgPSB0aGlzKS5fdC5hcHBseShyZWYsIFtrZXksIF9sb2NhbGUsIG1lc3NhZ2VzLCBob3N0XS5jb25jYXQodmFsdWVzKSksIGNob2ljZSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5mZXRjaENob2ljZSA9IGZ1bmN0aW9uIGZldGNoQ2hvaWNlKG1lc3NhZ2UsIGNob2ljZSkgewogIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogIGlmICghbWVzc2FnZSB8fCAhaXNTdHJpbmcobWVzc2FnZSkpIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgdmFyIGNob2ljZXMgPSBtZXNzYWdlLnNwbGl0KCd8Jyk7CiAgY2hvaWNlID0gdGhpcy5nZXRDaG9pY2VJbmRleChjaG9pY2UsIGNob2ljZXMubGVuZ3RoKTsKCiAgaWYgKCFjaG9pY2VzW2Nob2ljZV0pIHsKICAgIHJldHVybiBtZXNzYWdlOwogIH0KCiAgcmV0dXJuIGNob2ljZXNbY2hvaWNlXS50cmltKCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS50YyA9IGZ1bmN0aW9uIHRjKGtleSwgY2hvaWNlKSB7CiAgdmFyIHJlZjsKICB2YXIgdmFsdWVzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAyOwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICB2YWx1ZXNbbGVuXSA9IGFyZ3VtZW50c1tsZW4gKyAyXTsKICB9CgogIHJldHVybiAocmVmID0gdGhpcykuX3RjLmFwcGx5KHJlZiwgW2tleSwgdGhpcy5sb2NhbGUsIHRoaXMuX2dldE1lc3NhZ2VzKCksIG51bGwsIGNob2ljZV0uY29uY2F0KHZhbHVlcykpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX3RlID0gZnVuY3Rpb24gX3RlKGtleSwgbG9jYWxlLCBtZXNzYWdlcykgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAzOwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgM107CiAgfQoKICB2YXIgX2xvY2FsZSA9IHBhcnNlQXJncy5hcHBseSh2b2lkIDAsIGFyZ3MpLmxvY2FsZSB8fCBsb2NhbGU7CgogIHJldHVybiB0aGlzLl9leGlzdChtZXNzYWdlc1tfbG9jYWxlXSwga2V5KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnRlID0gZnVuY3Rpb24gdGUoa2V5LCBsb2NhbGUpIHsKICByZXR1cm4gdGhpcy5fdGUoa2V5LCB0aGlzLmxvY2FsZSwgdGhpcy5fZ2V0TWVzc2FnZXMoKSwgbG9jYWxlKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldExvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBnZXRMb2NhbGVNZXNzYWdlKGxvY2FsZSkgewogIHJldHVybiBsb29zZUNsb25lKHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0TG9jYWxlTWVzc2FnZSA9IGZ1bmN0aW9uIHNldExvY2FsZU1lc3NhZ2UobG9jYWxlLCBtZXNzYWdlKSB7CiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIHRoaXMuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlKTsKICB9CgogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubWVzc2FnZXMsIGxvY2FsZSwgbWVzc2FnZSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5tZXJnZUxvY2FsZU1lc3NhZ2UgPSBmdW5jdGlvbiBtZXJnZUxvY2FsZU1lc3NhZ2UobG9jYWxlLCBtZXNzYWdlKSB7CiAgaWYgKHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlID09PSAnd2FybicgfHwgdGhpcy5fd2Fybkh0bWxJbk1lc3NhZ2UgPT09ICdlcnJvcicpIHsKICAgIHRoaXMuX2NoZWNrTG9jYWxlTWVzc2FnZShsb2NhbGUsIHRoaXMuX3dhcm5IdG1sSW5NZXNzYWdlLCBtZXNzYWdlKTsKICB9CgogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubWVzc2FnZXMsIGxvY2FsZSwgbWVyZ2Uoe30sIHRoaXMuX3ZtLm1lc3NhZ2VzW2xvY2FsZV0gfHwge30sIG1lc3NhZ2UpKTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLmdldERhdGVUaW1lRm9ybWF0ID0gZnVuY3Rpb24gZ2V0RGF0ZVRpbWVGb3JtYXQobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzW2xvY2FsZV0gfHwge30pOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuc2V0RGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBzZXREYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0uZGF0ZVRpbWVGb3JtYXRzLCBsb2NhbGUsIGZvcm1hdCk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUubWVyZ2VEYXRlVGltZUZvcm1hdCA9IGZ1bmN0aW9uIG1lcmdlRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpIHsKICB0aGlzLl92bS4kc2V0KHRoaXMuX3ZtLmRhdGVUaW1lRm9ybWF0cywgbG9jYWxlLCBtZXJnZSh0aGlzLl92bS5kYXRlVGltZUZvcm1hdHNbbG9jYWxlXSB8fCB7fSwgZm9ybWF0KSk7CgogIHRoaXMuX2NsZWFyRGF0ZVRpbWVGb3JtYXQobG9jYWxlLCBmb3JtYXQpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2NsZWFyRGF0ZVRpbWVGb3JtYXQgPSBmdW5jdGlvbiBfY2xlYXJEYXRlVGltZUZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIGZvciAodmFyIGtleSBpbiBmb3JtYXQpIHsKICAgIHZhciBpZCA9IGxvY2FsZSArICJfXyIgKyBrZXk7CgogICAgaWYgKCF0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnMuaGFzT3duUHJvcGVydHkoaWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIGRlbGV0ZSB0aGlzLl9kYXRlVGltZUZvcm1hdHRlcnNbaWRdOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9sb2NhbGl6ZURhdGVUaW1lID0gZnVuY3Rpb24gX2xvY2FsaXplRGF0ZVRpbWUodmFsdWUsIGxvY2FsZSwgZmFsbGJhY2ssIGRhdGVUaW1lRm9ybWF0cywga2V5KSB7CiAgdmFyIF9sb2NhbGUgPSBsb2NhbGU7CiAgdmFyIGZvcm1hdHMgPSBkYXRlVGltZUZvcm1hdHNbX2xvY2FsZV07CgogIHZhciBjaGFpbiA9IHRoaXMuX2dldExvY2FsZUNoYWluKGxvY2FsZSwgZmFsbGJhY2spOwoKICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYWluLmxlbmd0aDsgaSsrKSB7CiAgICB2YXIgY3VycmVudCA9IF9sb2NhbGU7CiAgICB2YXIgc3RlcCA9IGNoYWluW2ldOwogICAgZm9ybWF0cyA9IGRhdGVUaW1lRm9ybWF0c1tzdGVwXTsKICAgIF9sb2NhbGUgPSBzdGVwOyAvLyBmYWxsYmFjayBsb2NhbGUKCiAgICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byAnIiArIHN0ZXAgKyAiJyBkYXRldGltZSBmb3JtYXRzIGZyb20gJyIgKyBjdXJyZW50ICsgIicgZGF0ZXRpbWUgZm9ybWF0cy4iKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgYnJlYWs7CiAgICB9CiAgfQoKICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICByZXR1cm4gbnVsbDsKICB9IGVsc2UgewogICAgdmFyIGZvcm1hdCA9IGZvcm1hdHNba2V5XTsKICAgIHZhciBpZCA9IF9sb2NhbGUgKyAiX18iICsga2V5OwogICAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2RhdGVUaW1lRm9ybWF0dGVyc1tpZF07CgogICAgaWYgKCFmb3JtYXR0ZXIpIHsKICAgICAgZm9ybWF0dGVyID0gdGhpcy5fZGF0ZVRpbWVGb3JtYXR0ZXJzW2lkXSA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KF9sb2NhbGUsIGZvcm1hdCk7CiAgICB9CgogICAgcmV0dXJuIGZvcm1hdHRlci5mb3JtYXQodmFsdWUpOwogIH0KfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9kID0gZnVuY3Rpb24gX2QodmFsdWUsIGxvY2FsZSwga2V5KSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIVZ1ZUkxOG4uYXZhaWxhYmlsaXRpZXMuZGF0ZVRpbWVGb3JtYXQpIHsKICAgIHdhcm4oJ0Nhbm5vdCBmb3JtYXQgYSBEYXRlIHZhbHVlIGR1ZSB0byBub3Qgc3VwcG9ydGVkIEludGwuRGF0ZVRpbWVGb3JtYXQuJyk7CiAgICByZXR1cm4gJyc7CiAgfQoKICBpZiAoIWtleSkgewogICAgcmV0dXJuIG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSkuZm9ybWF0KHZhbHVlKTsKICB9CgogIHZhciByZXQgPSB0aGlzLl9sb2NhbGl6ZURhdGVUaW1lKHZhbHVlLCBsb2NhbGUsIHRoaXMuZmFsbGJhY2tMb2NhbGUsIHRoaXMuX2dldERhdGVUaW1lRm9ybWF0cygpLCBrZXkpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGRhdGV0aW1lIGxvY2FsaXphdGlvbiBvZiByb290OiBrZXkgJyIgKyBrZXkgKyAiJy4iKTsKICAgIH0KICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwoKCiAgICBpZiAoIXRoaXMuX3Jvb3QpIHsKICAgICAgdGhyb3cgRXJyb3IoJ3VuZXhwZWN0ZWQgZXJyb3InKTsKICAgIH0KCiAgICByZXR1cm4gdGhpcy5fcm9vdC4kaTE4bi5kKHZhbHVlLCBrZXksIGxvY2FsZSk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXQgfHwgJyc7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuZCA9IGZ1bmN0aW9uIGQodmFsdWUpIHsKICB2YXIgYXJncyA9IFtdLAogICAgICBsZW4gPSBhcmd1bWVudHMubGVuZ3RoIC0gMTsKCiAgd2hpbGUgKGxlbi0tID4gMCkgewogICAgYXJnc1tsZW5dID0gYXJndW1lbnRzW2xlbiArIDFdOwogIH0KCiAgdmFyIGxvY2FsZSA9IHRoaXMubG9jYWxlOwogIHZhciBrZXkgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfSBlbHNlIGlmIChpc09iamVjdChhcmdzWzBdKSkgewogICAgICBpZiAoYXJnc1swXS5sb2NhbGUpIHsKICAgICAgICBsb2NhbGUgPSBhcmdzWzBdLmxvY2FsZTsKICAgICAgfQoKICAgICAgaWYgKGFyZ3NbMF0ua2V5KSB7CiAgICAgICAga2V5ID0gYXJnc1swXS5rZXk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSAyKSB7CiAgICBpZiAoaXNTdHJpbmcoYXJnc1swXSkpIHsKICAgICAga2V5ID0gYXJnc1swXTsKICAgIH0KCiAgICBpZiAoaXNTdHJpbmcoYXJnc1sxXSkpIHsKICAgICAgbG9jYWxlID0gYXJnc1sxXTsKICAgIH0KICB9CgogIHJldHVybiB0aGlzLl9kKHZhbHVlLCBsb2NhbGUsIGtleSk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5nZXROdW1iZXJGb3JtYXQgPSBmdW5jdGlvbiBnZXROdW1iZXJGb3JtYXQobG9jYWxlKSB7CiAgcmV0dXJuIGxvb3NlQ2xvbmUodGhpcy5fdm0ubnVtYmVyRm9ybWF0c1tsb2NhbGVdIHx8IHt9KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLnNldE51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIHNldE51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIHRoaXMuX3ZtLiRzZXQodGhpcy5fdm0ubnVtYmVyRm9ybWF0cywgbG9jYWxlLCBmb3JtYXQpOwoKICB0aGlzLl9jbGVhck51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCk7Cn07CgpWdWVJMThuLnByb3RvdHlwZS5tZXJnZU51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIG1lcmdlTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KSB7CiAgdGhpcy5fdm0uJHNldCh0aGlzLl92bS5udW1iZXJGb3JtYXRzLCBsb2NhbGUsIG1lcmdlKHRoaXMuX3ZtLm51bWJlckZvcm1hdHNbbG9jYWxlXSB8fCB7fSwgZm9ybWF0KSk7CgogIHRoaXMuX2NsZWFyTnVtYmVyRm9ybWF0KGxvY2FsZSwgZm9ybWF0KTsKfTsKClZ1ZUkxOG4ucHJvdG90eXBlLl9jbGVhck51bWJlckZvcm1hdCA9IGZ1bmN0aW9uIF9jbGVhck51bWJlckZvcm1hdChsb2NhbGUsIGZvcm1hdCkgewogIGZvciAodmFyIGtleSBpbiBmb3JtYXQpIHsKICAgIHZhciBpZCA9IGxvY2FsZSArICJfXyIgKyBrZXk7CgogICAgaWYgKCF0aGlzLl9udW1iZXJGb3JtYXR0ZXJzLmhhc093blByb3BlcnR5KGlkKSkgewogICAgICBjb250aW51ZTsKICAgIH0KCiAgICBkZWxldGUgdGhpcy5fbnVtYmVyRm9ybWF0dGVyc1tpZF07CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX2dldE51bWJlckZvcm1hdHRlciA9IGZ1bmN0aW9uIF9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgZmFsbGJhY2ssIG51bWJlckZvcm1hdHMsIGtleSwgb3B0aW9ucykgewogIHZhciBfbG9jYWxlID0gbG9jYWxlOwogIHZhciBmb3JtYXRzID0gbnVtYmVyRm9ybWF0c1tfbG9jYWxlXTsKCiAgdmFyIGNoYWluID0gdGhpcy5fZ2V0TG9jYWxlQ2hhaW4obG9jYWxlLCBmYWxsYmFjayk7CgogIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhaW4ubGVuZ3RoOyBpKyspIHsKICAgIHZhciBjdXJyZW50ID0gX2xvY2FsZTsKICAgIHZhciBzdGVwID0gY2hhaW5baV07CiAgICBmb3JtYXRzID0gbnVtYmVyRm9ybWF0c1tzdGVwXTsKICAgIF9sb2NhbGUgPSBzdGVwOyAvLyBmYWxsYmFjayBsb2NhbGUKCiAgICBpZiAoaXNOdWxsKGZvcm1hdHMpIHx8IGlzTnVsbChmb3JtYXRzW2tleV0pKSB7CiAgICAgIGlmIChzdGVwICE9PSBsb2NhbGUgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJyAmJiAhdGhpcy5faXNTaWxlbnRUcmFuc2xhdGlvbldhcm4oa2V5KSAmJiAhdGhpcy5faXNTaWxlbnRGYWxsYmFja1dhcm4oa2V5KSkgewogICAgICAgIHdhcm4oIkZhbGwgYmFjayB0byAnIiArIHN0ZXAgKyAiJyBudW1iZXIgZm9ybWF0cyBmcm9tICciICsgY3VycmVudCArICInIG51bWJlciBmb3JtYXRzLiIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CgogIGlmIChpc051bGwoZm9ybWF0cykgfHwgaXNOdWxsKGZvcm1hdHNba2V5XSkpIHsKICAgIHJldHVybiBudWxsOwogIH0gZWxzZSB7CiAgICB2YXIgZm9ybWF0ID0gZm9ybWF0c1trZXldOwogICAgdmFyIGZvcm1hdHRlcjsKCiAgICBpZiAob3B0aW9ucykgewogICAgICAvLyBJZiBvcHRpb25zIHNwZWNpZmllZCAtIGNyZWF0ZSBvbmUgdGltZSBudW1iZXIgZm9ybWF0dGVyCiAgICAgIGZvcm1hdHRlciA9IG5ldyBJbnRsLk51bWJlckZvcm1hdChfbG9jYWxlLCBPYmplY3QuYXNzaWduKHt9LCBmb3JtYXQsIG9wdGlvbnMpKTsKICAgIH0gZWxzZSB7CiAgICAgIHZhciBpZCA9IF9sb2NhbGUgKyAiX18iICsga2V5OwogICAgICBmb3JtYXR0ZXIgPSB0aGlzLl9udW1iZXJGb3JtYXR0ZXJzW2lkXTsKCiAgICAgIGlmICghZm9ybWF0dGVyKSB7CiAgICAgICAgZm9ybWF0dGVyID0gdGhpcy5fbnVtYmVyRm9ybWF0dGVyc1tpZF0gPSBuZXcgSW50bC5OdW1iZXJGb3JtYXQoX2xvY2FsZSwgZm9ybWF0KTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmb3JtYXR0ZXI7CiAgfQp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX24gPSBmdW5jdGlvbiBfbih2YWx1ZSwgbG9jYWxlLCBrZXksIG9wdGlvbnMpIHsKICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICBpZiAoIVZ1ZUkxOG4uYXZhaWxhYmlsaXRpZXMubnVtYmVyRm9ybWF0KSB7CiAgICBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgewogICAgICB3YXJuKCdDYW5ub3QgZm9ybWF0IGEgTnVtYmVyIHZhbHVlIGR1ZSB0byBub3Qgc3VwcG9ydGVkIEludGwuTnVtYmVyRm9ybWF0LicpOwogICAgfQoKICAgIHJldHVybiAnJzsKICB9CgogIGlmICgha2V5KSB7CiAgICB2YXIgbmYgPSAhb3B0aW9ucyA/IG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUpIDogbmV3IEludGwuTnVtYmVyRm9ybWF0KGxvY2FsZSwgb3B0aW9ucyk7CiAgICByZXR1cm4gbmYuZm9ybWF0KHZhbHVlKTsKICB9CgogIHZhciBmb3JtYXR0ZXIgPSB0aGlzLl9nZXROdW1iZXJGb3JtYXR0ZXIodmFsdWUsIGxvY2FsZSwgdGhpcy5mYWxsYmFja0xvY2FsZSwgdGhpcy5fZ2V0TnVtYmVyRm9ybWF0cygpLCBrZXksIG9wdGlvbnMpOwoKICB2YXIgcmV0ID0gZm9ybWF0dGVyICYmIGZvcm1hdHRlci5mb3JtYXQodmFsdWUpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkgJiYgIXRoaXMuX2lzU2lsZW50RmFsbGJhY2tXYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIG51bWJlciBsb2NhbGl6YXRpb24gb2Ygcm9vdDoga2V5ICciICsga2V5ICsgIicuIik7CiAgICB9CiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KCgogICAgaWYgKCF0aGlzLl9yb290KSB7CiAgICAgIHRocm93IEVycm9yKCd1bmV4cGVjdGVkIGVycm9yJyk7CiAgICB9CgogICAgcmV0dXJuIHRoaXMuX3Jvb3QuJGkxOG4ubih2YWx1ZSwgT2JqZWN0LmFzc2lnbih7fSwgewogICAgICBrZXk6IGtleSwKICAgICAgbG9jYWxlOiBsb2NhbGUKICAgIH0sIG9wdGlvbnMpKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHJldCB8fCAnJzsKICB9Cn07CgpWdWVJMThuLnByb3RvdHlwZS5uID0gZnVuY3Rpb24gbih2YWx1ZSkgewogIHZhciBhcmdzID0gW10sCiAgICAgIGxlbiA9IGFyZ3VtZW50cy5sZW5ndGggLSAxOwoKICB3aGlsZSAobGVuLS0gPiAwKSB7CiAgICBhcmdzW2xlbl0gPSBhcmd1bWVudHNbbGVuICsgMV07CiAgfQoKICB2YXIgbG9jYWxlID0gdGhpcy5sb2NhbGU7CiAgdmFyIGtleSA9IG51bGw7CiAgdmFyIG9wdGlvbnMgPSBudWxsOwoKICBpZiAoYXJncy5sZW5ndGggPT09IDEpIHsKICAgIGlmIChpc1N0cmluZyhhcmdzWzBdKSkgewogICAgICBrZXkgPSBhcmdzWzBdOwogICAgfSBlbHNlIGlmIChpc09iamVjdChhcmdzWzBdKSkgewogICAgICBpZiAoYXJnc1swXS5sb2NhbGUpIHsKICAgICAgICBsb2NhbGUgPSBhcmdzWzBdLmxvY2FsZTsKICAgICAgfQoKICAgICAgaWYgKGFyZ3NbMF0ua2V5KSB7CiAgICAgICAga2V5ID0gYXJnc1swXS5rZXk7CiAgICAgIH0gLy8gRmlsdGVyIG91dCBudW1iZXIgZm9ybWF0IG9wdGlvbnMgb25seQoKCiAgICAgIG9wdGlvbnMgPSBPYmplY3Qua2V5cyhhcmdzWzBdKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7CiAgICAgICAgdmFyIG9iajsKCiAgICAgICAgaWYgKGluY2x1ZGVzKG51bWJlckZvcm1hdEtleXMsIGtleSkpIHsKICAgICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKHt9LCBhY2MsIChvYmogPSB7fSwgb2JqW2tleV0gPSBhcmdzWzBdW2tleV0sIG9iaikpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGFjYzsKICAgICAgfSwgbnVsbCk7CiAgICB9CiAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA9PT0gMikgewogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMF0pKSB7CiAgICAgIGtleSA9IGFyZ3NbMF07CiAgICB9CgogICAgaWYgKGlzU3RyaW5nKGFyZ3NbMV0pKSB7CiAgICAgIGxvY2FsZSA9IGFyZ3NbMV07CiAgICB9CiAgfQoKICByZXR1cm4gdGhpcy5fbih2YWx1ZSwgbG9jYWxlLCBrZXksIG9wdGlvbnMpOwp9OwoKVnVlSTE4bi5wcm90b3R5cGUuX250cCA9IGZ1bmN0aW9uIF9udHAodmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKSB7CiAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCiAgaWYgKCFWdWVJMThuLmF2YWlsYWJpbGl0aWVzLm51bWJlckZvcm1hdCkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHsKICAgICAgd2FybignQ2Fubm90IGZvcm1hdCB0byBwYXJ0cyBhIE51bWJlciB2YWx1ZSBkdWUgdG8gbm90IHN1cHBvcnRlZCBJbnRsLk51bWJlckZvcm1hdC4nKTsKICAgIH0KCiAgICByZXR1cm4gW107CiAgfQoKICBpZiAoIWtleSkgewogICAgdmFyIG5mID0gIW9wdGlvbnMgPyBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlKSA6IG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIG9wdGlvbnMpOwogICAgcmV0dXJuIG5mLmZvcm1hdFRvUGFydHModmFsdWUpOwogIH0KCiAgdmFyIGZvcm1hdHRlciA9IHRoaXMuX2dldE51bWJlckZvcm1hdHRlcih2YWx1ZSwgbG9jYWxlLCB0aGlzLmZhbGxiYWNrTG9jYWxlLCB0aGlzLl9nZXROdW1iZXJGb3JtYXRzKCksIGtleSwgb3B0aW9ucyk7CgogIHZhciByZXQgPSBmb3JtYXR0ZXIgJiYgZm9ybWF0dGVyLmZvcm1hdFRvUGFydHModmFsdWUpOwoKICBpZiAodGhpcy5faXNGYWxsYmFja1Jvb3QocmV0KSkgewogICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicgJiYgIXRoaXMuX2lzU2lsZW50VHJhbnNsYXRpb25XYXJuKGtleSkpIHsKICAgICAgd2FybigiRmFsbCBiYWNrIHRvIGZvcm1hdCBudW1iZXIgdG8gcGFydHMgb2Ygcm9vdDoga2V5ICciICsga2V5ICsgIicgLiIpOwogICAgfQogICAgLyogaXN0YW5idWwgaWdub3JlIGlmICovCgoKICAgIGlmICghdGhpcy5fcm9vdCkgewogICAgICB0aHJvdyBFcnJvcigndW5leHBlY3RlZCBlcnJvcicpOwogICAgfQoKICAgIHJldHVybiB0aGlzLl9yb290LiRpMThuLl9udHAodmFsdWUsIGxvY2FsZSwga2V5LCBvcHRpb25zKTsKICB9IGVsc2UgewogICAgcmV0dXJuIHJldCB8fCBbXTsKICB9Cn07CgpPYmplY3QuZGVmaW5lUHJvcGVydGllcyhWdWVJMThuLnByb3RvdHlwZSwgcHJvdG90eXBlQWNjZXNzb3JzKTsKdmFyIGF2YWlsYWJpbGl0aWVzOyAvLyAkRmxvd0ZpeE1lCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoVnVlSTE4biwgJ2F2YWlsYWJpbGl0aWVzJywgewogIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgaWYgKCFhdmFpbGFiaWxpdGllcykgewogICAgICB2YXIgaW50bERlZmluZWQgPSB0eXBlb2YgSW50bCAhPT0gJ3VuZGVmaW5lZCc7CiAgICAgIGF2YWlsYWJpbGl0aWVzID0gewogICAgICAgIGRhdGVUaW1lRm9ybWF0OiBpbnRsRGVmaW5lZCAmJiB0eXBlb2YgSW50bC5EYXRlVGltZUZvcm1hdCAhPT0gJ3VuZGVmaW5lZCcsCiAgICAgICAgbnVtYmVyRm9ybWF0OiBpbnRsRGVmaW5lZCAmJiB0eXBlb2YgSW50bC5OdW1iZXJGb3JtYXQgIT09ICd1bmRlZmluZWQnCiAgICAgIH07CiAgICB9CgogICAgcmV0dXJuIGF2YWlsYWJpbGl0aWVzOwogIH0KfSk7ClZ1ZUkxOG4uaW5zdGFsbCA9IGluc3RhbGw7ClZ1ZUkxOG4udmVyc2lvbiA9ICc4LjIyLjEnOwpleHBvcnQgZGVmYXVsdCBWdWVJMThuOw=="},null]}