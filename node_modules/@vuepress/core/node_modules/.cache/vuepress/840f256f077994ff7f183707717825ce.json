{"remainingRequest":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js??ref--3-1!/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-github-v3/lib/index.js","dependencies":[{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-github-v3/lib/index.js","mtime":1604064595597},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/cache-loader/dist/cjs.js","mtime":1603041438982},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js","mtime":1603041438713}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5kYXRlLm5vdyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnJlcGxhY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuc2VhcmNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLmxpbmsiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF9zbGljZWRUb0FycmF5IGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vc2xpY2VkVG9BcnJheSI7CmltcG9ydCBfdG9Db25zdW1hYmxlQXJyYXkgZnJvbSAiL29wdC9teWJsb2cvdnVlcHJlc3MtdGhlbWUtcmVjby1tYXN0ZXIvemRibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL29wdC9teWJsb2cvdnVlcHJlc3MtdGhlbWUtcmVjby1tYXN0ZXIvemRibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL29wdC9teWJsb2cvdnVlcHJlc3MtdGhlbWUtcmVjby1tYXN0ZXIvemRibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGJ1aWxkVVJMLCBjb25jYXRVUkwsIGdldENsZWFuVVJMLCBwYXJzZVF1ZXJ5IH0gZnJvbSAnQHZzc3VlL3V0aWxzJzsKaW1wb3J0IHsgbm9ybWFsaXplVXNlciwgbm9ybWFsaXplSXNzdWUsIG5vcm1hbGl6ZUNvbW1lbnQsIG5vcm1hbGl6ZVJlYWN0aW9ucywgbWFwUmVhY3Rpb25OYW1lIH0gZnJvbSAnLi91dGlscyc7Ci8qKgogKiBHaXRodWIgUkVTVCBBUEkgdjMKICoKICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzLwogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzLwogKi8KCnZhciBHaXRodWJWMyA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gR2l0aHViVjMoX3JlZikgewogICAgdmFyIF9yZWYkYmFzZVVSTCA9IF9yZWYuYmFzZVVSTCwKICAgICAgICBiYXNlVVJMID0gX3JlZiRiYXNlVVJMID09PSB2b2lkIDAgPyAnaHR0cHM6Ly9naXRodWIuY29tJyA6IF9yZWYkYmFzZVVSTCwKICAgICAgICBvd25lciA9IF9yZWYub3duZXIsCiAgICAgICAgcmVwbyA9IF9yZWYucmVwbywKICAgICAgICBsYWJlbHMgPSBfcmVmLmxhYmVscywKICAgICAgICBjbGllbnRJZCA9IF9yZWYuY2xpZW50SWQsCiAgICAgICAgY2xpZW50U2VjcmV0ID0gX3JlZi5jbGllbnRTZWNyZXQsCiAgICAgICAgc3RhdGUgPSBfcmVmLnN0YXRlLAogICAgICAgIHByb3h5ID0gX3JlZi5wcm94eTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2l0aHViVjMpOwoKICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBpZiAqLwogICAgaWYgKHR5cGVvZiBjbGllbnRTZWNyZXQgPT09ICd1bmRlZmluZWQnIHx8IHR5cGVvZiBwcm94eSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjbGllbnRTZWNyZXQgYW5kIHByb3h5IGlzIHJlcXVpcmVkIGZvciBHaXRIdWIgVjMnKTsKICAgIH0KCiAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMOwogICAgdGhpcy5vd25lciA9IG93bmVyOwogICAgdGhpcy5yZXBvID0gcmVwbzsKICAgIHRoaXMubGFiZWxzID0gbGFiZWxzOwogICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOwogICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLnByb3h5ID0gcHJveHk7CiAgICB0aGlzLiRodHRwID0gYXhpb3MuY3JlYXRlKHsKICAgICAgYmFzZVVSTDogYmFzZVVSTCA9PT0gJ2h0dHBzOi8vZ2l0aHViLmNvbScgPyAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbScgOiBjb25jYXRVUkwoYmFzZVVSTCwgJ2FwaS92MycpLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJGh0dHAuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgaWYgKHJlc3BvbnNlLmRhdGEgJiYgcmVzcG9uc2UuZGF0YS5lcnJvcikgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IocmVzcG9uc2UuZGF0YS5lcnJvcl9kZXNjcmlwdGlvbikpOwogICAgICB9CgogICAgICByZXR1cm4gcmVzcG9uc2U7CiAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgLy8gNDAzIHJhdGUgbGltaXQgZXhjZWVkZWQgaW4gT1BUSU9OUyByZXF1ZXN0IHdpbGwgY2F1c2UgYSBOZXR3b3JrIEVycm9yCiAgICAgIC8vIGhlcmUgd2UgYWx3YXlzIHRyZWF0IE5ldHdvcmsgRXJyb3IgYXMgNDAzIHJhdGUgbGltaXQgZXhjZWVkZWQKICAgICAgLy8gQHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXhpb3MvYXhpb3MvaXNzdWVzLzgzOAoKICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KICAgICAgaWYgKHR5cGVvZiBlcnJvci5yZXNwb25zZSA9PT0gJ3VuZGVmaW5lZCcgJiYgZXJyb3IubWVzc2FnZSA9PT0gJ05ldHdvcmsgRXJyb3InKSB7CiAgICAgICAgZXJyb3IucmVzcG9uc2UgPSB7CiAgICAgICAgICBzdGF0dXM6IDQwMwogICAgICAgIH07CiAgICAgIH0KCiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlcnJvcik7CiAgICB9KTsKICB9CiAgLyoqCiAgICogVGhlIHBsYXRmb3JtIGFwaSBpbmZvCiAgICovCgoKICBfY3JlYXRlQ2xhc3MoR2l0aHViVjMsIFt7CiAgICBrZXk6ICJyZWRpcmVjdEF1dGgiLAoKICAgIC8qKgogICAgICogUmVkaXJlY3QgdG8gdGhlIGF1dGhvcml6YXRpb24gcGFnZSBvZiBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzL2F1dGhvcml6aW5nLW9hdXRoLWFwcHMvIzEtcmVxdWVzdC1hLXVzZXJzLWdpdGh1Yi1pZGVudGl0eQogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVkaXJlY3RBdXRoKCkgewogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IGJ1aWxkVVJMKGNvbmNhdFVSTCh0aGlzLmJhc2VVUkwsICdsb2dpbi9vYXV0aC9hdXRob3JpemUnKSwgewogICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICByZWRpcmVjdF91cmk6IHdpbmRvdy5sb2NhdGlvbi5ocmVmLAogICAgICAgIHNjb3BlOiAncHVibGljX3JlcG8nLAogICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlCiAgICAgIH0pOwogICAgfQogICAgLyoqCiAgICAgKiBIYW5kbGUgYXV0aG9yaXphdGlvbi4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzL2F1dGhvcml6aW5nLW9hdXRoLWFwcHMvCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIElmIHRoZSBgY29kZWAgYW5kIGBzdGF0ZWAgZXhpc3QgaW4gdGhlIHF1ZXJ5LCBhbmQgdGhlIGBzdGF0ZWAgbWF0Y2hlcywgcmVtb3ZlIHRoZW0gZnJvbSBxdWVyeSwgYW5kIHRyeSB0byBnZXQgdGhlIGFjY2VzcyB0b2tlbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVBdXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaGFuZGxlQXV0aCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgcXVlcnksIGNvZGUsIHJlcGxhY2VVUkwsIGFjY2Vzc1Rva2VuOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gcGFyc2VRdWVyeSh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKCiAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIShxdWVyeS5zdGF0ZSAhPT0gdGhpcy5zdGF0ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjb2RlID0gcXVlcnkuY29kZTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5jb2RlOwogICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5LnN0YXRlOwogICAgICAgICAgICAgICAgcmVwbGFjZVVSTCA9IGJ1aWxkVVJMKGdldENsZWFuVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSwgcXVlcnkpICsgd2luZG93LmxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgJycsIHJlcGxhY2VVUkwpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWNjZXNzVG9rZW4oewogICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGFjY2Vzc1Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZUF1dGgoKSB7CiAgICAgICAgcmV0dXJuIF9oYW5kbGVBdXRoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoYW5kbGVBdXRoOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCB1c2VyIGFjY2VzcyB0b2tlbiB2aWEgYGNvZGVgCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLyMyLXVzZXJzLWFyZS1yZWRpcmVjdGVkLWJhY2stdG8teW91ci1zaXRlLWJ5LWdpdGh1YgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldEFjY2Vzc1Rva2VuIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0QWNjZXNzVG9rZW4gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUyKF9yZWYyKSB7CiAgICAgICAgdmFyIGNvZGUsIG9yaWdpbmFsVVJMLCBwcm94eVVSTCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTIkKF9jb250ZXh0MikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDIucHJldiA9IF9jb250ZXh0Mi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgY29kZSA9IF9yZWYyLmNvZGU7CgogICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgKiBhY2Nlc3NfdG9rZW4gYXBpIGRvZXMgbm90IHN1cHBvcnQgY29ycwogICAgICAgICAgICAgICAgICogQHNlZSBodHRwczovL2dpdGh1Yi5jb20vaXNhYWNzL2dpdGh1Yi9pc3N1ZXMvMzMwCiAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgIG9yaWdpbmFsVVJMID0gY29uY2F0VVJMKHRoaXMuYmFzZVVSTCwgJ2xvZ2luL29hdXRoL2FjY2Vzc190b2tlbicpOwogICAgICAgICAgICAgICAgcHJveHlVUkwgPSB0eXBlb2YgdGhpcy5wcm94eSA9PT0gJ2Z1bmN0aW9uJyA/IHRoaXMucHJveHkob3JpZ2luYWxVUkwpIDogdGhpcy5wcm94eTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Mi5uZXh0ID0gNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QocHJveHlVUkwsIHsKICAgICAgICAgICAgICAgICAgY2xpZW50X2lkOiB0aGlzLmNsaWVudElkLAogICAgICAgICAgICAgICAgICBjbGllbnRfc2VjcmV0OiB0aGlzLmNsaWVudFNlY3JldCwKICAgICAgICAgICAgICAgICAgY29kZTogY29kZQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvcy5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGRhdGEuYWNjZXNzX3Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oX3gpIHsKICAgICAgICByZXR1cm4gX2dldEFjY2Vzc1Rva2VuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRBY2Nlc3NUb2tlbjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxvZ2dlZC1pbiB1c2VyIHdpdGggYWNjZXNzIHRva2VuLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My91c2Vycy8jZ2V0LXRoZS1hdXRoZW50aWNhdGVkLXVzZXIKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRVc2VyIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0VXNlciA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTMoX3JlZjMpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIF95aWVsZCR0aGlzJCRodHRwJGdldCwgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjMuYWNjZXNzVG9rZW47CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoJ3VzZXInLCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRnZXQgPSBfY29udGV4dDMuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRnZXQuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVVc2VyKGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0VXNlcihfeDIpIHsKICAgICAgICByZXR1cm4gX2dldFVzZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldFVzZXI7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IGlzc3VlIG9mIHRoaXMgcGFnZSBhY2NvcmRpbmcgdG8gdGhlIGlzc3VlIGlkIG9yIHRoZSBpc3N1ZSB0aXRsZQogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvI2xpc3QtaXNzdWVzLWZvci1hLXJlcG9zaXRvcnkKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvI2dldC1hLXNpbmdsZS1pc3N1ZQogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzLyNwYWdpbmF0aW9uCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvc2VhcmNoLyNzZWFyY2gtaXNzdWVzLWFuZC1wdWxsLXJlcXVlc3RzCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0SXNzdWUiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRJc3N1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTQoX3JlZjQpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIGlzc3VlVGl0bGUsIG9wdGlvbnMsIF95aWVsZCR0aGlzJCRodHRwJGdldDIsIGRhdGEsIF95aWVsZCR0aGlzJCRodHRwJGdldDMsIF9kYXRhLCBpc3N1ZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjQuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNC5pc3N1ZUlkLCBpc3N1ZVRpdGxlID0gX3JlZjQuaXNzdWVUaXRsZTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWlzc3VlSWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSA0OwogICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJhbXMgPSB7CiAgICAgICAgICAgICAgICAgIC8vIHRvIGF2b2lkIGNhY2hpbmcKICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzLyIpLmNvbmNhdChpc3N1ZUlkKSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGdldDIgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRnZXQyLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoZGF0YSkpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSAxMzsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC50MCA9IF9jb250ZXh0NFsiY2F0Y2giXSg0KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDQudDAucmVzcG9uc2UgJiYgX2NvbnRleHQ0LnQwLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDQudDA7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI5OwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBvcHRpb25zLnBhcmFtcyA9IHsKICAgICAgICAgICAgICAgICAgcTogWyJcIiIuY29uY2F0KGlzc3VlVGl0bGUsICJcIiIpLCAiaXM6aXNzdWUiLCAiaW46dGl0bGUiLCAicmVwbzoiLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8pLCAiaXM6cHVibGljIl0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheSh0aGlzLmxhYmVscy5tYXAoZnVuY3Rpb24gKGxhYmVsKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJsYWJlbDoiLmNvbmNhdChsYWJlbCk7CiAgICAgICAgICAgICAgICAgIH0pKSkuam9pbignICcpLAogICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInNlYXJjaC9pc3N1ZXMiLCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSAyNToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGdldDMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF9kYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0My5kYXRhOwogICAgICAgICAgICAgICAgaXNzdWUgPSBfZGF0YS5pdGVtcy5tYXAobm9ybWFsaXplSXNzdWUpLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGl0bGUgPT09IGlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBpc3N1ZSB8fCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAyOToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcywgW1s0LCAxM11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0SXNzdWUoX3gzKSB7CiAgICAgICAgcmV0dXJuIF9nZXRJc3N1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGlzc3VlCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL2lzc3Vlcy8jY3JlYXRlLWFuLWlzc3VlCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdElzc3VlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShfcmVmNSkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgdGl0bGUsIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHBvczIsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY1LmFjY2Vzc1Rva2VuLCB0aXRsZSA9IF9yZWY1LnRpdGxlLCBjb250ZW50ID0gX3JlZjUuY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMiKSwgewogICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICAgIGxhYmVsczogdGhpcy5sYWJlbHMKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczIgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoZGF0YSkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0SXNzdWUoX3g0KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0SXNzdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RJc3N1ZTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgY29tbWVudHMgb2YgdGhpcyBwYWdlIGFjY29yZGluZyB0byB0aGUgaXNzdWUgaWQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzL2NvbW1lbnRzLyNsaXN0LWNvbW1lbnRzLW9uLWFuLWlzc3VlCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvI3BhZ2luYXRpb24KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogR2l0aHViIFYzIGRvZXMgbm90IHN1cHBvcnQgc29ydCBmb3IgaXNzdWUgY29tbWVudHMgbm93LgogICAgICogR2l0aHViIFYzIGhhdmUgdG8gcmVxdWVzdCB0aGUgcGFyZW50IGlzc3VlIHRvIGdldCB0aGUgY291bnQgb2YgY29tbWVudHMuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29tbWVudHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50cyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoX3JlZjYpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIF9yZWY2JHF1ZXJ5LCBfcmVmNiRxdWVyeSRwYWdlLCBwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlLCBwZXJQYWdlLCBpc3N1ZU9wdGlvbnMsIGNvbW1lbnRzT3B0aW9ucywgX3lpZWxkJFByb21pc2UkYWxsLCBfeWllbGQkUHJvbWlzZSRhbGwyLCBpc3N1ZVJlcywgY29tbWVudHNSZXMsIGxpbmtIZWFkZXIsIHRoaXNQYWdlLCB0aGlzUGVyUGFnZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU2JChfY29udGV4dDYpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ2LnByZXYgPSBfY29udGV4dDYubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjYuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNi5pc3N1ZUlkLCBfcmVmNiRxdWVyeSA9IF9yZWY2LnF1ZXJ5OwogICAgICAgICAgICAgICAgX3JlZjYkcXVlcnkgPSBfcmVmNiRxdWVyeSA9PT0gdm9pZCAwID8ge30gOiBfcmVmNiRxdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY2JHF1ZXJ5JHBhZ2UgPSBfcmVmNiRxdWVyeS5wYWdlLCBwYWdlID0gX3JlZjYkcXVlcnkkcGFnZSA9PT0gdm9pZCAwID8gMSA6IF9yZWY2JHF1ZXJ5JHBhZ2UsIF9yZWY2JHF1ZXJ5JHBlclBhZ2UgPSBfcmVmNiRxdWVyeS5wZXJQYWdlLCBwZXJQYWdlID0gX3JlZjYkcXVlcnkkcGVyUGFnZSA9PT0gdm9pZCAwID8gMTAgOiBfcmVmNiRxdWVyeSRwZXJQYWdlOwogICAgICAgICAgICAgICAgaXNzdWVPcHRpb25zID0gewogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICBjb21tZW50c09wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIC8vIHBhZ2luYXRpb24KICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLAogICAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiBwZXJQYWdlLAoKICAgICAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAgICAgKiBnaXRodWIgdjMgYXBpIGRvZXMgbm90IHN1cHBvcnQgc29ydCBmb3IgaXNzdWUgY29tbWVudHMKICAgICAgICAgICAgICAgICAgICAgKiBoYXZlIHNlbnQgZmVlZGJhY2sgdG8gZ2l0aHViIHN1cHBvcnQKICAgICAgICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAgICAgICAvLyAnc29ydCc6ICdjcmVhdGVkJywKICAgICAgICAgICAgICAgICAgICAvLyAnZGlyZWN0aW9uJzogc29ydCwKICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6IFsnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52My5yYXcranNvbicsICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzLmh0bWwranNvbicsICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnNxdWlycmVsLWdpcmwtcHJldmlldyddCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIGlzc3VlT3B0aW9ucy5oZWFkZXJzID0gewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgY29tbWVudHNPcHRpb25zLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbik7CiAgICAgICAgICAgICAgICB9IC8vIGdpdGh1YiB2MyBoYXZlIHRvIGdldCB0aGUgdG90YWwgY291bnQgb2YgY29tbWVudHMgYnkgcmVxdWVzdGluZyB0aGUgaXNzdWUKCgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA4OwogICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLiRodHRwLmdldCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCksIGlzc3VlT3B0aW9ucyksIHRoaXMuJGh0dHAuZ2V0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzLyIpLmNvbmNhdChpc3N1ZUlkLCAiL2NvbW1lbnRzIiksIGNvbW1lbnRzT3B0aW9ucyldKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgICAgX3lpZWxkJFByb21pc2UkYWxsID0gX2NvbnRleHQ2LnNlbnQ7CiAgICAgICAgICAgICAgICBfeWllbGQkUHJvbWlzZSRhbGwyID0gX3NsaWNlZFRvQXJyYXkoX3lpZWxkJFByb21pc2UkYWxsLCAyKTsKICAgICAgICAgICAgICAgIGlzc3VlUmVzID0gX3lpZWxkJFByb21pc2UkYWxsMlswXTsKICAgICAgICAgICAgICAgIGNvbW1lbnRzUmVzID0gX3lpZWxkJFByb21pc2UkYWxsMlsxXTsKICAgICAgICAgICAgICAgIC8vIGl0J3MgYW5ub3lpbmcgdGhhdCBoYXZlIHRvIGdldCB0aGUgcGFnZSBhbmQgcGVyX3BhZ2UgZnJvbSB0aGUgYExpbmtgIGhlYWRlcgogICAgICAgICAgICAgICAgbGlua0hlYWRlciA9IGNvbW1lbnRzUmVzLmhlYWRlcnMubGluayB8fCBudWxsOwogICAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCiAgICAgICAgICAgICAgICB0aGlzUGFnZSA9IC9yZWw9Im5leHQiLy50ZXN0KGxpbmtIZWFkZXIpID8gTnVtYmVyKGxpbmtIZWFkZXIucmVwbGFjZSgvXi4qW15fXXBhZ2U9KFxkKikuKnJlbD0ibmV4dCIuKiQvLCAnJDEnKSkgLSAxIDogL3JlbD0icHJldiIvLnRlc3QobGlua0hlYWRlcikgPyBOdW1iZXIobGlua0hlYWRlci5yZXBsYWNlKC9eLipbXl9dcGFnZT0oXGQqKS4qcmVsPSJwcmV2Ii4qJC8sICckMScpKSArIDEgOiAxOwogICAgICAgICAgICAgICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8KCiAgICAgICAgICAgICAgICB0aGlzUGVyUGFnZSA9IGxpbmtIZWFkZXIgPyBOdW1iZXIobGlua0hlYWRlci5yZXBsYWNlKC9eLipwZXJfcGFnZT0oXGQqKS4qJC8sICckMScpKSA6IHBlclBhZ2U7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBjb3VudDogTnVtYmVyKGlzc3VlUmVzLmRhdGEuY29tbWVudHMpLAogICAgICAgICAgICAgICAgICBwYWdlOiB0aGlzUGFnZSwKICAgICAgICAgICAgICAgICAgcGVyUGFnZTogdGhpc1BlclBhZ2UsCiAgICAgICAgICAgICAgICAgIGRhdGE6IGNvbW1lbnRzUmVzLmRhdGEubWFwKG5vcm1hbGl6ZUNvbW1lbnQpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldENvbW1lbnRzKF94NSkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldENvbW1lbnRzOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL2lzc3Vlcy9jb21tZW50cy8jY3JlYXRlLWEtY29tbWVudAogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KF9yZWY3KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNy5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWY3Lmlzc3VlSWQsIGNvbnRlbnQgPSBfcmVmNy5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCwgIi9jb21tZW50cyIpLCB7CiAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBbJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMucmF3K2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52My5odG1sK2pzb24nLCAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5zcXVpcnJlbC1naXJsLXByZXZpZXcnXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMyA9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczMuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVDb21tZW50KGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnQoX3g2KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogRWRpdCBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzL2NvbW1lbnRzLyNlZGl0LWEtY29tbWVudAogICAgICovCgogIH0sIHsKICAgIGtleTogInB1dENvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wdXRDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOChfcmVmOCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwYXQsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY4LmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmOC5jb21tZW50SWQsIGNvbnRlbnQgPSBfcmVmOC5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucGF0Y2goInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCksIHsKICAgICAgICAgICAgICAgICAgYm9keTogY29udGVudAogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKSwKICAgICAgICAgICAgICAgICAgICBBY2NlcHQ6IFsnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52My5yYXcranNvbicsICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzLmh0bWwranNvbicsICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnNxdWlycmVsLWdpcmwtcHJldmlldyddCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwYXQgPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwYXQuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVDb21tZW50KGRhdGEpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU4LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcHV0Q29tbWVudChfeDcpIHsKICAgICAgICByZXR1cm4gX3B1dENvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHB1dENvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogRGVsZXRlIGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9pc3N1ZXMvY29tbWVudHMvI2RlbGV0ZS1hLWNvbW1lbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZWxldGVDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZGVsZXRlQ29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoX3JlZjkpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgX3lpZWxkJHRoaXMkJGh0dHAkZGVsLCBzdGF0dXM7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOSQoX2NvbnRleHQ5KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OS5wcmV2ID0gX2NvbnRleHQ5Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY5LmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmOS5jb21tZW50SWQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDkubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cFsiZGVsZXRlIl0oInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCksIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGRlbCA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgc3RhdHVzID0gX3lpZWxkJHRoaXMkJGh0dHAkZGVsLnN0YXR1czsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBzdGF0dXMgPT09IDIwNCk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQoX3g4KSB7CiAgICAgICAgcmV0dXJuIF9kZWxldGVDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWxldGVDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCByZWFjdGlvbnMgb2YgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3YzL2lzc3Vlcy9jb21tZW50cy8jZ2V0LWEtc2luZ2xlLWNvbW1lbnQKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9yZWFjdGlvbnMvI2xpc3QtcmVhY3Rpb25zLWZvci1hbi1pc3N1ZS1jb21tZW50CiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIFRoZSBgTGlzdCByZWFjdGlvbnMgZm9yIGFuIGlzc3VlIGNvbW1lbnRgIEFQSSBhbHNvIHJldHVybnMgYXV0aG9yIG9mIGVhY2ggcmVhY3Rpb24uCiAgICAgKiBBcyB3ZSBvbmx5IG5lZWQgdGhlIGNvdW50LCB1c2UgdGhlIGBHZXQgYSBzaW5nbGUgY29tbWVudGAgQVBJIGlzIG11Y2ggc2ltcGxlci4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRDb21tZW50UmVhY3Rpb25zIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0Q29tbWVudFJlYWN0aW9ucyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTEwKF9yZWYxMCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQ0LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTEwJChfY29udGV4dDEwKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTAucHJldiA9IF9jb250ZXh0MTAubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjEwLmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmMTAuY29tbWVudElkOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLmdldCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy9jb21tZW50cy8iKS5jb25jYXQoY29tbWVudElkKSwgewogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pLAogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3JwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0NCA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRnZXQ0LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZVJlYWN0aW9ucyhkYXRhLnJlYWN0aW9ucykpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDEwLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUxMCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldENvbW1lbnRSZWFjdGlvbnMoX3g5KSB7CiAgICAgICAgcmV0dXJuIF9nZXRDb21tZW50UmVhY3Rpb25zLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRDb21tZW50UmVhY3Rpb25zOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyByZWFjdGlvbiBvZiBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvcmVhY3Rpb25zLyNjcmVhdGUtcmVhY3Rpb24tZm9yLWFuLWlzc3VlLWNvbW1lbnQKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0Q29tbWVudFJlYWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbW1lbnRSZWFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKF9yZWYxMSkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCByZWFjdGlvbiwgcmVzcG9uc2U7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWYxMS5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjExLmNvbW1lbnRJZCwgcmVhY3Rpb24gPSBfcmVmMTEucmVhY3Rpb247CiAgICAgICAgICAgICAgICBfY29udGV4dDExLm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy9jb21tZW50cy8iKS5jb25jYXQoY29tbWVudElkLCAiL3JlYWN0aW9ucyIpLCB7CiAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IG1hcFJlYWN0aW9uTmFtZShyZWFjdGlvbikKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbiksCiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi5zcXVpcnJlbC1naXJsLXByZXZpZXcnCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0MTEuc2VudDsKCiAgICAgICAgICAgICAgICBpZiAoIShyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQxMS5uZXh0ID0gNjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB0aGlzLmRlbGV0ZUNvbW1lbnRSZWFjdGlvbih7CiAgICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBhY2Nlc3NUb2tlbiwKICAgICAgICAgICAgICAgICAgY29tbWVudElkOiBjb21tZW50SWQsCiAgICAgICAgICAgICAgICAgIHJlYWN0aW9uSWQ6IHJlc3BvbnNlLmRhdGEuaWQKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCByZXNwb25zZS5zdGF0dXMgPT09IDIwMSk7CgogICAgICAgICAgICAgIGNhc2UgNzoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTExLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnRSZWFjdGlvbihfeDEwKSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tbWVudFJlYWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwb3N0Q29tbWVudFJlYWN0aW9uOwogICAgfSgpCiAgICAvKioKICAgICAqIERlbGV0ZSBhIHJlYWN0aW9uIG9mIGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92My9yZWFjdGlvbnMvI2RlbGV0ZS1hLXJlYWN0aW9uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVsZXRlQ29tbWVudFJlYWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZGVsZXRlQ29tbWVudFJlYWN0aW9uID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTIoX3JlZjEyKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQsIHJlYWN0aW9uSWQsIHJlc3BvbnNlOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTIkKF9jb250ZXh0MTIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMi5wcmV2ID0gX2NvbnRleHQxMi5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMTIuYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCA9IF9yZWYxMi5jb21tZW50SWQsIHJlYWN0aW9uSWQgPSBfcmVmMTIucmVhY3Rpb25JZDsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTIubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cFsiZGVsZXRlIl0oInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCwgIi9yZWFjdGlvbnMvIikuY29uY2F0KHJlYWN0aW9uSWQpLCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pLAogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIuc3F1aXJyZWwtZ2lybC1wcmV2aWV3JwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSBfY29udGV4dDEyLnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5hYnJ1cHQoInJldHVybiIsIHJlc3BvbnNlLnN0YXR1cyA9PT0gMjA0KTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTIsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBkZWxldGVDb21tZW50UmVhY3Rpb24oX3gxMSkgewogICAgICAgIHJldHVybiBfZGVsZXRlQ29tbWVudFJlYWN0aW9uLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWxldGVDb21tZW50UmVhY3Rpb247CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJwbGF0Zm9ybSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnR2l0SHViJywKICAgICAgICBsaW5rOiB0aGlzLmJhc2VVUkwsCiAgICAgICAgdmVyc2lvbjogJ3YzJywKICAgICAgICBtZXRhOiB7CiAgICAgICAgICByZWFjdGFibGU6IHRydWUsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2l0aHViVjM7Cn0oKTsKCmV4cG9ydCB7IEdpdGh1YlYzIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * Github REST API v3\n *\n * @see https://developer.github.com/v3/\n * @see https://developer.github.com/apps/building-oauth-apps/\n */\nexport default class GithubV3 {\n    constructor({ baseURL = 'https://github.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        /* istanbul ignore if */\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for GitHub V3');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this.$http = axios.create({\n            baseURL: baseURL === 'https://github.com'\n                ? 'https://api.github.com'\n                : concatURL(baseURL, 'api/v3'),\n            headers: {\n                Accept: 'application/vnd.github.v3+json',\n            },\n        });\n        this.$http.interceptors.response.use(response => {\n            if (response.data && response.data.error) {\n                return Promise.reject(new Error(response.data.error_description));\n            }\n            return response;\n        }, error => {\n            // 403 rate limit exceeded in OPTIONS request will cause a Network Error\n            // here we always treat Network Error as 403 rate limit exceeded\n            // @see https://github.com/axios/axios/issues/838\n            /* istanbul ignore next */\n            if (typeof error.response === 'undefined' &&\n                error.message === 'Network Error') {\n                error.response = {\n                    status: 403,\n                };\n            }\n            return Promise.reject(error);\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitHub',\n            link: this.baseURL,\n            version: 'v3',\n            meta: {\n                reactable: true,\n                sortable: false,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#1-request-a-users-github-identity\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'login/oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'public_repo',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github\n     */\n    async getAccessToken({ code }) {\n        /**\n         * access_token api does not support cors\n         * @see https://github.com/isaacs/github/issues/330\n         */\n        const originalURL = concatURL(this.baseURL, 'login/oauth/access_token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }, {\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://developer.github.com/v3/users/#get-the-authenticated-user\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.get('user', {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeUser(data);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://developer.github.com/v3/issues/#list-issues-for-a-repository\n     * @see https://developer.github.com/v3/issues/#get-a-single-issue\n     * @see https://developer.github.com/v3/#pagination\n     * @see https://developer.github.com/v3/search/#search-issues-and-pull-requests\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                options.params = {\n                    // to avoid caching\n                    timestamp: Date.now(),\n                };\n                const { data } = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}`, options);\n                return normalizeIssue(data);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            options.params = {\n                q: [\n                    `\"${issueTitle}\"`,\n                    `is:issue`,\n                    `in:title`,\n                    `repo:${this.owner}/${this.repo}`,\n                    `is:public`,\n                    ...this.labels.map(label => `label:${label}`),\n                ].join(' '),\n                // to avoid caching\n                timestamp: Date.now(),\n            };\n            const { data } = await this.$http.get(`search/issues`, options);\n            const issue = data.items\n                .map(normalizeIssue)\n                .find(item => item.title === issueTitle);\n            return issue || null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://developer.github.com/v3/issues/#create-an-issue\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues`, {\n            title,\n            body: content,\n            labels: this.labels,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://developer.github.com/v3/issues/comments/#list-comments-on-an-issue\n     * @see https://developer.github.com/v3/#pagination\n     *\n     * @remarks\n     * Github V3 does not support sort for issue comments now.\n     * Github V3 have to request the parent issue to get the count of comments.\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10 /*, sort = 'desc' */ } = {}, }) {\n        const issueOptions = {\n            params: {\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n        };\n        const commentsOptions = {\n            params: {\n                // pagination\n                page: page,\n                per_page: perPage,\n                /**\n                 * github v3 api does not support sort for issue comments\n                 * have sent feedback to github support\n                 */\n                // 'sort': 'created',\n                // 'direction': sort,\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n            headers: {\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        };\n        if (accessToken) {\n            issueOptions.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n            commentsOptions.headers.Authorization = `token ${accessToken}`;\n        }\n        // github v3 have to get the total count of comments by requesting the issue\n        const [issueRes, commentsRes] = await Promise.all([\n            this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}`, issueOptions),\n            this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, commentsOptions),\n        ]);\n        // it's annoying that have to get the page and per_page from the `Link` header\n        const linkHeader = commentsRes.headers.link || null;\n        /* istanbul ignore next */\n        const thisPage = /rel=\"next\"/.test(linkHeader)\n            ? Number(linkHeader.replace(/^.*[^_]page=(\\d*).*rel=\"next\".*$/, '$1')) - 1\n            : /rel=\"prev\"/.test(linkHeader)\n                ? Number(linkHeader.replace(/^.*[^_]page=(\\d*).*rel=\"prev\".*$/, '$1')) + 1\n                : 1;\n        /* istanbul ignore next */\n        const thisPerPage = linkHeader\n            ? Number(linkHeader.replace(/^.*per_page=(\\d*).*$/, '$1'))\n            : perPage;\n        return {\n            count: Number(issueRes.data.comments),\n            page: thisPage,\n            perPage: thisPerPage,\n            data: commentsRes.data.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#create-a-comment\n     */\n    async postComment({ accessToken, issueId, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, {\n            body: content,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#edit-a-comment\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.patch(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            body: content,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: [\n                    'application/vnd.github.v3.raw+json',\n                    'application/vnd.github.v3.html+json',\n                    'application/vnd.github.squirrel-girl-preview',\n                ],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#delete-a-comment\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        const { status } = await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return status === 204;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#get-a-single-comment\n     * @see https://developer.github.com/v3/reactions/#list-reactions-for-an-issue-comment\n     *\n     * @remarks\n     * The `List reactions for an issue comment` API also returns author of each reaction.\n     * As we only need the count, use the `Get a single comment` API is much simpler.\n     */\n    async getCommentReactions({ accessToken, commentId, }) {\n        const { data } = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            params: {\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        return normalizeReactions(data.reactions);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://developer.github.com/v3/reactions/#create-reaction-for-an-issue-comment\n     */\n    async postCommentReaction({ accessToken, commentId, reaction, }) {\n        const response = await this.$http.post(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}/reactions`, {\n            content: mapReactionName(reaction),\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        // 200 OK if the reaction is already token\n        if (response.status === 200) {\n            return this.deleteCommentReaction({\n                accessToken,\n                commentId,\n                reactionId: response.data.id,\n            });\n        }\n        // 201 CREATED\n        return response.status === 201;\n    }\n    /**\n     * Delete a reaction of a comment\n     *\n     * @see https://developer.github.com/v3/reactions/#delete-a-reaction\n     */\n    async deleteCommentReaction({ accessToken, commentId, reactionId, }) {\n        const response = await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}/reactions/${reactionId}`, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n                Accept: 'application/vnd.github.squirrel-girl-preview',\n            },\n        });\n        return response.status === 204;\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}