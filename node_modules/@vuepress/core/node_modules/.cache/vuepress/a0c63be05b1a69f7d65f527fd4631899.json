{"remainingRequest":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js??ref--3-1!/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-gitee-v5/lib/index.js","dependencies":[{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-gitee-v5/lib/index.js","mtime":1604064595397},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/cache-loader/dist/cjs.js","mtime":1603041438982},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js","mtime":1603041438713}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5kYXRlLm5vdyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmRhdGUudG8tc3RyaW5nIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMubnVtYmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC5leGVjIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3RyaW5nLnNlYXJjaCI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKaW1wb3J0IF9hc3luY1RvR2VuZXJhdG9yIGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiL29wdC9teWJsb2cvdnVlcHJlc3MtdGhlbWUtcmVjby1tYXN0ZXIvemRibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jbGFzc0NhbGxDaGVjayI7CmltcG9ydCBfY3JlYXRlQ2xhc3MgZnJvbSAiL29wdC9teWJsb2cvdnVlcHJlc3MtdGhlbWUtcmVjby1tYXN0ZXIvemRibG9nL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS9jcmVhdGVDbGFzcyI7CmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7CmltcG9ydCB7IGJ1aWxkVVJMLCBjb25jYXRVUkwsIGdldENsZWFuVVJMLCBwYXJzZVF1ZXJ5IH0gZnJvbSAnQHZzc3VlL3V0aWxzJzsKaW1wb3J0IHsgbm9ybWFsaXplVXNlciwgbm9ybWFsaXplSXNzdWUsIG5vcm1hbGl6ZUNvbW1lbnQgfSBmcm9tICcuL3V0aWxzJzsKLyoqCiAqIEdpdGVlIFJFU1QgQVBJIHY1CiAqCiAqIEBzZWUgaHR0cHM6Ly9naXRlZS5jb20vYXBpL3Y1L3N3YWdnZXIKICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvb2F1dGhfZG9jCiAqLwoKdmFyIEdpdGVlVjUgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEdpdGVlVjUoX3JlZikgewogICAgdmFyIF9yZWYkYmFzZVVSTCA9IF9yZWYuYmFzZVVSTCwKICAgICAgICBiYXNlVVJMID0gX3JlZiRiYXNlVVJMID09PSB2b2lkIDAgPyAnaHR0cHM6Ly9naXRlZS5jb20nIDogX3JlZiRiYXNlVVJMLAogICAgICAgIG93bmVyID0gX3JlZi5vd25lciwKICAgICAgICByZXBvID0gX3JlZi5yZXBvLAogICAgICAgIGxhYmVscyA9IF9yZWYubGFiZWxzLAogICAgICAgIGNsaWVudElkID0gX3JlZi5jbGllbnRJZCwKICAgICAgICBjbGllbnRTZWNyZXQgPSBfcmVmLmNsaWVudFNlY3JldCwKICAgICAgICBzdGF0ZSA9IF9yZWYuc3RhdGUsCiAgICAgICAgcHJveHkgPSBfcmVmLnByb3h5OwoKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBHaXRlZVY1KTsKCiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgaWYgKi8KICAgIGlmICh0eXBlb2YgY2xpZW50U2VjcmV0ID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcHJveHkgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY2xpZW50U2VjcmV0IGFuZCBwcm94eSBpcyByZXF1aXJlZCBmb3IgR2l0ZWUgVjUnKTsKICAgIH0KCiAgICB0aGlzLmJhc2VVUkwgPSBiYXNlVVJMOwogICAgdGhpcy5vd25lciA9IG93bmVyOwogICAgdGhpcy5yZXBvID0gcmVwbzsKICAgIHRoaXMubGFiZWxzID0gbGFiZWxzOwogICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOwogICAgdGhpcy5jbGllbnRTZWNyZXQgPSBjbGllbnRTZWNyZXQ7CiAgICB0aGlzLnN0YXRlID0gc3RhdGU7CiAgICB0aGlzLnByb3h5ID0gcHJveHk7CiAgICB0aGlzLiRodHRwID0gYXhpb3MuY3JlYXRlKHsKICAgICAgYmFzZVVSTDogY29uY2F0VVJMKGJhc2VVUkwsICdhcGkvdjUnKQogICAgfSk7CiAgICB0aGlzLiRodHRwLmludGVyY2VwdG9ycy5yZXNwb25zZS51c2UoZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgIHJldHVybiByZXNwb25zZTsKICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewogICAgICBpZiAoZXJyb3IucmVzcG9uc2UuZGF0YSAmJiBlcnJvci5yZXNwb25zZS5kYXRhLm1lc3NhZ2UpIHsKICAgICAgICBlcnJvci5tZXNzYWdlID0gZXJyb3IucmVzcG9uc2UuZGF0YS5tZXNzYWdlOwogICAgICB9CgogICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpOwogICAgfSk7CiAgfQogIC8qKgogICAqIFRoZSBwbGF0Zm9ybSBhcGkgaW5mbwogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEdpdGVlVjUsIFt7CiAgICBrZXk6ICJyZWRpcmVjdEF1dGgiLAoKICAgIC8qKgogICAgICogUmVkaXJlY3QgdG8gdGhlIGF1dGhvcml6YXRpb24gcGFnZSBvZiBwbGF0Zm9ybS4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0ZWUuY29tL2FwaS92NS9vYXV0aF9kb2MKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZGlyZWN0QXV0aCgpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBidWlsZFVSTChjb25jYXRVUkwodGhpcy5iYXNlVVJMLCAnb2F1dGgvYXV0aG9yaXplJyksIHsKICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsCiAgICAgICAgcmVkaXJlY3RfdXJpOiB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAgICAgICBzY29wZTogJ3VzZXJfaW5mbyBpc3N1ZXMgbm90ZXMnLAogICAgICAgIHJlc3BvbnNlX3R5cGU6ICdjb2RlJywKICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogSGFuZGxlIGF1dGhvcml6YXRpb24uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvb2F1dGhfZG9jCiAgICAgKgogICAgICogQHJlbWFya3MKICAgICAqIElmIHRoZSBgY29kZWAgYW5kIGBzdGF0ZWAgZXhpc3QgaW4gdGhlIHF1ZXJ5LCBhbmQgdGhlIGBzdGF0ZWAgbWF0Y2hlcywgcmVtb3ZlIHRoZW0gZnJvbSBxdWVyeSwgYW5kIHRyeSB0byBnZXQgdGhlIGFjY2VzcyB0b2tlbi4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJoYW5kbGVBdXRoIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfaGFuZGxlQXV0aCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgcXVlcnksIGNvZGUsIHJlcGxhY2VVUkwsIGFjY2Vzc1Rva2VuOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIHF1ZXJ5ID0gcGFyc2VRdWVyeSh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTsKCiAgICAgICAgICAgICAgICBpZiAoIXF1ZXJ5LmNvZGUpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDEzOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIShxdWVyeS5zdGF0ZSAhPT0gdGhpcy5zdGF0ZSkpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDQ7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgICAgICBjb2RlID0gcXVlcnkuY29kZTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5jb2RlOwogICAgICAgICAgICAgICAgZGVsZXRlIHF1ZXJ5LnN0YXRlOwogICAgICAgICAgICAgICAgcmVwbGFjZVVSTCA9IGJ1aWxkVVJMKGdldENsZWFuVVJMKHdpbmRvdy5sb2NhdGlvbi5ocmVmKSwgcXVlcnkpICsgd2luZG93LmxvY2F0aW9uLmhhc2g7CiAgICAgICAgICAgICAgICB3aW5kb3cuaGlzdG9yeS5yZXBsYWNlU3RhdGUobnVsbCwgJycsIHJlcGxhY2VVUkwpOwogICAgICAgICAgICAgICAgX2NvbnRleHQubmV4dCA9IDExOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWNjZXNzVG9rZW4oewogICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX2NvbnRleHQuc2VudDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIGFjY2Vzc1Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIG51bGwpOwoKICAgICAgICAgICAgICBjYXNlIDE0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGhhbmRsZUF1dGgoKSB7CiAgICAgICAgcmV0dXJuIF9oYW5kbGVBdXRoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBoYW5kbGVBdXRoOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCB1c2VyIGFjY2VzcyB0b2tlbiB2aWEgYGNvZGVgCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvb2F1dGhfZG9jCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0QWNjZXNzVG9rZW4iLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRBY2Nlc3NUb2tlbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTIoX3JlZjIpIHsKICAgICAgICB2YXIgY29kZSwgb3JpZ2luYWxVUkwsIHByb3h5VVJMLCBfeWllbGQkdGhpcyQkaHR0cCRwb3MsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBjb2RlID0gX3JlZjIuY29kZTsKICAgICAgICAgICAgICAgIG9yaWdpbmFsVVJMID0gY29uY2F0VVJMKHRoaXMuYmFzZVVSTCwgJ29hdXRoL3Rva2VuJyk7CiAgICAgICAgICAgICAgICBwcm94eVVSTCA9IHR5cGVvZiB0aGlzLnByb3h5ID09PSAnZnVuY3Rpb24nID8gdGhpcy5wcm94eShvcmlnaW5hbFVSTCkgOiB0aGlzLnByb3h5OwogICAgICAgICAgICAgICAgX2NvbnRleHQyLm5leHQgPSA1OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdChwcm94eVVSTCwgewogICAgICAgICAgICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsCiAgICAgICAgICAgICAgICAgIGNsaWVudF9zZWNyZXQ6IHRoaXMuY2xpZW50U2VjcmV0LAogICAgICAgICAgICAgICAgICBjb2RlOiBjb2RlLAogICAgICAgICAgICAgICAgICBncmFudF90eXBlOiAnYXV0aG9yaXphdGlvbl9jb2RlJywKICAgICAgICAgICAgICAgICAgcmVkaXJlY3RfdXJpOiB3aW5kb3cubG9jYXRpb24uaHJlZgogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvcyA9IF9jb250ZXh0Mi5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvcy5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5hYnJ1cHQoInJldHVybiIsIGRhdGEuYWNjZXNzX3Rva2VuKTsKCiAgICAgICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUyLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0QWNjZXNzVG9rZW4oX3gpIHsKICAgICAgICByZXR1cm4gX2dldEFjY2Vzc1Rva2VuLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRBY2Nlc3NUb2tlbjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGxvZ2dlZC1pbiB1c2VyIHdpdGggYWNjZXNzIHRva2VuLgogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9naXRlZS5jb20vYXBpL3Y1L3N3YWdnZXIjL2dldFY1VXNlcgogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFVzZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRVc2VyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhfcmVmMykgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0LCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMy5hY2Nlc3NUb2tlbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0My5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLmdldCgndXNlcicsIHsKICAgICAgICAgICAgICAgICAgcGFyYW1zOiB7CiAgICAgICAgICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiBhY2Nlc3NUb2tlbgogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0ID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplVXNlcihkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldFVzZXIoX3gyKSB7CiAgICAgICAgcmV0dXJuIF9nZXRVc2VyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBnZXRVc2VyOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCBpc3N1ZSBvZiB0aGlzIHBhZ2UgYWNjb3JkaW5nIHRvIHRoZSBpc3N1ZSBpZCBvciB0aGUgaXNzdWUgdGl0bGUKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0ZWUuY29tL2FwaS92NS9zd2FnZ2VyIy9nZXRWNVJlcG9zT3duZXJSZXBvSXNzdWVzCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0ZWUuY29tL2FwaS92NS9zd2FnZ2VyIy9nZXRWNVJlcG9zT3duZXJSZXBvSXNzdWVzTnVtYmVyCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0ZWUuY29tL2FwaS92NS9zd2FnZ2VyIy9nZXRWNVNlYXJjaElzc3VlcwogICAgICovCgogIH0sIHsKICAgIGtleTogImdldElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZ2V0SXNzdWUgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KF9yZWY0KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBpc3N1ZVRpdGxlLCBvcHRpb25zLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQyLCBkYXRhLCBfeWllbGQkdGhpcyQkaHR0cCRnZXQzLCBfZGF0YSwgaXNzdWU7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY0LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjQuaXNzdWVJZCwgaXNzdWVUaXRsZSA9IF9yZWY0Lmlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICBvcHRpb25zID0gewogICAgICAgICAgICAgICAgICBwYXJhbXM6IHsKICAgICAgICAgICAgICAgICAgICAvLyB0byBhdm9pZCBjYWNoaW5nCiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7CiAgICAgICAgICAgICAgICAgIG9wdGlvbnMucGFyYW1zLmFjY2Vzc190b2tlbiA9IGFjY2Vzc1Rva2VuOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghaXNzdWVJZCkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDIxOwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDc7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvIikuY29uY2F0KGlzc3VlSWQpLCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkZ2V0MiA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJGdldDIuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVJc3N1ZShkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgMTI6CiAgICAgICAgICAgICAgICBfY29udGV4dDQucHJldiA9IDEyOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnQwID0gX2NvbnRleHQ0WyJjYXRjaCJdKDQpOwoKICAgICAgICAgICAgICAgIGlmICghKF9jb250ZXh0NC50MC5yZXNwb25zZSAmJiBfY29udGV4dDQudDAucmVzcG9uc2Uuc3RhdHVzID09PSA0MDQpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMTg7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxODoKICAgICAgICAgICAgICAgIHRocm93IF9jb250ZXh0NC50MDsKCiAgICAgICAgICAgICAgY2FzZSAxOToKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjg7CiAgICAgICAgICAgICAgICBicmVhazsKCiAgICAgICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ob3B0aW9ucy5wYXJhbXMsIHsKICAgICAgICAgICAgICAgICAgcTogaXNzdWVUaXRsZSwKICAgICAgICAgICAgICAgICAgcmVwbzogIiIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbyksCiAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiAxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMjQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5nZXQoInNlYXJjaC9pc3N1ZXMiLCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSAyNDoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGdldDMgPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF9kYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkZ2V0My5kYXRhOwogICAgICAgICAgICAgICAgaXNzdWUgPSBfZGF0YS5tYXAobm9ybWFsaXplSXNzdWUpLmZpbmQoZnVuY3Rpb24gKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW0udGl0bGUgPT09IGlzc3VlVGl0bGU7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBpc3N1ZSB8fCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAyODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcywgW1s0LCAxMl1dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0SXNzdWUoX3gzKSB7CiAgICAgICAgcmV0dXJuIF9nZXRJc3N1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGlzc3VlCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvc3dhZ2dlciMvcG9zdFY1UmVwb3NPd25lcklzc3VlcwogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RJc3N1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RJc3N1ZSA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTUoX3JlZjUpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIHRpdGxlLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTUkKF9jb250ZXh0NSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDUucHJldiA9IF9jb250ZXh0NS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNS5hY2Nlc3NUb2tlbiwgdGl0bGUgPSBfcmVmNS50aXRsZSwgY29udGVudCA9IF9yZWY1LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDUubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiL2lzc3VlcyIpLCB7CiAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4sCiAgICAgICAgICAgICAgICAgIHJlcG86IHRoaXMucmVwbywKICAgICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlLAogICAgICAgICAgICAgICAgICBib2R5OiBjb250ZW50LAogICAgICAgICAgICAgICAgICBsYWJlbHM6IHRoaXMubGFiZWxzLmpvaW4oJywnKQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczIgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MyLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ1LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoZGF0YSkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0SXNzdWUoX3g0KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0SXNzdWUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RJc3N1ZTsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgY29tbWVudHMgb2YgdGhpcyBwYWdlIGFjY29yZGluZyB0byB0aGUgaXNzdWUgaWQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZ2l0ZWUuY29tL2FwaS92NS9zd2FnZ2VyIy9nZXRWNVJlcG9zT3duZXJSZXBvSXNzdWVzTnVtYmVyQ29tbWVudHMKICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogR2l0ZWUgVjMgZG9lcyBub3Qgc3VwcG9ydCBzb3J0IGZvciBpc3N1ZSBjb21tZW50cyBub3cuCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29tbWVudHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50cyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoX3JlZjYpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIF9yZWY2JHF1ZXJ5LCBfcmVmNiRxdWVyeSRwYWdlLCBwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlLCBwZXJQYWdlLCBvcHRpb25zLCByZXNwb25zZSwgY291bnQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNiQoX2NvbnRleHQ2KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Ni5wcmV2ID0gX2NvbnRleHQ2Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY2LmFjY2Vzc1Rva2VuLCBpc3N1ZUlkID0gX3JlZjYuaXNzdWVJZCwgX3JlZjYkcXVlcnkgPSBfcmVmNi5xdWVyeTsKICAgICAgICAgICAgICAgIF9yZWY2JHF1ZXJ5ID0gX3JlZjYkcXVlcnkgPT09IHZvaWQgMCA/IHt9IDogX3JlZjYkcXVlcnk7CiAgICAgICAgICAgICAgICBfcmVmNiRxdWVyeSRwYWdlID0gX3JlZjYkcXVlcnkucGFnZSwgcGFnZSA9IF9yZWY2JHF1ZXJ5JHBhZ2UgPT09IHZvaWQgMCA/IDEgOiBfcmVmNiRxdWVyeSRwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlID0gX3JlZjYkcXVlcnkucGVyUGFnZSwgcGVyUGFnZSA9IF9yZWY2JHF1ZXJ5JHBlclBhZ2UgPT09IHZvaWQgMCA/IDEwIDogX3JlZjYkcXVlcnkkcGVyUGFnZTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7CiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIC8vIHBhZ2luYXRpb24KICAgICAgICAgICAgICAgICAgICBwYWdlOiBwYWdlLAogICAgICAgICAgICAgICAgICAgIHBlcl9wYWdlOiBwZXJQYWdlLAogICAgICAgICAgICAgICAgICAgIC8vICdzb3J0JzogJ2NyZWF0ZWQnLAogICAgICAgICAgICAgICAgICAgIC8vICdkaXJlY3Rpb24nOiBzb3J0LAogICAgICAgICAgICAgICAgICAgIC8vIHRvIGF2b2lkIGNhY2hpbmcKICAgICAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogWydhcHBsaWNhdGlvbi92bmQuZ2l0ZWUuaHRtbCtqc29uJ10KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5wYXJhbXMuYWNjZXNzX3Rva2VuID0gYWNjZXNzVG9rZW47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ2Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAuZ2V0KCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzLyIpLmNvbmNhdChpc3N1ZUlkLCAiL2NvbW1lbnRzIiksIG9wdGlvbnMpOwoKICAgICAgICAgICAgICBjYXNlIDc6CiAgICAgICAgICAgICAgICByZXNwb25zZSA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgY291bnQgPSBOdW1iZXIocmVzcG9uc2UuaGVhZGVycy50b3RhbF9jb3VudCk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBjb3VudDogY291bnQsCiAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UsCiAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmRhdGEubWFwKG5vcm1hbGl6ZUNvbW1lbnQpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldENvbW1lbnRzKF94NSkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldENvbW1lbnRzOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvc3dhZ2dlciMvcG9zdFY1UmVwb3NPd25lclJlcG9Jc3N1ZXNOdW1iZXJDb21tZW50cwogICAgICovCgogIH0sIHsKICAgIGtleTogInBvc3RDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU3KF9yZWY3KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLCBkYXRhOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTckKF9jb250ZXh0NykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDcucHJldiA9IF9jb250ZXh0Ny5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNy5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWY3Lmlzc3VlSWQsIGNvbnRlbnQgPSBfcmVmNy5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgicmVwb3MvIi5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvLCAiL2lzc3Vlcy8iKS5jb25jYXQoaXNzdWVJZCwgIi9jb21tZW50cyIpLCB7CiAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4KICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogWydhcHBsaWNhdGlvbi92bmQuZ2l0ZWUuaHRtbCtqc29uJ10KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczMgPSBfY29udGV4dDcuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MzLmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ny5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNywgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RDb21tZW50KF94NikgewogICAgICAgIHJldHVybiBfcG9zdENvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEVkaXQgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2dpdGVlLmNvbS9hcGkvdjUvc3dhZ2dlciMvcGF0Y2hWNVJlcG9zT3duZXJSZXBvSXNzdWVzQ29tbWVudHNJZAogICAgICovCgogIH0sIHsKICAgIGtleTogInB1dENvbW1lbnQiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9wdXRDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlOChfcmVmOCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCBjb250ZW50LCBfeWllbGQkdGhpcyQkaHR0cCRwYXQsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlOCQoX2NvbnRleHQ4KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0OC5wcmV2ID0gX2NvbnRleHQ4Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY4LmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmOC5jb21tZW50SWQsIGNvbnRlbnQgPSBfcmVmOC5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ4Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucGF0Y2goInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMvY29tbWVudHMvIikuY29uY2F0KGNvbW1lbnRJZCksIHsKICAgICAgICAgICAgICAgICAgYm9keTogY29udGVudCwKICAgICAgICAgICAgICAgICAgYWNjZXNzX3Rva2VuOiBhY2Nlc3NUb2tlbgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQWNjZXB0OiBbJ2FwcGxpY2F0aW9uL3ZuZC5naXRlZS5odG1sK2pzb24nXQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcGF0ID0gX2NvbnRleHQ4LnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcGF0LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOCwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHB1dENvbW1lbnQoX3g3KSB7CiAgICAgICAgcmV0dXJuIF9wdXRDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBwdXRDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIERlbGV0ZSBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjMvaXNzdWVzL2NvbW1lbnRzLyNkZWxldGUtYS1jb21tZW50CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGVsZXRlQ29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2RlbGV0ZUNvbW1lbnQgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU5KF9yZWY5KSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBjb21tZW50SWQsIF95aWVsZCR0aGlzJCRodHRwJGRlbCwgc3RhdHVzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOS5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjkuY29tbWVudElkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHBbImRlbGV0ZSJdKCJyZXBvcy8iLmNvbmNhdCh0aGlzLm93bmVyLCAiLyIpLmNvbmNhdCh0aGlzLnJlcG8sICIvaXNzdWVzL2NvbW1lbnRzLyIpLmNvbmNhdChjb21tZW50SWQpLCB7CiAgICAgICAgICAgICAgICAgIHBhcmFtczogewogICAgICAgICAgICAgICAgICAgIGFjY2Vzc190b2tlbjogYWNjZXNzVG9rZW4KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJGRlbCA9IF9jb250ZXh0OS5zZW50OwogICAgICAgICAgICAgICAgc3RhdHVzID0gX3lpZWxkJHRoaXMkJGh0dHAkZGVsLnN0YXR1czsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCBzdGF0dXMgPT09IDIwNCk7CgogICAgICAgICAgICAgIGNhc2UgNjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0OS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlOSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGRlbGV0ZUNvbW1lbnQoX3g4KSB7CiAgICAgICAgcmV0dXJuIF9kZWxldGVDb21tZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZWxldGVDb21tZW50OwogICAgfSgpCiAgICAvKioKICAgICAqIEdpdGVlIGRvZXMgbm90IHN1cHBvcnQgcmVhY3Rpb25zIG5vdwogICAgICovCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzCgogIH0sIHsKICAgIGtleTogImdldENvbW1lbnRSZWFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50UmVhY3Rpb25zID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAob3B0aW9ucykgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCc1MDEgTm90IEltcGxlbWVudGVkJyk7CgogICAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0Q29tbWVudFJlYWN0aW9ucyhfeDkpIHsKICAgICAgICByZXR1cm4gX2dldENvbW1lbnRSZWFjdGlvbnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldENvbW1lbnRSZWFjdGlvbnM7CiAgICB9KCkKICAgIC8qKgogICAgICogR2l0ZWUgZG9lcyBub3Qgc3VwcG9ydCByZWFjdGlvbnMgbm93CiAgICAgKi8KICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMKCiAgfSwgewogICAga2V5OiAicG9zdENvbW1lbnRSZWFjdGlvbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RDb21tZW50UmVhY3Rpb24gPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUxMShvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUxMSQoX2NvbnRleHQxMSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDExLnByZXYgPSBfY29udGV4dDExLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJzUwMSBOb3QgSW1wbGVtZW50ZWQnKTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0Q29tbWVudFJlYWN0aW9uKF94MTApIHsKICAgICAgICByZXR1cm4gX3Bvc3RDb21tZW50UmVhY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50UmVhY3Rpb247CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJwbGF0Zm9ybSIsCiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiAnR2l0ZWUnLAogICAgICAgIGxpbms6IHRoaXMuYmFzZVVSTCwKICAgICAgICB2ZXJzaW9uOiAndjUnLAogICAgICAgIG1ldGE6IHsKICAgICAgICAgIHJlYWN0YWJsZTogZmFsc2UsCiAgICAgICAgICBzb3J0YWJsZTogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2l0ZWVWNTsKfSgpOwoKZXhwb3J0IHsgR2l0ZWVWNSBhcyBkZWZhdWx0IH07"},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment } from './utils';\n/**\n * Gitee REST API v5\n *\n * @see https://gitee.com/api/v5/swagger\n * @see https://gitee.com/api/v5/oauth_doc\n */\nexport default class GiteeV5 {\n    constructor({ baseURL = 'https://gitee.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        /* istanbul ignore if */\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for Gitee V5');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this.$http = axios.create({\n            baseURL: concatURL(baseURL, 'api/v5'),\n        });\n        this.$http.interceptors.response.use(response => response, error => {\n            if (error.response.data && error.response.data.message) {\n                error.message = error.response.data.message;\n            }\n            return Promise.reject(error);\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'Gitee',\n            link: this.baseURL,\n            version: 'v5',\n            meta: {\n                reactable: false,\n                sortable: false,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://gitee.com/api/v5/oauth_doc\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'user_info issues notes',\n            response_type: 'code',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://gitee.com/api/v5/oauth_doc\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://gitee.com/api/v5/oauth_doc\n     */\n    async getAccessToken({ code }) {\n        const originalURL = concatURL(this.baseURL, 'oauth/token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n            grant_type: 'authorization_code',\n            redirect_uri: window.location.href,\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://gitee.com/api/v5/swagger#/getV5User\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.get('user', {\n            params: { access_token: accessToken },\n        });\n        return normalizeUser(data);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoIssues\n     * @see https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoIssuesNumber\n     * @see https://gitee.com/api/v5/swagger#/getV5SearchIssues\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {\n            params: {\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n        };\n        if (accessToken) {\n            options.params.access_token = accessToken;\n        }\n        if (issueId) {\n            try {\n                const { data } = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}`, options);\n                return normalizeIssue(data);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            Object.assign(options.params, {\n                q: issueTitle,\n                repo: `${this.owner}/${this.repo}`,\n                per_page: 1,\n            });\n            const { data } = await this.$http.get(`search/issues`, options);\n            const issue = data\n                .map(normalizeIssue)\n                .find(item => item.title === issueTitle);\n            return issue || null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://gitee.com/api/v5/swagger#/postV5ReposOwnerIssues\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/issues`, {\n            access_token: accessToken,\n            repo: this.repo,\n            title,\n            body: content,\n            labels: this.labels.join(','),\n        });\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://gitee.com/api/v5/swagger#/getV5ReposOwnerRepoIssuesNumberComments\n     *\n     * @remarks\n     * Gitee V3 does not support sort for issue comments now.\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10 /*, sort = 'desc' */ } = {}, }) {\n        const options = {\n            params: {\n                // pagination\n                page: page,\n                per_page: perPage,\n                // 'sort': 'created',\n                // 'direction': sort,\n                // to avoid caching\n                timestamp: Date.now(),\n            },\n            headers: {\n                Accept: ['application/vnd.gitee.html+json'],\n            },\n        };\n        if (accessToken) {\n            options.params.access_token = accessToken;\n        }\n        const response = await this.$http.get(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, options);\n        const count = Number(response.headers.total_count);\n        return {\n            count: count,\n            page: page,\n            perPage: perPage,\n            data: response.data.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://gitee.com/api/v5/swagger#/postV5ReposOwnerRepoIssuesNumberComments\n     */\n    async postComment({ accessToken, issueId, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues/${issueId}/comments`, {\n            body: content,\n            access_token: accessToken,\n        }, {\n            headers: {\n                Accept: ['application/vnd.gitee.html+json'],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://gitee.com/api/v5/swagger#/patchV5ReposOwnerRepoIssuesCommentsId\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.patch(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            body: content,\n            access_token: accessToken,\n        }, {\n            headers: {\n                Accept: ['application/vnd.gitee.html+json'],\n            },\n        });\n        return normalizeComment(data);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v3/issues/comments/#delete-a-comment\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        const { status } = await this.$http.delete(`repos/${this.owner}/${this.repo}/issues/comments/${commentId}`, {\n            params: { access_token: accessToken },\n        });\n        return status === 204;\n    }\n    /**\n     * Gitee does not support reactions now\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async getCommentReactions(options) {\n        throw new Error('501 Not Implemented');\n    }\n    /**\n     * Gitee does not support reactions now\n     */\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    async postCommentReaction(options) {\n        throw new Error('501 Not Implemented');\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}