{"remainingRequest":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js??ref--3-1!/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-github-v4/lib/index.js","dependencies":[{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/@vssue/api-github-v4/lib/index.js","mtime":1604064595705},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/cache-loader/dist/cjs.js","mtime":1603041438982},{"path":"/opt/myblog/vuepress-theme-reco-master/zdblog/node_modules/babel-loader/lib/index.js","mtime":1603041438713}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmluZCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmFycmF5LmpvaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZXZlcnNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zZWFyY2giOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvb3B0L215YmxvZy92dWVwcmVzcy10aGVtZS1yZWNvLW1hc3Rlci96ZGJsb2cvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2FzeW5jVG9HZW5lcmF0b3IiOwppbXBvcnQgX2NsYXNzQ2FsbENoZWNrIGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY2xhc3NDYWxsQ2hlY2siOwppbXBvcnQgX2NyZWF0ZUNsYXNzIGZyb20gIi9vcHQvbXlibG9nL3Z1ZXByZXNzLXRoZW1lLXJlY28tbWFzdGVyL3pkYmxvZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwppbXBvcnQgYXhpb3MgZnJvbSAnYXhpb3MnOwppbXBvcnQgeyBidWlsZFVSTCwgY29uY2F0VVJMLCBnZXRDbGVhblVSTCwgcGFyc2VRdWVyeSB9IGZyb20gJ0B2c3N1ZS91dGlscyc7CmltcG9ydCB7IG5vcm1hbGl6ZVVzZXIsIG5vcm1hbGl6ZUlzc3VlLCBub3JtYWxpemVDb21tZW50LCBub3JtYWxpemVSZWFjdGlvbnMsIG1hcFJlYWN0aW9uTmFtZSB9IGZyb20gJy4vdXRpbHMnOwovKioKICogR2l0aHViIEdyYXBoUUwgQVBJIHY0CiAqCiAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC8KICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L2V4cGxvcmVyLwogKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vYXBwcy9idWlsZGluZy1vYXV0aC1hcHBzLwogKi8KCnZhciBHaXRodWJWNCA9IC8qI19fUFVSRV9fKi9mdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gR2l0aHViVjQoX3JlZikgewogICAgdmFyIF9yZWYkYmFzZVVSTCA9IF9yZWYuYmFzZVVSTCwKICAgICAgICBiYXNlVVJMID0gX3JlZiRiYXNlVVJMID09PSB2b2lkIDAgPyAnaHR0cHM6Ly9naXRodWIuY29tJyA6IF9yZWYkYmFzZVVSTCwKICAgICAgICBvd25lciA9IF9yZWYub3duZXIsCiAgICAgICAgcmVwbyA9IF9yZWYucmVwbywKICAgICAgICBsYWJlbHMgPSBfcmVmLmxhYmVscywKICAgICAgICBjbGllbnRJZCA9IF9yZWYuY2xpZW50SWQsCiAgICAgICAgY2xpZW50U2VjcmV0ID0gX3JlZi5jbGllbnRTZWNyZXQsCiAgICAgICAgc3RhdGUgPSBfcmVmLnN0YXRlLAogICAgICAgIHByb3h5ID0gX3JlZi5wcm94eTsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgR2l0aHViVjQpOwoKICAgIGlmICh0eXBlb2YgY2xpZW50U2VjcmV0ID09PSAndW5kZWZpbmVkJyB8fCB0eXBlb2YgcHJveHkgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignY2xpZW50U2VjcmV0IGFuZCBwcm94eSBpcyByZXF1aXJlZCBmb3IgR2l0SHViIFY0Jyk7CiAgICB9CgogICAgdGhpcy5iYXNlVVJMID0gYmFzZVVSTDsKICAgIHRoaXMub3duZXIgPSBvd25lcjsKICAgIHRoaXMucmVwbyA9IHJlcG87CiAgICB0aGlzLmxhYmVscyA9IGxhYmVsczsKICAgIHRoaXMuY2xpZW50SWQgPSBjbGllbnRJZDsKICAgIHRoaXMuY2xpZW50U2VjcmV0ID0gY2xpZW50U2VjcmV0OwogICAgdGhpcy5zdGF0ZSA9IHN0YXRlOwogICAgdGhpcy5wcm94eSA9IHByb3h5OwogICAgdGhpcy5fcGFnZUluZm8gPSB7CiAgICAgIHBhZ2U6IDEsCiAgICAgIHN0YXJ0Q3Vyc29yOiBudWxsLAogICAgICBlbmRDdXJzb3I6IG51bGwsCiAgICAgIHNvcnQ6IG51bGwsCiAgICAgIHBlclBhZ2U6IG51bGwKICAgIH07CiAgICB0aGlzLl9pc3N1ZU5vZGVJZCA9IG51bGw7CiAgICB0aGlzLiRodHRwID0gYXhpb3MuY3JlYXRlKHsKICAgICAgYmFzZVVSTDogYmFzZVVSTCA9PT0gJ2h0dHBzOi8vZ2l0aHViLmNvbScgPyAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbScgOiBjb25jYXRVUkwoYmFzZVVSTCwgJ2FwaScpLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJwogICAgICB9CiAgICB9KTsKICAgIHRoaXMuJGh0dHAuaW50ZXJjZXB0b3JzLnJlc3BvbnNlLnVzZShmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuZXJyb3IpIHsKICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVzcG9uc2UuZGF0YS5lcnJvcl9kZXNjcmlwdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChyZXNwb25zZS5kYXRhLmVycm9ycykgewogICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXNwb25zZS5kYXRhLmVycm9yc1swXS5tZXNzYWdlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3BvbnNlOwogICAgfSk7CiAgfQogIC8qKgogICAqIFRoZSBwbGF0Zm9ybSBhcGkgaW5mbwogICAqLwoKCiAgX2NyZWF0ZUNsYXNzKEdpdGh1YlY0LCBbewogICAga2V5OiAicmVkaXJlY3RBdXRoIiwKCiAgICAvKioKICAgICAqIFJlZGlyZWN0IHRvIHRoZSBhdXRob3JpemF0aW9uIHBhZ2Ugb2YgcGxhdGZvcm0uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLyMxLXJlcXVlc3QtYS11c2Vycy1naXRodWItaWRlbnRpdHkKICAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZGlyZWN0QXV0aCgpIHsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBidWlsZFVSTChjb25jYXRVUkwodGhpcy5iYXNlVVJMLCAnbG9naW4vb2F1dGgvYXV0aG9yaXplJyksIHsKICAgICAgICBjbGllbnRfaWQ6IHRoaXMuY2xpZW50SWQsCiAgICAgICAgcmVkaXJlY3RfdXJpOiB3aW5kb3cubG9jYXRpb24uaHJlZiwKICAgICAgICBzY29wZTogJ3B1YmxpY19yZXBvJywKICAgICAgICBzdGF0ZTogdGhpcy5zdGF0ZQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogSGFuZGxlIGF1dGhvcml6YXRpb24uCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL2FwcHMvYnVpbGRpbmctb2F1dGgtYXBwcy9hdXRob3JpemluZy1vYXV0aC1hcHBzLwogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBJZiB0aGUgYGNvZGVgIGFuZCBgc3RhdGVgIGV4aXN0IGluIHRoZSBxdWVyeSwgYW5kIHRoZSBgc3RhdGVgIG1hdGNoZXMsIHJlbW92ZSB0aGVtIGZyb20gcXVlcnksIGFuZCB0cnkgdG8gZ2V0IHRoZSBhY2Nlc3MgdG9rZW4uCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiaGFuZGxlQXV0aCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2hhbmRsZUF1dGggPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUoKSB7CiAgICAgICAgdmFyIHF1ZXJ5LCBjb2RlLCByZXBsYWNlVVJMLCBhY2Nlc3NUb2tlbjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQucHJldiA9IF9jb250ZXh0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBxdWVyeSA9IHBhcnNlUXVlcnkod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CgogICAgICAgICAgICAgICAgaWYgKCFxdWVyeS5jb2RlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMzsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCEocXVlcnkuc3RhdGUgIT09IHRoaXMuc3RhdGUpKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgY29kZSA9IHF1ZXJ5LmNvZGU7CiAgICAgICAgICAgICAgICBkZWxldGUgcXVlcnkuY29kZTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBxdWVyeS5zdGF0ZTsKICAgICAgICAgICAgICAgIHJlcGxhY2VVUkwgPSBidWlsZFVSTChnZXRDbGVhblVSTCh3aW5kb3cubG9jYXRpb24uaHJlZiksIHF1ZXJ5KSArIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwogICAgICAgICAgICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKG51bGwsICcnLCByZXBsYWNlVVJMKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxMTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmdldEFjY2Vzc1Rva2VuKHsKICAgICAgICAgICAgICAgICAgY29kZTogY29kZQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMTE6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9jb250ZXh0LnNlbnQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBhY2Nlc3NUb2tlbik7CgogICAgICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAxNDoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBoYW5kbGVBdXRoKCkgewogICAgICAgIHJldHVybiBfaGFuZGxlQXV0aC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gaGFuZGxlQXV0aDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgdXNlciBhY2Nlc3MgdG9rZW4gdmlhIGBjb2RlYAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS9hcHBzL2J1aWxkaW5nLW9hdXRoLWFwcHMvYXV0aG9yaXppbmctb2F1dGgtYXBwcy8jMi11c2Vycy1hcmUtcmVkaXJlY3RlZC1iYWNrLXRvLXlvdXItc2l0ZS1ieS1naXRodWIKICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRBY2Nlc3NUb2tlbiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldEFjY2Vzc1Rva2VuID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMihfcmVmMikgewogICAgICAgIHZhciBjb2RlLCBvcmlnaW5hbFVSTCwgcHJveHlVUkwsIF95aWVsZCR0aGlzJCRodHRwJHBvcywgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUyJChfY29udGV4dDIpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQyLnByZXYgPSBfY29udGV4dDIubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGNvZGUgPSBfcmVmMi5jb2RlOwoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogYWNjZXNzX3Rva2VuIGFwaSBkb2VzIG5vdCBzdXBwb3J0IGNvcnMKICAgICAgICAgICAgICAgICAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL2lzYWFjcy9naXRodWIvaXNzdWVzLzMzMAogICAgICAgICAgICAgICAgICovCiAgICAgICAgICAgICAgICBvcmlnaW5hbFVSTCA9IGNvbmNhdFVSTCh0aGlzLmJhc2VVUkwsICdsb2dpbi9vYXV0aC9hY2Nlc3NfdG9rZW4nKTsKICAgICAgICAgICAgICAgIHByb3h5VVJMID0gdHlwZW9mIHRoaXMucHJveHkgPT09ICdmdW5jdGlvbicgPyB0aGlzLnByb3h5KG9yaWdpbmFsVVJMKSA6IHRoaXMucHJveHk7CiAgICAgICAgICAgICAgICBfY29udGV4dDIubmV4dCA9IDU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KHByb3h5VVJMLCB7CiAgICAgICAgICAgICAgICAgIGNsaWVudF9pZDogdGhpcy5jbGllbnRJZCwKICAgICAgICAgICAgICAgICAgY2xpZW50X3NlY3JldDogdGhpcy5jbGllbnRTZWNyZXQsCiAgICAgICAgICAgICAgICAgIGNvZGU6IGNvZGUKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDU6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3MgPSBfY29udGV4dDIuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3MuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDIuYWJydXB0KCJyZXR1cm4iLCBkYXRhLmFjY2Vzc190b2tlbik7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldEFjY2Vzc1Rva2VuKF94KSB7CiAgICAgICAgcmV0dXJuIF9nZXRBY2Nlc3NUb2tlbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0QWNjZXNzVG9rZW47CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHRoZSBsb2dnZWQtaW4gdXNlciB3aXRoIGFjY2VzcyB0b2tlbi4KICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvcXVlcnkvIHZpZXdlcgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L29iamVjdC91c2VyLwogICAgICovCgogIH0sIHsKICAgIGtleTogImdldFVzZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRVc2VyID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMyhfcmVmMykgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMiwgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUzJChfY29udGV4dDMpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQzLnByZXYgPSBfY29udGV4dDMubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjMuYWNjZXNzVG9rZW47CiAgICAgICAgICAgICAgICBfY29udGV4dDMubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCdncmFwaHFsJywgewogICAgICAgICAgICAgICAgICBxdWVyeTogInF1ZXJ5IGdldFVzZXIge1xuICB2aWV3ZXIge1xuICAgIGxvZ2luXG4gICAgYXZhdGFyVXJsXG4gICAgdXJsXG4gIH1cbn0iCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICBBdXRob3JpemF0aW9uOiAidG9rZW4gIi5jb25jYXQoYWNjZXNzVG9rZW4pCiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3MyID0gX2NvbnRleHQzLnNlbnQ7CiAgICAgICAgICAgICAgICBkYXRhID0gX3lpZWxkJHRoaXMkJGh0dHAkcG9zMi5kYXRhOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZVVzZXIoZGF0YS5kYXRhLnZpZXdlcikpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDMuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTMsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBnZXRVc2VyKF94MikgewogICAgICAgIHJldHVybiBfZ2V0VXNlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0VXNlcjsKICAgIH0oKQogICAgLyoqCiAgICAgKiBHZXQgaXNzdWUgb2YgdGhpcyBwYWdlIGFjY29yZGluZyB0byB0aGUgaXNzdWUgaWQgb3IgdGhlIGlzc3VlIHRpdGxlCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L29iamVjdC9yZXBvc2l0b3J5LwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L29iamVjdC9pc3N1ZWNvbm5lY3Rpb24vCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvb2JqZWN0L2lzc3VlLwogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBUaGUgSXNzdWVDb25uZWN0aW9uIGRvZXMgbm90IGhhdmUgdGl0bGUgZmlsdGVyIGZvciBub3csIGFuZCB0aGUgbnVtYmVyIG9mIHJlc3VsdHMgaXMgbGltaXRlZCB0byAxMDAuCiAgICAgKiBGb3Igbm93LCBpZiBpc3N1ZXMgd2l0aCB0aGUgbGFiZWxzIGFyZSBtb3JlIHRoYW4gMTAwLCB3ZSBoYXZlIHRvIHJlcXVlc3QgdGhlIG5leHQgcGFnZShub3QgaW1wbGVtZW50ZWQgeWV0KS4KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJnZXRJc3N1ZSIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX2dldElzc3VlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNChfcmVmNCkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgaXNzdWVJZCwgaXNzdWVUaXRsZSwgb3B0aW9ucywgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMywgZGF0YSwgcXVlcnksIF95aWVsZCR0aGlzJCRodHRwJHBvczQsIF9kYXRhLCBpc3N1ZTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU0JChfY29udGV4dDQpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ0LnByZXYgPSBfY29udGV4dDQubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjQuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmNC5pc3N1ZUlkLCBpc3N1ZVRpdGxlID0gX3JlZjQuaXNzdWVUaXRsZTsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAoIWlzc3VlSWQpIHsKICAgICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyMjsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSA0OwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSA3OwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJxdWVyeSBnZXRJc3N1ZUJ5SWQge1xuICByZXBvc2l0b3J5KG93bmVyOiBcIiIuY29uY2F0KHRoaXMub3duZXIsICJcIiwgbmFtZTogXCIiKS5jb25jYXQodGhpcy5yZXBvLCAiXCIpIHtcbiAgICBpc3N1ZSAobnVtYmVyOiAiKS5jb25jYXQoaXNzdWVJZCwgIikge1xuICAgICAgaWRcbiAgICAgIG51bWJlclxuICAgICAgdGl0bGVcbiAgICAgIGJvZHlcbiAgICAgIHVybFxuICAgIH1cbiAgfVxufSIpCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zMyA9IF9jb250ZXh0NC5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczMuZGF0YTsKICAgICAgICAgICAgICAgIC8vIHBvc3RDb21tZW50IG5lZWRzIGlzc3VlIE5vZGVJZCwgc28gd2Ugc3RvcmUgaXQgaW50ZXJuYWxseQogICAgICAgICAgICAgICAgdGhpcy5faXNzdWVOb2RlSWQgPSBkYXRhLmRhdGEucmVwb3NpdG9yeS5pc3N1ZS5pZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVJc3N1ZShkYXRhLmRhdGEucmVwb3NpdG9yeS5pc3N1ZSkpOwoKICAgICAgICAgICAgICBjYXNlIDEzOgogICAgICAgICAgICAgICAgX2NvbnRleHQ0LnByZXYgPSAxMzsKICAgICAgICAgICAgICAgIF9jb250ZXh0NC50MCA9IF9jb250ZXh0NFsiY2F0Y2giXSg0KTsKCiAgICAgICAgICAgICAgICBpZiAoIShfY29udGV4dDQudDAucmVzcG9uc2UgJiYgX2NvbnRleHQ0LnQwLnJlc3BvbnNlLnN0YXR1cyA9PT0gNDA0KSkgewogICAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDE5OwogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbnVsbCk7CgogICAgICAgICAgICAgIGNhc2UgMTk6CiAgICAgICAgICAgICAgICB0aHJvdyBfY29udGV4dDQudDA7CgogICAgICAgICAgICAgIGNhc2UgMjA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDMyOwogICAgICAgICAgICAgICAgYnJlYWs7CgogICAgICAgICAgICAgIGNhc2UgMjI6CiAgICAgICAgICAgICAgICBxdWVyeSA9IFsiXCIiLmNvbmNhdChpc3N1ZVRpdGxlLCAiXCIiKSwgImluOnRpdGxlIiwgInJlcG86Ii5jb25jYXQodGhpcy5vd25lciwgIi8iKS5jb25jYXQodGhpcy5yZXBvKSwgImlzOnB1YmxpYyJdLmNvbmNhdChfdG9Db25zdW1hYmxlQXJyYXkodGhpcy5sYWJlbHMubWFwKGZ1bmN0aW9uIChsYWJlbCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gImxhYmVsOiIuY29uY2F0KGxhYmVsKTsKICAgICAgICAgICAgICAgIH0pKSkuam9pbignICcpOwogICAgICAgICAgICAgICAgX2NvbnRleHQ0Lm5leHQgPSAyNTsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeQogICAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgICBxdWVyeTogInF1ZXJ5IGdldElzc3VlQnlUaXRsZShcbiAgJHF1ZXJ5OiBTdHJpbmchXG4pIHtcbiAgc2VhcmNoKFxuICAgIHF1ZXJ5OiAkcXVlcnlcbiAgICB0eXBlOiBJU1NVRVxuICAgIGZpcnN0OiAyMFxuICAgICkge1xuICAgICAgbm9kZXMge1xuICAgICAgLi4uIG9uIElzc3VlIHtcbiAgICAgICAgaWRcbiAgICAgICAgbnVtYmVyXG4gICAgICAgIHRpdGxlXG4gICAgICAgIGJvZHlcbiAgICAgICAgdXJsXG4gICAgICB9XG4gICAgfVxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgb3B0aW9ucyk7CgogICAgICAgICAgICAgIGNhc2UgMjU6CiAgICAgICAgICAgICAgICBfeWllbGQkdGhpcyQkaHR0cCRwb3M0ID0gX2NvbnRleHQ0LnNlbnQ7CiAgICAgICAgICAgICAgICBfZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczQuZGF0YTsKICAgICAgICAgICAgICAgIGlzc3VlID0gX2RhdGEuZGF0YS5zZWFyY2gubm9kZXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS50aXRsZSA9PT0gaXNzdWVUaXRsZTsKICAgICAgICAgICAgICAgIH0pOyAvLyBwb3N0Q29tbWVudCBuZWVkcyBpc3N1ZSBOb2RlSWQsIHNvIHdlIHN0b3JlIGl0IGludGVybmFsbHkKCiAgICAgICAgICAgICAgICBpZiAoIWlzc3VlKSB7CiAgICAgICAgICAgICAgICAgIF9jb250ZXh0NC5uZXh0ID0gMzE7CiAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHRoaXMuX2lzc3VlTm9kZUlkID0gaXNzdWUuaWQ7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplSXNzdWUoaXNzdWUpKTsKCiAgICAgICAgICAgICAgY2FzZSAzMToKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDQuYWJydXB0KCJyZXR1cm4iLCBudWxsKTsKCiAgICAgICAgICAgICAgY2FzZSAzMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNCwgdGhpcywgW1s0LCAxM11dKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0SXNzdWUoX3gzKSB7CiAgICAgICAgcmV0dXJuIF9nZXRJc3N1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gZ2V0SXNzdWU7CiAgICB9KCkKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IGlzc3VlCiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL2NyZWF0ZWlzc3VlLwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L2lucHV0X29iamVjdC9jcmVhdGVpc3N1ZWlucHV0LwogICAgICoKICAgICAqIEByZW1hcmtzCiAgICAgKiBDcmVhdGluZyBpc3N1ZSByZXF1aXJlcyByZXBvc2l0b3J5SWQsIHdoaWNoIHNob3VsZCBiZSByZXF1ZXN0ZWQgaW4gYW4gZXh0cmEgcmVxdWVzdC4KICAgICAqIENyZWF0aW5nIGlzc3VlIHdpdGggbGFiZWxzIHJlcXVpcmVzIGxhYmVsSWRzLCB3aGljaCBzaG91bGQgYmUgcmVxdWVzdGVkIGluIGFuIGV4dHJhIHJlcXVlc3QsIG9yIGNyZWF0ZSB0aGUgbGFiZWwgaWYgaXQgZG9lcyBub3QgZXhpc3QuCiAgICAgKiBFbmRwb2ludHMgZm9yIGNyZWF0aW5nIGxhYmVscyBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQgYnkgR2l0SHViIHlldCAoc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vY3JlYXRlbGFiZWwvKQogICAgICoKICAgICAqIEZvciB0aGVzZSByZWFzb25zLCBmYWxsYmFjayB0byB2MyBmb3Igbm93CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAicG9zdElzc3VlIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdElzc3VlID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNShfcmVmNSkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgdGl0bGUsIGNvbnRlbnQsIF95aWVsZCR0aGlzJCRodHRwJHBvczUsIGRhdGE7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNSQoX2NvbnRleHQ1KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NS5wcmV2ID0gX2NvbnRleHQ1Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBhY2Nlc3NUb2tlbiA9IF9yZWY1LmFjY2Vzc1Rva2VuLCB0aXRsZSA9IF9yZWY1LnRpdGxlLCBjb250ZW50ID0gX3JlZjUuY29udGVudDsKICAgICAgICAgICAgICAgIF9jb250ZXh0NS5uZXh0ID0gMzsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoInJlcG9zLyIuY29uY2F0KHRoaXMub3duZXIsICIvIikuY29uY2F0KHRoaXMucmVwbywgIi9pc3N1ZXMiKSwgewogICAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUsCiAgICAgICAgICAgICAgICAgIGJvZHk6IGNvbnRlbnQsCiAgICAgICAgICAgICAgICAgIGxhYmVsczogdGhpcy5sYWJlbHMKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczUgPSBfY29udGV4dDUuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M1LmRhdGE7CiAgICAgICAgICAgICAgICAvLyBgaHRtbF91cmxgIGluIHYzCiAgICAgICAgICAgICAgICAvLyBgdXJsYCBpbiB2NAogICAgICAgICAgICAgICAgZGF0YS51cmwgPSBkYXRhLmh0bWxfdXJsOyAvLyBwb3N0Q29tbWVudCBuZWVkcyBpc3N1ZSBOb2RlSWQsIHNvIHdlIHN0b3JlIGl0IGludGVybmFsbHkKCiAgICAgICAgICAgICAgICB0aGlzLl9pc3N1ZU5vZGVJZCA9IGRhdGEubm9kZV9pZDsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDUuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVJc3N1ZShkYXRhKSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNSwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIHBvc3RJc3N1ZShfeDQpIHsKICAgICAgICByZXR1cm4gX3Bvc3RJc3N1ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdElzc3VlOwogICAgfSgpCiAgICAvKioKICAgICAqIEdldCBjb21tZW50cyBvZiB0aGlzIHBhZ2UgYWNjb3JkaW5nIHRvIHRoZSBpc3N1ZSBpZAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9vYmplY3QvaXNzdWVjb21tZW50Y29ubmVjdGlvbi8KICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogTm8gb2Zmc2V0IGltcGxlbWVudGVkLCBzbyBpdCdzIGRpZmZpY3VsdCB0byBpbXBsZW1lbnQgUkVTVC1saWtlIHBhZ2luYXRpb24KICAgICAqIEZvciBub3csIHdlIHVzZSBhbiBpbnRlcm5hbCBgX3BhZ2VJbmZvYCB2YXIgdG8gaGFjayB0aGF0CiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZ2V0Q29tbWVudHMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50cyA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTYoX3JlZjYpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGlzc3VlSWQsIF9yZWY2JHF1ZXJ5LCBfcmVmNiRxdWVyeSRwYWdlLCBwYWdlLCBfcmVmNiRxdWVyeSRwZXJQYWdlLCBwZXJQYWdlLCBfcmVmNiRxdWVyeSRzb3J0LCBzb3J0LCBvcHRpb25zLCBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMsIGZpcnN0T3JMYXN0LCBhZnRlck9yQmVmb3JlLCBjdXJzb3IsIF95aWVsZCR0aGlzJCRodHRwJHBvczYsIGRhdGEsIGNvbW1lbnRzOwoKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTYkKF9jb250ZXh0NikgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDYucHJldiA9IF9jb250ZXh0Ni5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmNi5hY2Nlc3NUb2tlbiwgaXNzdWVJZCA9IF9yZWY2Lmlzc3VlSWQsIF9yZWY2JHF1ZXJ5ID0gX3JlZjYucXVlcnk7CiAgICAgICAgICAgICAgICBfcmVmNiRxdWVyeSA9IF9yZWY2JHF1ZXJ5ID09PSB2b2lkIDAgPyB7fSA6IF9yZWY2JHF1ZXJ5OwogICAgICAgICAgICAgICAgX3JlZjYkcXVlcnkkcGFnZSA9IF9yZWY2JHF1ZXJ5LnBhZ2UsIHBhZ2UgPSBfcmVmNiRxdWVyeSRwYWdlID09PSB2b2lkIDAgPyAxIDogX3JlZjYkcXVlcnkkcGFnZSwgX3JlZjYkcXVlcnkkcGVyUGFnZSA9IF9yZWY2JHF1ZXJ5LnBlclBhZ2UsIHBlclBhZ2UgPSBfcmVmNiRxdWVyeSRwZXJQYWdlID09PSB2b2lkIDAgPyAxMCA6IF9yZWY2JHF1ZXJ5JHBlclBhZ2UsIF9yZWY2JHF1ZXJ5JHNvcnQgPSBfcmVmNiRxdWVyeS5zb3J0LCBzb3J0ID0gX3JlZjYkcXVlcnkkc29ydCA9PT0gdm9pZCAwID8gJ2Rlc2MnIDogX3JlZjYkcXVlcnkkc29ydDsKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB7fTsKCiAgICAgICAgICAgICAgICBpZiAoYWNjZXNzVG9rZW4pIHsKICAgICAgICAgICAgICAgICAgb3B0aW9ucy5oZWFkZXJzID0gewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAodGhpcy5fcGFnZUluZm8uc29ydCAhPT0gbnVsbCAmJiBzb3J0ICE9PSB0aGlzLl9wYWdlSW5mby5zb3J0KSB7CiAgICAgICAgICAgICAgICAgIHBhZ2UgPSAxOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIF90aGlzJF9nZXRRdWVyeVBhcmFtcyA9IHRoaXMuX2dldFF1ZXJ5UGFyYW1zKHsKICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgICAgICAgICAgc29ydDogc29ydAogICAgICAgICAgICAgICAgfSksIGZpcnN0T3JMYXN0ID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zLmZpcnN0T3JMYXN0LCBhZnRlck9yQmVmb3JlID0gX3RoaXMkX2dldFF1ZXJ5UGFyYW1zLmFmdGVyT3JCZWZvcmUsIGN1cnNvciA9IF90aGlzJF9nZXRRdWVyeVBhcmFtcy5jdXJzb3I7CiAgICAgICAgICAgICAgICBfY29udGV4dDYubmV4dCA9IDk7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBvd25lcjogdGhpcy5vd25lciwKICAgICAgICAgICAgICAgICAgICByZXBvOiB0aGlzLnJlcG8sCiAgICAgICAgICAgICAgICAgICAgaXNzdWVJZDogaXNzdWVJZCwKICAgICAgICAgICAgICAgICAgICBwZXJQYWdlOiBwZXJQYWdlCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAicXVlcnkgZ2V0Q29tbWVudHMoXG4gICRvd25lcjogU3RyaW5nIVxuICAkcmVwbzogU3RyaW5nIVxuICAkaXNzdWVJZDogSW50IVxuICAkcGVyUGFnZTogSW50IVxuKSB7XG4gIHJlcG9zaXRvcnkob3duZXI6ICRvd25lciwgbmFtZTogJHJlcG8pIHtcbiAgICBpc3N1ZShudW1iZXI6ICRpc3N1ZUlkKSB7XG4gICAgICBjb21tZW50cyhcbiAgICAgICAgIi5jb25jYXQoZmlyc3RPckxhc3QsICI6ICRwZXJQYWdlXG4gICAgICAgICIpLmNvbmNhdChhZnRlck9yQmVmb3JlID09PSBudWxsID8gJycgOiAiIi5jb25jYXQoYWZ0ZXJPckJlZm9yZSwgIjogXCIiKS5jb25jYXQoY3Vyc29yLCAiXCIiKSwgIlxuICAgICAgKSB7XG4gICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgcGFnZUluZm8ge1xuICAgICAgICAgIGVuZEN1cnNvclxuICAgICAgICAgIHN0YXJ0Q3Vyc29yXG4gICAgICAgIH1cbiAgICAgICAgbm9kZXMge1xuICAgICAgICAgIGlkXG4gICAgICAgICAgYm9keVxuICAgICAgICAgIGJvZHlIVE1MXG4gICAgICAgICAgY3JlYXRlZEF0XG4gICAgICAgICAgdXBkYXRlZEF0XG4gICAgICAgICAgYXV0aG9yIHtcbiAgICAgICAgICAgIGF2YXRhclVybFxuICAgICAgICAgICAgbG9naW5cbiAgICAgICAgICAgIHVybFxuICAgICAgICAgIH1cbiAgICAgICAgICByZWFjdGlvbkdyb3VwcyB7XG4gICAgICAgICAgICB1c2VycyAoZmlyc3Q6IDApIHtcbiAgICAgICAgICAgICAgdG90YWxDb3VudFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29udGVudFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxufSIpCiAgICAgICAgICAgICAgICB9LCBvcHRpb25zKTsKCiAgICAgICAgICAgICAgY2FzZSA5OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNiA9IF9jb250ZXh0Ni5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczYuZGF0YTsKICAgICAgICAgICAgICAgIGNvbW1lbnRzID0gZGF0YS5kYXRhLnJlcG9zaXRvcnkuaXNzdWUuY29tbWVudHM7CgogICAgICAgICAgICAgICAgaWYgKHNvcnQgPT09ICdkZXNjJykgewogICAgICAgICAgICAgICAgICBjb21tZW50cy5ub2Rlcy5yZXZlcnNlKCk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdGhpcy5fcGFnZUluZm8gPSB7CiAgICAgICAgICAgICAgICAgIHBhZ2U6IHBhZ2UsCiAgICAgICAgICAgICAgICAgIHN0YXJ0Q3Vyc29yOiBjb21tZW50cy5wYWdlSW5mby5zdGFydEN1cnNvciwKICAgICAgICAgICAgICAgICAgZW5kQ3Vyc29yOiBjb21tZW50cy5wYWdlSW5mby5lbmRDdXJzb3IsCiAgICAgICAgICAgICAgICAgIHNvcnQ6IHNvcnQsCiAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHBlclBhZ2UKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ2LmFicnVwdCgicmV0dXJuIiwgewogICAgICAgICAgICAgICAgICBjb3VudDogY29tbWVudHMudG90YWxDb3VudCwKICAgICAgICAgICAgICAgICAgcGFnZTogcGFnZSwKICAgICAgICAgICAgICAgICAgcGVyUGFnZTogcGVyUGFnZSwKICAgICAgICAgICAgICAgICAgZGF0YTogY29tbWVudHMubm9kZXMubWFwKG5vcm1hbGl6ZUNvbW1lbnQpCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAxNToKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Ni5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlNiwgdGhpcyk7CiAgICAgIH0pKTsKCiAgICAgIGZ1bmN0aW9uIGdldENvbW1lbnRzKF94NSkgewogICAgICAgIHJldHVybiBfZ2V0Q29tbWVudHMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldENvbW1lbnRzOwogICAgfSgpCiAgICAvKioKICAgICAqIENyZWF0ZSBhIG5ldyBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL2FkZGNvbW1lbnQvCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvaW5wdXRfb2JqZWN0L2FkZGNvbW1lbnRpbnB1dC8KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0Q29tbWVudCIsCiAgICB2YWx1ZTogZnVuY3Rpb24gKCkgewogICAgICB2YXIgX3Bvc3RDb21tZW50ID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlNyhfcmVmNykgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNywgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU3JChfY29udGV4dDcpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ3LnByZXYgPSBfY29udGV4dDcubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjcuYWNjZXNzVG9rZW4sIGNvbnRlbnQgPSBfcmVmNy5jb250ZW50OwogICAgICAgICAgICAgICAgX2NvbnRleHQ3Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgLy8gcG9zdENvbW1lbnQgbmVlZHMgaXNzdWUgTm9kZUlkLCBzbyB3ZSBzdG9yZSBpdCBpbnRlcm5hbGx5CiAgICAgICAgICAgICAgICAgICAgaXNzdWVOb2RlSWQ6IHRoaXMuX2lzc3VlTm9kZUlkLAogICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGNvbnRlbnQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJtdXRhdGlvbiBwb3N0Q29tbWVudChcbiAgJGlzc3VlTm9kZUlkOiBJRCFcbiAgJGNvbnRlbnQ6IFN0cmluZyFcbikge1xuICBhZGRDb21tZW50KFxuICAgIGlucHV0OiB7XG4gICAgICBzdWJqZWN0SWQ6ICRpc3N1ZU5vZGVJZFxuICAgICAgYm9keTogJGNvbnRlbnRcbiAgICB9XG4gICkge1xuICAgIGNvbW1lbnRFZGdlIHtcbiAgICAgIG5vZGUge1xuICAgICAgICBpZFxuICAgICAgICBib2R5XG4gICAgICAgIGJvZHlIVE1MXG4gICAgICAgIGNyZWF0ZWRBdFxuICAgICAgICB1cGRhdGVkQXRcbiAgICAgICAgYXV0aG9yIHtcbiAgICAgICAgICBhdmF0YXJVcmxcbiAgICAgICAgICBsb2dpblxuICAgICAgICAgIHVybFxuICAgICAgICB9XG4gICAgICAgIHJlYWN0aW9uR3JvdXBzIHtcbiAgICAgICAgICB1c2VycyAoZmlyc3Q6IDApIHtcbiAgICAgICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGVudFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zNyA9IF9jb250ZXh0Ny5zZW50OwogICAgICAgICAgICAgICAgZGF0YSA9IF95aWVsZCR0aGlzJCRodHRwJHBvczcuZGF0YTsKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDcuYWJydXB0KCJyZXR1cm4iLCBub3JtYWxpemVDb21tZW50KGRhdGEuZGF0YS5hZGRDb21tZW50LmNvbW1lbnRFZGdlLm5vZGUpKTsKCiAgICAgICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ3LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU3LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gcG9zdENvbW1lbnQoX3g2KSB7CiAgICAgICAgcmV0dXJuIF9wb3N0Q29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcG9zdENvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogRWRpdCBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAc2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmdpdGh1Yi5jb20vdjQvbXV0YXRpb24vdXBkYXRlaXNzdWVjb21tZW50LwogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L2lucHV0X29iamVjdC91cGRhdGVpc3N1ZWNvbW1lbnRpbnB1dC8KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwdXRDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcHV0Q29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTgoX3JlZjgpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCwgY29udGVudCwgX3lpZWxkJHRoaXMkJGh0dHAkcG9zOCwgZGF0YTsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWU4JChfY29udGV4dDgpIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQ4LnByZXYgPSBfY29udGV4dDgubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjguYWNjZXNzVG9rZW4sIGNvbW1lbnRJZCA9IF9yZWY4LmNvbW1lbnRJZCwgY29udGVudCA9IF9yZWY4LmNvbnRlbnQ7CiAgICAgICAgICAgICAgICBfY29udGV4dDgubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnRJZCwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBjb250ZW50CiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAibXV0YXRpb24gcHV0Q29tbWVudChcbiAgJGNvbW1lbnRJZDogSUQhLFxuICAkY29udGVudDogU3RyaW5nISxcbikge1xuICB1cGRhdGVJc3N1ZUNvbW1lbnQoaW5wdXQ6IHtcbiAgICBpZDogJGNvbW1lbnRJZFxuICAgIGJvZHk6ICRjb250ZW50XG4gIH0pIHtcbiAgICBpc3N1ZUNvbW1lbnQge1xuICAgICAgaWRcbiAgICAgIGJvZHlcbiAgICAgIGJvZHlIVE1MXG4gICAgICBjcmVhdGVkQXRcbiAgICAgIHVwZGF0ZWRBdFxuICAgICAgYXV0aG9yIHtcbiAgICAgICAgYXZhdGFyVXJsXG4gICAgICAgIGxvZ2luXG4gICAgICAgIHVybFxuICAgICAgfVxuICAgICAgcmVhY3Rpb25Hcm91cHMge1xuICAgICAgICB1c2VycyAoZmlyc3Q6IDApIHtcbiAgICAgICAgICB0b3RhbENvdW50XG4gICAgICAgIH1cbiAgICAgICAgY29udGVudFxuICAgICAgfVxuICAgIH1cbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIF95aWVsZCR0aGlzJCRodHRwJHBvczggPSBfY29udGV4dDguc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M4LmRhdGE7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ4LmFicnVwdCgicmV0dXJuIiwgbm9ybWFsaXplQ29tbWVudChkYXRhLmRhdGEudXBkYXRlSXNzdWVDb21tZW50Lmlzc3VlQ29tbWVudCkpOwoKICAgICAgICAgICAgICBjYXNlIDY6CiAgICAgICAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDguc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTgsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwdXRDb21tZW50KF94NykgewogICAgICAgIHJldHVybiBfcHV0Q29tbWVudC5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgICB9CgogICAgICByZXR1cm4gcHV0Q29tbWVudDsKICAgIH0oKQogICAgLyoqCiAgICAgKiBEZWxldGUgYSBjb21tZW50CiAgICAgKgogICAgICogQHNlZSBodHRwczovL2RldmVsb3Blci5naXRodWIuY29tL3Y0L211dGF0aW9uL2RlbGV0ZWlzc3VlY29tbWVudC8KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJkZWxldGVDb21tZW50IiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfZGVsZXRlQ29tbWVudCA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTkoX3JlZjkpIHsKICAgICAgICB2YXIgYWNjZXNzVG9rZW4sIGNvbW1lbnRJZDsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTkkKF9jb250ZXh0OSkgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDkucHJldiA9IF9jb250ZXh0OS5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmOS5hY2Nlc3NUb2tlbiwgY29tbWVudElkID0gX3JlZjkuY29tbWVudElkOwogICAgICAgICAgICAgICAgX2NvbnRleHQ5Lm5leHQgPSAzOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuJGh0dHAucG9zdCgiZ3JhcGhxbCIsIHsKICAgICAgICAgICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgICAgICAgICAgY29tbWVudElkOiBjb21tZW50SWQKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJtdXRhdGlvbiBkZWxldGVDb21tZW50KFxuICAkY29tbWVudElkOiBJRCEsXG4pIHtcbiAgZGVsZXRlSXNzdWVDb21tZW50KGlucHV0OiB7XG4gICAgaWQ6ICRjb21tZW50SWRcbiAgfSkge1xuICAgIGNsaWVudE11dGF0aW9uSWRcbiAgfVxufSIKICAgICAgICAgICAgICAgIH0sIHsKICAgICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgIEF1dGhvcml6YXRpb246ICJ0b2tlbiAiLmNvbmNhdChhY2Nlc3NUb2tlbikKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICAgIHJldHVybiBfY29udGV4dDkuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ5LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU5LCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZGVsZXRlQ29tbWVudChfeDgpIHsKICAgICAgICByZXR1cm4gX2RlbGV0ZUNvbW1lbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGRlbGV0ZUNvbW1lbnQ7CiAgICB9KCkKICAgIC8qKgogICAgICogR2V0IHJlYWN0aW9ucyBvZiBhIGNvbW1lbnQKICAgICAqCiAgICAgKiBAcmVtYXJrcwogICAgICogVGhpcyBxdWVyeSBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQsIHVzZSB0aGUgY29tbWVudHMgcXVlcnkgaW5zdGVhZAogICAgICovCgogIH0sIHsKICAgIGtleTogImdldENvbW1lbnRSZWFjdGlvbnMiLAogICAgdmFsdWU6IGZ1bmN0aW9uICgpIHsKICAgICAgdmFyIF9nZXRDb21tZW50UmVhY3Rpb25zID0gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMTAoX3JlZjEwKSB7CiAgICAgICAgdmFyIGFjY2Vzc1Rva2VuLCBpc3N1ZUlkLCBjb21tZW50SWQsIF90aGlzJF9nZXRRdWVyeVBhcmFtczIsIGZpcnN0T3JMYXN0LCBhZnRlck9yQmVmb3JlLCBjdXJzb3IsIF95aWVsZCR0aGlzJCRodHRwJHBvczksIGRhdGEsIGNvbW1lbnQ7CgogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMTAkKF9jb250ZXh0MTApIHsKICAgICAgICAgIHdoaWxlICgxKSB7CiAgICAgICAgICAgIHN3aXRjaCAoX2NvbnRleHQxMC5wcmV2ID0gX2NvbnRleHQxMC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgYWNjZXNzVG9rZW4gPSBfcmVmMTAuYWNjZXNzVG9rZW4sIGlzc3VlSWQgPSBfcmVmMTAuaXNzdWVJZCwgY29tbWVudElkID0gX3JlZjEwLmNvbW1lbnRJZDsKICAgICAgICAgICAgICAgIF90aGlzJF9nZXRRdWVyeVBhcmFtczIgPSB0aGlzLl9nZXRRdWVyeVBhcmFtcygpLCBmaXJzdE9yTGFzdCA9IF90aGlzJF9nZXRRdWVyeVBhcmFtczIuZmlyc3RPckxhc3QsIGFmdGVyT3JCZWZvcmUgPSBfdGhpcyRfZ2V0UXVlcnlQYXJhbXMyLmFmdGVyT3JCZWZvcmUsIGN1cnNvciA9IF90aGlzJF9nZXRRdWVyeVBhcmFtczIuY3Vyc29yOwogICAgICAgICAgICAgICAgX2NvbnRleHQxMC5uZXh0ID0gNDsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLiRodHRwLnBvc3QoImdyYXBocWwiLCB7CiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlczogewogICAgICAgICAgICAgICAgICAgIG93bmVyOiB0aGlzLm93bmVyLAogICAgICAgICAgICAgICAgICAgIHJlcG86IHRoaXMucmVwbywKICAgICAgICAgICAgICAgICAgICBpc3N1ZUlkOiBpc3N1ZUlkLAogICAgICAgICAgICAgICAgICAgIHBlclBhZ2U6IHRoaXMuX3BhZ2VJbmZvLnBlclBhZ2UKICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgcXVlcnk6ICJxdWVyeSBnZXRDb21tZW50cyhcbiAgJG93bmVyOiBTdHJpbmchXG4gICRyZXBvOiBTdHJpbmchXG4gICRpc3N1ZUlkOiBJbnQhXG4gICRwZXJQYWdlOiBJbnQhXG4pIHtcbiAgcmVwb3NpdG9yeShvd25lcjogJG93bmVyLCBuYW1lOiAkcmVwbykge1xuICAgIGlzc3VlKG51bWJlcjogJGlzc3VlSWQpIHtcbiAgICAgIGNvbW1lbnRzKFxuICAgICAgICAiLmNvbmNhdChmaXJzdE9yTGFzdCwgIjogJHBlclBhZ2VcbiAgICAgICAgIikuY29uY2F0KGFmdGVyT3JCZWZvcmUgPT09IG51bGwgPyAnJyA6ICIiLmNvbmNhdChhZnRlck9yQmVmb3JlLCAiOiBcIiIpLmNvbmNhdChjdXJzb3IsICJcIiIpLCAiXG4gICAgICApIHtcbiAgICAgICAgbm9kZXMge1xuICAgICAgICAgIGlkXG4gICAgICAgICAgcmVhY3Rpb25Hcm91cHMge1xuICAgICAgICAgICAgdXNlcnMgKGZpcnN0OiAwKSB7XG4gICAgICAgICAgICAgIHRvdGFsQ291bnRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnRlbnRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbn0iKQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgICAgX3lpZWxkJHRoaXMkJGh0dHAkcG9zOSA9IF9jb250ZXh0MTAuc2VudDsKICAgICAgICAgICAgICAgIGRhdGEgPSBfeWllbGQkdGhpcyQkaHR0cCRwb3M5LmRhdGE7CiAgICAgICAgICAgICAgICBjb21tZW50ID0gZGF0YS5kYXRhLnJlcG9zaXRvcnkuaXNzdWUuY29tbWVudHMubm9kZXMuZmluZChmdW5jdGlvbiAoaXRlbSkgewogICAgICAgICAgICAgICAgICByZXR1cm4gaXRlbS5pZCA9PT0gY29tbWVudElkOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMC5hYnJ1cHQoInJldHVybiIsIG5vcm1hbGl6ZVJlYWN0aW9ucyhjb21tZW50LnJlYWN0aW9uR3JvdXBzKSk7CgogICAgICAgICAgICAgIGNhc2UgODoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTAuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZTEwLCB0aGlzKTsKICAgICAgfSkpOwoKICAgICAgZnVuY3Rpb24gZ2V0Q29tbWVudFJlYWN0aW9ucyhfeDkpIHsKICAgICAgICByZXR1cm4gX2dldENvbW1lbnRSZWFjdGlvbnMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIGdldENvbW1lbnRSZWFjdGlvbnM7CiAgICB9KCkKICAgIC8qKgogICAgICogQ3JlYXRlIGEgbmV3IHJlYWN0aW9uIG9mIGEgY29tbWVudAogICAgICoKICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9tdXRhdGlvbi9hZGRyZWFjdGlvbi8KICAgICAqIEBzZWUgaHR0cHM6Ly9kZXZlbG9wZXIuZ2l0aHViLmNvbS92NC9pbnB1dF9vYmplY3QvYWRkcmVhY3Rpb25pbnB1dC8KICAgICAqLwoKICB9LCB7CiAgICBrZXk6ICJwb3N0Q29tbWVudFJlYWN0aW9uIiwKICAgIHZhbHVlOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBfcG9zdENvbW1lbnRSZWFjdGlvbiA9IF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZTExKF9yZWYxMSkgewogICAgICAgIHZhciBhY2Nlc3NUb2tlbiwgY29tbWVudElkLCByZWFjdGlvbjsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTExJChfY29udGV4dDExKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0MTEucHJldiA9IF9jb250ZXh0MTEubmV4dCkgewogICAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuID0gX3JlZjExLmFjY2Vzc1Rva2VuLCBjb21tZW50SWQgPSBfcmVmMTEuY29tbWVudElkLCByZWFjdGlvbiA9IF9yZWYxMS5yZWFjdGlvbjsKICAgICAgICAgICAgICAgIF9jb250ZXh0MTEubmV4dCA9IDM7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy4kaHR0cC5wb3N0KCJncmFwaHFsIiwgewogICAgICAgICAgICAgICAgICB2YXJpYWJsZXM6IHsKICAgICAgICAgICAgICAgICAgICBjb21tZW50SWQ6IGNvbW1lbnRJZCwKICAgICAgICAgICAgICAgICAgICBjb250ZW50OiBtYXBSZWFjdGlvbk5hbWUocmVhY3Rpb24pCiAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgIHF1ZXJ5OiAibXV0YXRpb24gcG9zdENvbW1lbnRSZWFjdGlvbihcbiAgJGNvbW1lbnRJZDogSUQhLFxuICAkY29udGVudDogUmVhY3Rpb25Db250ZW50ISxcbikge1xuICBhZGRSZWFjdGlvbihpbnB1dDoge1xuICAgIHN1YmplY3RJZDogJGNvbW1lbnRJZFxuICAgIGNvbnRlbnQ6ICRjb250ZW50XG4gIH0pIHtcbiAgICByZWFjdGlvbiB7XG4gICAgICBkYXRhYmFzZUlkXG4gICAgfVxuICB9XG59IgogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgQXV0aG9yaXphdGlvbjogInRva2VuICIuY29uY2F0KGFjY2Vzc1Rva2VuKQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0MTEuYWJydXB0KCJyZXR1cm4iLCB0cnVlKTsKCiAgICAgICAgICAgICAgY2FzZSA0OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQxMS5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMTEsIHRoaXMpOwogICAgICB9KSk7CgogICAgICBmdW5jdGlvbiBwb3N0Q29tbWVudFJlYWN0aW9uKF94MTApIHsKICAgICAgICByZXR1cm4gX3Bvc3RDb21tZW50UmVhY3Rpb24uYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHBvc3RDb21tZW50UmVhY3Rpb247CiAgICB9KCkKICB9LCB7CiAgICBrZXk6ICJfZ2V0UXVlcnlQYXJhbXMiLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZXRRdWVyeVBhcmFtcygpIHsKICAgICAgdmFyIF9yZWYxMiA9IGFyZ3VtZW50cy5sZW5ndGggPiAwICYmIGFyZ3VtZW50c1swXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzBdIDoge30sCiAgICAgICAgICBfcmVmMTIkcGFnZSA9IF9yZWYxMi5wYWdlLAogICAgICAgICAgcGFnZSA9IF9yZWYxMiRwYWdlID09PSB2b2lkIDAgPyB0aGlzLl9wYWdlSW5mby5wYWdlIDogX3JlZjEyJHBhZ2UsCiAgICAgICAgICBfcmVmMTIkc29ydCA9IF9yZWYxMi5zb3J0LAogICAgICAgICAgc29ydCA9IF9yZWYxMiRzb3J0ID09PSB2b2lkIDAgPyB0aGlzLl9wYWdlSW5mby5zb3J0IDogX3JlZjEyJHNvcnQ7CgogICAgICB2YXIgZmlyc3RPckxhc3Q7CiAgICAgIHZhciBhZnRlck9yQmVmb3JlOwogICAgICB2YXIgY3Vyc29yOwoKICAgICAgaWYgKHBhZ2UgPT09IDEpIHsKICAgICAgICBmaXJzdE9yTGFzdCA9IHNvcnQgPT09ICdhc2MnID8gJ2ZpcnN0JyA6ICdsYXN0JzsKICAgICAgICBhZnRlck9yQmVmb3JlID0gbnVsbDsKICAgICAgICBjdXJzb3IgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChzb3J0ID09PSAnYXNjJykgewogICAgICAgICAgaWYgKHBhZ2UgPiB0aGlzLl9wYWdlSW5mby5wYWdlKSB7CiAgICAgICAgICAgIGZpcnN0T3JMYXN0ID0gJ2ZpcnN0JzsKICAgICAgICAgICAgYWZ0ZXJPckJlZm9yZSA9ICdhZnRlcic7CiAgICAgICAgICAgIGN1cnNvciA9IHRoaXMuX3BhZ2VJbmZvLmVuZEN1cnNvcjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGZpcnN0T3JMYXN0ID0gJ2xhc3QnOwogICAgICAgICAgICBhZnRlck9yQmVmb3JlID0gJ2JlZm9yZSc7CiAgICAgICAgICAgIGN1cnNvciA9IHRoaXMuX3BhZ2VJbmZvLnN0YXJ0Q3Vyc29yOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAocGFnZSA+IHRoaXMuX3BhZ2VJbmZvLnBhZ2UpIHsKICAgICAgICAgICAgZmlyc3RPckxhc3QgPSAnbGFzdCc7CiAgICAgICAgICAgIGFmdGVyT3JCZWZvcmUgPSAnYmVmb3JlJzsKICAgICAgICAgICAgY3Vyc29yID0gdGhpcy5fcGFnZUluZm8uc3RhcnRDdXJzb3I7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmaXJzdE9yTGFzdCA9ICdmaXJzdCc7CiAgICAgICAgICAgIGFmdGVyT3JCZWZvcmUgPSAnYWZ0ZXInOwogICAgICAgICAgICBjdXJzb3IgPSB0aGlzLl9wYWdlSW5mby5lbmRDdXJzb3I7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGZpcnN0T3JMYXN0OiBmaXJzdE9yTGFzdCwKICAgICAgICBhZnRlck9yQmVmb3JlOiBhZnRlck9yQmVmb3JlLAogICAgICAgIGN1cnNvcjogY3Vyc29yCiAgICAgIH07CiAgICB9CiAgfSwgewogICAga2V5OiAicGxhdGZvcm0iLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogJ0dpdEh1YicsCiAgICAgICAgbGluazogdGhpcy5iYXNlVVJMLAogICAgICAgIHZlcnNpb246ICd2NCcsCiAgICAgICAgbWV0YTogewogICAgICAgICAgcmVhY3RhYmxlOiB0cnVlLAogICAgICAgICAgc29ydGFibGU6IHRydWUKICAgICAgICB9CiAgICAgIH07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gR2l0aHViVjQ7Cn0oKTsKCmV4cG9ydCB7IEdpdGh1YlY0IGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["../src/index.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import axios from 'axios';\nimport { buildURL, concatURL, getCleanURL, parseQuery } from '@vssue/utils';\nimport { normalizeUser, normalizeIssue, normalizeComment, normalizeReactions, mapReactionName, } from './utils';\n/**\n * Github GraphQL API v4\n *\n * @see https://developer.github.com/v4/\n * @see https://developer.github.com/v4/explorer/\n * @see https://developer.github.com/apps/building-oauth-apps/\n */\nexport default class GithubV4 {\n    constructor({ baseURL = 'https://github.com', owner, repo, labels, clientId, clientSecret, state, proxy, }) {\n        if (typeof clientSecret === 'undefined' || typeof proxy === 'undefined') {\n            throw new Error('clientSecret and proxy is required for GitHub V4');\n        }\n        this.baseURL = baseURL;\n        this.owner = owner;\n        this.repo = repo;\n        this.labels = labels;\n        this.clientId = clientId;\n        this.clientSecret = clientSecret;\n        this.state = state;\n        this.proxy = proxy;\n        this._pageInfo = {\n            page: 1,\n            startCursor: null,\n            endCursor: null,\n            sort: null,\n            perPage: null,\n        };\n        this._issueNodeId = null;\n        this.$http = axios.create({\n            baseURL: baseURL === 'https://github.com'\n                ? 'https://api.github.com'\n                : concatURL(baseURL, 'api'),\n            headers: {\n                Accept: 'application/vnd.github.v3+json',\n            },\n        });\n        this.$http.interceptors.response.use(response => {\n            if (response.data.error) {\n                return Promise.reject(response.data.error_description);\n            }\n            if (response.data.errors) {\n                return Promise.reject(response.data.errors[0].message);\n            }\n            return response;\n        });\n    }\n    /**\n     * The platform api info\n     */\n    get platform() {\n        return {\n            name: 'GitHub',\n            link: this.baseURL,\n            version: 'v4',\n            meta: {\n                reactable: true,\n                sortable: true,\n            },\n        };\n    }\n    /**\n     * Redirect to the authorization page of platform.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#1-request-a-users-github-identity\n     */\n    redirectAuth() {\n        window.location.href = buildURL(concatURL(this.baseURL, 'login/oauth/authorize'), {\n            client_id: this.clientId,\n            redirect_uri: window.location.href,\n            scope: 'public_repo',\n            state: this.state,\n        });\n    }\n    /**\n     * Handle authorization.\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/\n     *\n     * @remarks\n     * If the `code` and `state` exist in the query, and the `state` matches, remove them from query, and try to get the access token.\n     */\n    async handleAuth() {\n        const query = parseQuery(window.location.search);\n        if (query.code) {\n            if (query.state !== this.state) {\n                return null;\n            }\n            const code = query.code;\n            delete query.code;\n            delete query.state;\n            const replaceURL = buildURL(getCleanURL(window.location.href), query) +\n                window.location.hash;\n            window.history.replaceState(null, '', replaceURL);\n            const accessToken = await this.getAccessToken({ code });\n            return accessToken;\n        }\n        return null;\n    }\n    /**\n     * Get user access token via `code`\n     *\n     * @see https://developer.github.com/apps/building-oauth-apps/authorizing-oauth-apps/#2-users-are-redirected-back-to-your-site-by-github\n     */\n    async getAccessToken({ code }) {\n        /**\n         * access_token api does not support cors\n         * @see https://github.com/isaacs/github/issues/330\n         */\n        const originalURL = concatURL(this.baseURL, 'login/oauth/access_token');\n        const proxyURL = typeof this.proxy === 'function' ? this.proxy(originalURL) : this.proxy;\n        const { data } = await this.$http.post(proxyURL, {\n            client_id: this.clientId,\n            client_secret: this.clientSecret,\n            code,\n        }, {\n            headers: {\n                Accept: 'application/json',\n            },\n        });\n        return data.access_token;\n    }\n    /**\n     * Get the logged-in user with access token.\n     *\n     * @see https://developer.github.com/v4/query/ viewer\n     * @see https://developer.github.com/v4/object/user/\n     */\n    async getUser({ accessToken, }) {\n        const { data } = await this.$http.post('graphql', {\n            query: `\\\nquery getUser {\n  viewer {\n    login\n    avatarUrl\n    url\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return normalizeUser(data.data.viewer);\n    }\n    /**\n     * Get issue of this page according to the issue id or the issue title\n     *\n     * @see https://developer.github.com/v4/object/repository/\n     * @see https://developer.github.com/v4/object/issueconnection/\n     * @see https://developer.github.com/v4/object/issue/\n     *\n     * @remarks\n     * The IssueConnection does not have title filter for now, and the number of results is limited to 100.\n     * For now, if issues with the labels are more than 100, we have to request the next page(not implemented yet).\n     */\n    async getIssue({ accessToken, issueId, issueTitle, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (issueId) {\n            try {\n                const { data } = await this.$http.post(`graphql`, {\n                    query: `\\\nquery getIssueById {\n  repository(owner: \"${this.owner}\", name: \"${this.repo}\") {\n    issue (number: ${issueId}) {\n      id\n      number\n      title\n      body\n      url\n    }\n  }\n}`,\n                }, options);\n                // postComment needs issue NodeId, so we store it internally\n                this._issueNodeId = data.data.repository.issue.id;\n                return normalizeIssue(data.data.repository.issue);\n            }\n            catch (e) {\n                if (e.response && e.response.status === 404) {\n                    return null;\n                }\n                else {\n                    throw e;\n                }\n            }\n        }\n        else {\n            const query = [\n                `\"${issueTitle}\"`,\n                `in:title`,\n                `repo:${this.owner}/${this.repo}`,\n                `is:public`,\n                ...this.labels.map(label => `label:${label}`),\n            ].join(' ');\n            const { data } = await this.$http.post(`graphql`, {\n                variables: {\n                    query,\n                },\n                query: `\\\nquery getIssueByTitle(\n  $query: String!\n) {\n  search(\n    query: $query\n    type: ISSUE\n    first: 20\n    ) {\n      nodes {\n      ... on Issue {\n        id\n        number\n        title\n        body\n        url\n      }\n    }\n  }\n}`,\n            }, options);\n            const issue = data.data.search.nodes.find(item => item.title === issueTitle);\n            // postComment needs issue NodeId, so we store it internally\n            if (issue) {\n                this._issueNodeId = issue.id;\n                return normalizeIssue(issue);\n            }\n            return null;\n        }\n    }\n    /**\n     * Create a new issue\n     *\n     * @see https://developer.github.com/v4/mutation/createissue/\n     * @see https://developer.github.com/v4/input_object/createissueinput/\n     *\n     * @remarks\n     * Creating issue requires repositoryId, which should be requested in an extra request.\n     * Creating issue with labels requires labelIds, which should be requested in an extra request, or create the label if it does not exist.\n     * Endpoints for creating labels has not been implemented by GitHub yet (see https://developer.github.com/v4/mutation/createlabel/)\n     *\n     * For these reasons, fallback to v3 for now\n     */\n    async postIssue({ accessToken, title, content, }) {\n        const { data } = await this.$http.post(`repos/${this.owner}/${this.repo}/issues`, {\n            title,\n            body: content,\n            labels: this.labels,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        // `html_url` in v3\n        // `url` in v4\n        data.url = data.html_url;\n        // postComment needs issue NodeId, so we store it internally\n        this._issueNodeId = data.node_id;\n        return normalizeIssue(data);\n    }\n    /**\n     * Get comments of this page according to the issue id\n     *\n     * @see https://developer.github.com/v4/object/issuecommentconnection/\n     *\n     * @remarks\n     * No offset implemented, so it's difficult to implement REST-like pagination\n     * For now, we use an internal `_pageInfo` var to hack that\n     */\n    async getComments({ accessToken, issueId, query: { page = 1, perPage = 10, sort = 'desc' } = {}, }) {\n        const options = {};\n        if (accessToken) {\n            options.headers = {\n                Authorization: `token ${accessToken}`,\n            };\n        }\n        if (this._pageInfo.sort !== null && sort !== this._pageInfo.sort) {\n            page = 1;\n        }\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams({\n            page,\n            sort,\n        });\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        totalCount\n        pageInfo {\n          endCursor\n          startCursor\n        }\n        nodes {\n          id\n          body\n          bodyHTML\n          createdAt\n          updatedAt\n          author {\n            avatarUrl\n            login\n            url\n          }\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, options);\n        const comments = data.data.repository.issue.comments;\n        if (sort === 'desc') {\n            comments.nodes.reverse();\n        }\n        this._pageInfo = {\n            page,\n            startCursor: comments.pageInfo.startCursor,\n            endCursor: comments.pageInfo.endCursor,\n            sort,\n            perPage,\n        };\n        return {\n            count: comments.totalCount,\n            page: page,\n            perPage: perPage,\n            data: comments.nodes.map(normalizeComment),\n        };\n    }\n    /**\n     * Create a new comment\n     *\n     * @see https://developer.github.com/v4/mutation/addcomment/\n     * @see https://developer.github.com/v4/input_object/addcommentinput/\n     */\n    async postComment({ accessToken, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                // postComment needs issue NodeId, so we store it internally\n                issueNodeId: this._issueNodeId,\n                content,\n            },\n            query: `\\\nmutation postComment(\n  $issueNodeId: ID!\n  $content: String!\n) {\n  addComment(\n    input: {\n      subjectId: $issueNodeId\n      body: $content\n    }\n  ) {\n    commentEdge {\n      node {\n        id\n        body\n        bodyHTML\n        createdAt\n        updatedAt\n        author {\n          avatarUrl\n          login\n          url\n        }\n        reactionGroups {\n          users (first: 0) {\n            totalCount\n          }\n          content\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.addComment.commentEdge.node);\n    }\n    /**\n     * Edit a comment\n     *\n     * @see https://developer.github.com/v4/mutation/updateissuecomment/\n     * @see https://developer.github.com/v4/input_object/updateissuecommentinput/\n     */\n    async putComment({ accessToken, commentId, content, }) {\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content,\n            },\n            query: `\\\nmutation putComment(\n  $commentId: ID!,\n  $content: String!,\n) {\n  updateIssueComment(input: {\n    id: $commentId\n    body: $content\n  }) {\n    issueComment {\n      id\n      body\n      bodyHTML\n      createdAt\n      updatedAt\n      author {\n        avatarUrl\n        login\n        url\n      }\n      reactionGroups {\n        users (first: 0) {\n          totalCount\n        }\n        content\n      }\n    }\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return normalizeComment(data.data.updateIssueComment.issueComment);\n    }\n    /**\n     * Delete a comment\n     *\n     * @see https://developer.github.com/v4/mutation/deleteissuecomment/\n     */\n    async deleteComment({ accessToken, commentId, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n            },\n            query: `\\\nmutation deleteComment(\n  $commentId: ID!,\n) {\n  deleteIssueComment(input: {\n    id: $commentId\n  }) {\n    clientMutationId\n  }\n}`,\n        }, {\n            headers: {\n                Authorization: `token ${accessToken}`,\n            },\n        });\n        return true;\n    }\n    /**\n     * Get reactions of a comment\n     *\n     * @remarks\n     * This query has not been implemented, use the comments query instead\n     */\n    async getCommentReactions({ accessToken, issueId, commentId, }) {\n        const { firstOrLast, afterOrBefore, cursor } = this._getQueryParams();\n        const { data } = await this.$http.post(`graphql`, {\n            variables: {\n                owner: this.owner,\n                repo: this.repo,\n                issueId,\n                perPage: this._pageInfo.perPage,\n            },\n            query: `\\\nquery getComments(\n  $owner: String!\n  $repo: String!\n  $issueId: Int!\n  $perPage: Int!\n) {\n  repository(owner: $owner, name: $repo) {\n    issue(number: $issueId) {\n      comments(\n        ${firstOrLast}: $perPage\n        ${afterOrBefore === null ? '' : `${afterOrBefore}: \"${cursor}\"`}\n      ) {\n        nodes {\n          id\n          reactionGroups {\n            users (first: 0) {\n              totalCount\n            }\n            content\n          }\n        }\n      }\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        const comment = data.data.repository.issue.comments.nodes.find(item => item.id === commentId);\n        return normalizeReactions(comment.reactionGroups);\n    }\n    /**\n     * Create a new reaction of a comment\n     *\n     * @see https://developer.github.com/v4/mutation/addreaction/\n     * @see https://developer.github.com/v4/input_object/addreactioninput/\n     */\n    async postCommentReaction({ accessToken, commentId, reaction, }) {\n        await this.$http.post(`graphql`, {\n            variables: {\n                commentId,\n                content: mapReactionName(reaction),\n            },\n            query: `\\\nmutation postCommentReaction(\n  $commentId: ID!,\n  $content: ReactionContent!,\n) {\n  addReaction(input: {\n    subjectId: $commentId\n    content: $content\n  }) {\n    reaction {\n      databaseId\n    }\n  }\n}`,\n        }, {\n            headers: { Authorization: `token ${accessToken}` },\n        });\n        return true;\n    }\n    _getQueryParams({ page = this._pageInfo.page, sort = this._pageInfo.sort, } = {}) {\n        let firstOrLast;\n        let afterOrBefore;\n        let cursor;\n        if (page === 1) {\n            firstOrLast = sort === 'asc' ? 'first' : 'last';\n            afterOrBefore = null;\n            cursor = null;\n        }\n        else {\n            if (sort === 'asc') {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n                else {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n            }\n            else {\n                if (page > this._pageInfo.page) {\n                    firstOrLast = 'last';\n                    afterOrBefore = 'before';\n                    cursor = this._pageInfo.startCursor;\n                }\n                else {\n                    firstOrLast = 'first';\n                    afterOrBefore = 'after';\n                    cursor = this._pageInfo.endCursor;\n                }\n            }\n        }\n        return {\n            firstOrLast,\n            afterOrBefore,\n            cursor,\n        };\n    }\n}\n//# sourceMappingURL=index.js.map"]}]}