{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{621:function(e,p,a){\"use strict\";a.r(p);var t=a(23),o=Object(t.a)({},(function(){var e=this,p=e.$createElement,a=e._self._c||p;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[a(\"p\",[e._v(\"本文代码为Juno版本。\\n新手上路，查看OpenStack REST API的实现。\")]),e._v(\" \"),a(\"p\",[e._v(\"首先看下api-paste.ini配置文件，学习下Paste+route相关内容。\")]),e._v(\" \"),a(\"p\",[e._v(\"OpenStack在REST API层，使用Python的Paste+Route。\")]),e._v(\" \"),a(\"p\",[e._v(\"本文以Nova为例，记录学习OpenStack的过程。\")]),e._v(\" \"),a(\"p\",[e._v(\"1、在/etc/nova/目录下查看api-paste.ini文件。该文件即描述Nova API相关配置。\")]),e._v(\" \"),a(\"p\",[e._v(\"一个配置文件后缀为ini，内容被分为很多段（section），PD只关心带有前缀的段，比如\"),a(\"code\",[e._v(\"[app:main]\")]),e._v(\"或者\"),a(\"code\",[e._v(\"[filter:errors]\")]),e._v(\"，总的来说，一个section的标识就是\"),a(\"code\",[e._v(\"[type:name]\")]),e._v(\",不是这种类型的section将会被忽略。\\n一个section的内容是以键=值来标示的。#是一个注释。在段的定义中，有以下几类：\")]),e._v(\" \"),a(\"p\",[a(\"code\",[e._v(\"[app:main]\")]),e._v(\":定义WSGI应用，main表示只有一个应用，有多个应用的话main改为应用名字\")]),e._v(\" \"),a(\"p\",[a(\"code\",[e._v(\"[server:main]\")]),e._v(\":定义WSGI的一个server。\")]),e._v(\" \"),a(\"p\",[a(\"code\",[e._v(\"[composite:xxx]\")]),e._v(\"：表示需要将一个请求调度定向（dispatched）到多个,或者多种应用上。以下是一个简单的例子，例子中，使用了composite，通过urlmap来实现载入多应用。\\n\"),a(\"code\",[e._v(\"[fliter:]\")]),e._v(\"：定义“过滤器”，将应用进行进一步的封装。\")]),e._v(\" \"),a(\"p\",[a(\"code\",[e._v(\"[DEFAULT]\")]),e._v(\"：定义一些默认变量的值\")]),e._v(\" \"),a(\"p\",[e._v(\"详细内容参考：\\n\"),a(\"a\",{attrs:{href:\"http://www.cnblogs.com/Security-Darren/p/4087587.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"http://www.cnblogs.com/Security-Darren/p/4087587.html\"),a(\"OutboundLink\")],1)]),e._v(\" \"),a(\"hr\"),e._v(\" \"),a(\"p\",[e._v(\"接下来详细看下api-paste.ini文件：\")]),e._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[e._v(\"[composite:osapi_compute]\\nuse = call:nova.api.openstack.urlmap:urlmap_factory\\n/: oscomputeversions\\n/v1.1: openstack_compute_api_v2\\n/v2: openstack_compute_api_v2\\n/v2.1: openstack_compute_api_v21\\n/v3: openstack_compute_api_v3\\n\")])])]),a(\"p\",[e._v(\"以上Section定义了一个名为\"),a(\"code\",[e._v(\"osapi_compute\")]),e._v(\"的composite,\"),a(\"code\",[e._v(\"use=call:nova.api.openstack.urlmap:urlmap_factory\")]),e._v(\"\\n指定了该composite app的入口为\"),a(\"code\",[e._v(\"nova.api.openstack.urlmap\")]),e._v(\"中的\"),a(\"code\",[e._v(\"urlmap_factory\")]),e._v(\"。该方法的入参是一段REST API的URL。\\n接着\"),a(\"code\",[e._v(\"/:, /v1.1:, /v2:, /v3:\")]),e._v(\"分别指定了该字符串开头的URL使用不同的app处理。如\"),a(\"code\",[e._v(\"/v3\")]),e._v(\"使用\"),a(\"code\",[e._v(\"openstack_compute_api_v3\")]),e._v(\"处理。\")]),e._v(\" \"),a(\"hr\"),e._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[e._v(\"[composite:openstack_compute_api_v21]\\nuse = call:nova.api.auth:pipeline_factory_v21\\nnoauth = request_id faultwrap sizelimit noauth osapi_compute_app_v21\\nkeystone = request_id faultwrap sizelimit authtoken keystonecontext osapi_compute_app_v21\\n\")])])]),a(\"p\",[e._v(\"以上composite即v2.1版本API的处理composite app。该composite使用到\"),a(\"code\",[e._v(\"pipeline_factory\")]),e._v(\"。pipeline是为app指定一串filter的一种用法。如noauth对应的pipeline即为\"),a(\"code\",[e._v(\"request_id faultwrap sizelimit noauth osapi_compute_app_v21\")]),e._v(\",最后一个\"),a(\"code\",[e._v(\"osapi_compute_app_v21\")]),e._v(\"为业务处理的app。前面\"),a(\"code\",[e._v(\"request_id faultwrap sizelimit noauth\")]),e._v(\"都为filter。靠近app的filter先执行。\")]),e._v(\" \"),a(\"hr\"),e._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[e._v(\"[app:osapi_compute_app_v21]\\npaste.app_factory = nova.api.openstack.compute:APIRouterV21.factory\\n\")])])]),a(\"p\",[e._v(\"声明一个app的入口除了使用\"),a(\"code\",[e._v(\"use=XXX\")]),e._v(\"外，还有\"),a(\"code\",[e._v(\"paste.xxx_factory\")]),e._v(\"的方式可以用来指定application的入口,其中paste.xxx_factory称为protocol。\")]),e._v(\" \"),a(\"p\",[e._v(\"注：当前比较常用的potocol 有：\"),a(\"code\",[e._v(\"paste_app_factory\")]),e._v(\"，\"),a(\"code\",[e._v(\"paste.filter_factory\")]),e._v(\"，\"),a(\"code\",[e._v(\"paste.compsite_factory\")]),e._v(\"，\"),a(\"code\",[e._v(\"paste.filter_app_factory\")]),e._v(\", \"),a(\"code\",[e._v(\"paste.server_factory\")]),e._v(\"，用来分别上述的6种section指定入口。\")]),e._v(\" \"),a(\"hr\"),e._v(\" \"),a(\"p\",[e._v(\"总结下Nova API wsgi app的调用关系图\")]),e._v(\" \"),a(\"p\",[e._v(\"[\"),a(\"img\",{attrs:{src:\"{{ site.baseurl }}/images/openstack/api-paste.ini调度.jpg\"}}),e._v(\"](\"+e._s(e.site.baseurl)+\"/)\")])])}),[],!1,null,null,null);p.default=o.exports}}]);","extractedComments":[]}